This file is a merged representation of a subset of the codebase, containing specifically included files and files not matching ignore patterns, combined into a single document by Repomix.
The content has been processed where comments have been removed, line numbers have been added, content has been compressed (code blocks are separated by ‚ãÆ---- delimiter).

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: **/*.tsx, **/*.ts, **/*.mjs, **/*.js, **/*.css, **/*.json, .env.example
- Files matching these patterns are excluded: node_modules/**, public/**, .next/**, .git/**, data/**, test/**, coverage/**, dist/**, build/**, .serena/**, .claude/**, .playwright-mcp/**, backup_*.sql, repomix-output.*, *.log, **/*.xlsx, **/*.csv, **/.DS_Store, **/*.tmp, **/*.lock, pnpm-lock.yaml, package-lock.json, **/*.svg, **/*.jpg, **/*.jpeg, **/*.png, **/*.gif, **/*.bmp, **/*.tiff, **/*.tif, **/*.webp, **/*.ico, **/*.avif, **/*.heic, **/*.heif, **/*.mp4, **/*.avi, **/*.mov, **/*.wmv, **/*.flv, **/*.webm, **/*.mkv, **/*.m4v, **/*.3gp, **/*.mpeg, **/*.mpg, **/*.ogv, **/*.m3u8, **/*.mp3, **/*.wav, **/*.flac, **/*.aac, **/*.ogg, **/*.wma, **/*.m4a, **/*.md
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Code comments have been removed from supported file types
- Line numbers have been added to the beginning of each line
- Content has been compressed - code blocks are separated by ‚ãÆ---- delimiter
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.env.example
app/admin/analytics/customers/page.tsx
app/admin/analytics/layout.tsx
app/admin/analytics/marketing/page.tsx
app/admin/analytics/page.tsx
app/admin/analytics/properties/page.tsx
app/admin/analytics/sales/page.tsx
app/admin/contacts/loading.tsx
app/admin/contacts/page.tsx
app/admin/layout.tsx
app/admin/page.tsx
app/admin/properties/[id]/edit/page.tsx
app/admin/properties/new/page.tsx
app/admin/properties/page.tsx
app/agentes/page.tsx
app/api/admin/readme/route.ts
app/api/analytics/dashboard/route.ts
app/api/analytics/gdpr/opt-out/route.ts
app/api/analytics/interaction/route.ts
app/api/analytics/lead-generation/route.ts
app/api/analytics/modules/[module]/route.ts
app/api/analytics/property-metrics/[id]/route.ts
app/api/analytics/property-view/route.ts
app/api/analytics/session/route.ts
app/api/auth/create-user/route.ts
app/api/dashboard/recent-activity/route.ts
app/api/dashboard/stats/route.ts
app/api/geocode/route.ts
app/api/leads/[id]/route.ts
app/api/leads/route.ts
app/api/properties/[id]/route.ts
app/api/properties/route.ts
app/api/reverse-geocode/route.ts
app/api/settings/route.ts
app/api/settings/upload/route.ts
app/api/upload/multiple/route.ts
app/api/upload/route.ts
app/contacto/page.tsx
app/globals.css
app/layout.tsx
app/loading.tsx
app/page-premium.tsx
app/page.tsx
app/propiedades/[id]/page.tsx
app/propiedades/loading.tsx
app/propiedades/page.tsx
apply-analytics-fix.js
apply-rls-fix.js
claude_desktop_config_example.json
components.json
components/admin/AdminLayout.tsx
components/admin/AnalyticsDashboard.tsx
components/admin/ContactDetailModal.tsx
components/admin/ContactKanban.tsx
components/admin/CustomerInsights.tsx
components/admin/Dashboard.tsx
components/admin/ExecutiveOverview.tsx
components/admin/LeafletMapComponent.tsx
components/admin/MarketingAnalytics.tsx
components/admin/PropertiesPage.backup.tsx
components/admin/PropertiesPage.tsx
components/admin/PropertyAnalytics.tsx
components/admin/PropertyForm.tsx
components/admin/PropertyLocationPicker.tsx
components/admin/ReadmeDocumentation.tsx
components/admin/SalesPerformance.tsx
components/admin/theme-provider.tsx
components/AdminLayout.tsx
components/AnalyticsInitializer.tsx
components/Dashboard.tsx
components/FeaturedPropertiesSlider.tsx
components/Footer.tsx
components/Header.tsx
components/Hero.tsx
components/HeroSearchBar.tsx
components/layouts/analytics-dashboard-layout.tsx
components/layouts/examples/analytics-dashboard-demo.tsx
components/layouts/examples/index.tsx
components/layouts/examples/marketing-module-demo.tsx
components/layouts/examples/sales-module-demo.tsx
components/layouts/filter-bar.tsx
components/layouts/index.ts
components/layouts/module-container.tsx
components/layouts/responsive-wrapper.tsx
components/layouts/sidebar-navigation.tsx
components/layouts/widget-grid.tsx
components/LeadSourceSelector.tsx
components/navigation/analytics-layout-wrapper.tsx
components/navigation/command-palette.tsx
components/navigation/index.ts
components/navigation/mobile-bottom-nav.tsx
components/navigation/module-tabs.tsx
components/PropertyCard.tsx
components/PropertyDetailMap.tsx
components/PropertyForm.tsx
components/PropertyMiniMap.tsx
components/PropertyViewTracker.tsx
components/providers/analytics-store-provider.tsx
components/providers/query-provider.tsx
components/theme-provider.tsx
components/ui/analytics-demo.tsx
components/ui/analytics-integration-test.tsx
components/ui/analytics.ts
components/ui/badge.tsx
components/ui/button.tsx
components/ui/card.tsx
components/ui/chart-container.tsx
components/ui/checkbox.tsx
components/ui/command.tsx
components/ui/data-table.tsx
components/ui/dialog.tsx
components/ui/dropdown-menu.tsx
components/ui/input.tsx
components/ui/interactive-chart.tsx
components/ui/kpi-card.tsx
components/ui/label.tsx
components/ui/loading-skeleton.tsx
components/ui/metrics-badge.tsx
components/ui/popover.tsx
components/ui/scroll-area.tsx
components/ui/select.tsx
components/ui/separator.tsx
components/ui/sheet.tsx
components/ui/switch.tsx
components/ui/tabs.tsx
components/ui/textarea.tsx
components/ui/toast.tsx
components/ui/toaster.tsx
components/ui/trend-indicator.tsx
create-test-properties.js
debug-session-creation.js
debug-session-issue.js
hooks/analytics.ts
hooks/use-is-client.tsx
hooks/use-toast.ts
hooks/useAnalytics.ts
hooks/useAnalyticsDashboard.ts
hooks/useAnalyticsLayout.ts
hooks/useContactActions.ts
hooks/useContactFilters.ts
hooks/useContactMetrics.ts
hooks/useContacts.ts
hooks/useFilters.ts
hooks/useLeadAnalytics.ts
hooks/useOptimisticUpdates.ts
hooks/usePropertyMetrics.ts
hooks/useRealTimeUpdates.ts
hooks/useResponsive.ts
hooks/useSidebar.ts
lib/analytics-client.ts
lib/api-middleware.ts
lib/api-utils.ts
lib/cloudinary-server.ts
lib/cloudinary.ts
lib/map-config.ts
lib/react-query-config.ts
lib/supabase.ts
lib/utils.ts
middleware.ts
next.config.mjs
package.json
postcss.config.mjs
scripts/create-user.js
scripts/read-analytics-readme.js
scripts/run-analytics-fix.js
services/analytics.ts
services/leads.ts
services/properties.ts
services/settings.ts
session.json
stores/analytics-store.ts
stores/navigation-store.ts
styles/globals.css
styles/leaflet.css
styles/premium-theme.css
tailwind.config.ts
test_session.json
test-analytics-properties.js
test-fix-with-api.js
tsconfig.json
types/analytics.ts
types/settings.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/admin/contacts/loading.tsx">
import { Card, CardContent } from "@/components/ui/card"
</file>

<file path="app/admin/contacts/page.tsx">
import { useState } from "react"
import {
  MessageSquare,
  Phone,
  Mail,
  Calendar,
  Search,
  Eye,
  MoreHorizontal,
  Users,
  TrendingUp,
  Clock,
  Star,
  Grid3X3,
  List,
  Plus,
} from "lucide-react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Badge } from "@/components/ui/badge"
import { Card, CardContent } from "@/components/ui/card"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "@/components/ui/dropdown-menu"
‚ãÆ----
import { useContacts } from "@/hooks/useContacts"
import { useContactFilters } from "@/hooks/useContactFilters"
import { useContactActions } from "@/hooks/useContactActions"
import ContactDetailModal from "@/components/admin/ContactDetailModal"
import ContactKanban from "@/components/admin/ContactKanban"
‚ãÆ----
const handleContactClick = (contact: any) =>
‚ãÆ----
const handleStatusChange = async (contactId: number, newStatus: any) =>
‚ãÆ----
const getStatusColor = (status: string) =>
‚ãÆ----
const getStatusLabel = (status: string) =>
‚ãÆ----
const getPriorityColor = (priority: string) =>
‚ãÆ----
const getPriorityLabel = (priority: string) =>
‚ãÆ----
<Badge className=
‚ãÆ----
e.stopPropagation()
callContact(contact)
‚ãÆ----
openEmail(contact)
‚ãÆ----
openWhatsApp(contact)
</file>

<file path="app/admin/layout.tsx">
import type React from "react"
import AdminLayout from "@/components/admin/AdminLayout"
‚ãÆ----
export default function Layout({
  children,
}: {
  children: React.ReactNode
})
</file>

<file path="app/admin/page.tsx">
import Dashboard from "@/components/admin/Dashboard"
‚ãÆ----
export default function AdminPage()
</file>

<file path="app/admin/properties/[id]/edit/page.tsx">
import { useState, useEffect } from "react";
import { useParams } from "next/navigation";
import PropertyForm from "@/components/admin/PropertyForm";
‚ãÆ----
export default function EditPropertyPage()
‚ãÆ----
const loadProperty = async () =>
</file>

<file path="app/admin/properties/new/page.tsx">
import PropertyForm from "@/components/admin/PropertyForm";
‚ãÆ----
export default function NewPropertyPage()
</file>

<file path="app/admin/properties/page.tsx">
import PropertiesPage from '@/components/admin/PropertiesPage'
</file>

<file path="app/api/dashboard/recent-activity/route.ts">
import { NextResponse } from "next/server"
import { createClient } from "@supabase/supabase-js"
‚ãÆ----
export async function GET()
</file>

<file path="app/api/dashboard/stats/route.ts">
import { NextResponse } from "next/server"
import { createClient } from "@supabase/supabase-js"
‚ãÆ----
export async function GET()
</file>

<file path="app/api/leads/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { supabase } from "@/lib/supabase"
‚ãÆ----
export async function GET()
‚ãÆ----
export async function POST(request: NextRequest)
</file>

<file path="app/api/properties/[id]/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { createClient } from "@supabase/supabase-js"
‚ãÆ----
export async function GET(request: NextRequest,
‚ãÆ----
export async function PUT(request: NextRequest,
‚ãÆ----
export async function PATCH(request: NextRequest,
‚ãÆ----
export async function DELETE(request: NextRequest,
</file>

<file path="app/api/properties/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { createClient } from "@supabase/supabase-js"
‚ãÆ----
export async function GET(request: NextRequest)
‚ãÆ----
export async function POST(request: NextRequest)
</file>

<file path="app/api/upload/multiple/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { v2 as cloudinary } from "cloudinary"
‚ãÆ----
export async function POST(request: NextRequest)
</file>

<file path="app/api/upload/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { uploadToCloudinary } from "@/lib/cloudinary-server"
‚ãÆ----
export async function POST(request: NextRequest)
</file>

<file path="app/loading.tsx">
export default function Loading()
</file>

<file path="app/page-premium.tsx">
import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import {
  Search,
  MapPin,
  Bed,
  Bath,
  Square,
  ArrowRight,
  Heart,
  ChevronDown,
  Phone,
  Mail,
  Home,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { getOptimizedImageUrl } from "@/lib/cloudinary";
import Link from "next/link";
import Image from "next/image";
‚ãÆ----
import { useIsClient } from "@/hooks/use-is-client";
import { PropertyService } from "@/services/properties";
import type { Property } from "@/lib/supabase";
‚ãÆ----
const loadFeaturedProperties = async () =>
‚ãÆ----
const handleScroll = () =>
‚ãÆ----
const formatPrice = (price: number) =>
</file>

<file path="app/propiedades/loading.tsx">

</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
</file>

<file path="components/admin/ContactDetailModal.tsx">
import { useState } from "react"
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Badge } from "@/components/ui/badge"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Phone, Mail, MessageCircle, User, Building, Clock, Star, Save } from "lucide-react"
import type { Contact } from "@/hooks/useContacts"
import { useContactActions } from "@/hooks/useContactActions"
‚ãÆ----
interface ContactDetailModalProps {
  contact: Contact | null
  isOpen: boolean
  onClose: () => void
  onUpdate: (id: number, updates: Partial<Contact>) => Promise<void>
}
‚ãÆ----
const handleEdit = () =>
‚ãÆ----
const handleSave = async () =>
‚ãÆ----
const getStatusColor = (status: string) =>
‚ãÆ----
const getPriorityColor = (priority: string) =>
‚ãÆ----
<Badge className=
</file>

<file path="components/admin/ContactKanban.tsx">
import type React from "react"
‚ãÆ----
import { useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { Phone, Mail, MessageCircle, User, Calendar, Star } from "lucide-react"
import type { Contact } from "@/hooks/useContacts"
import { useContactActions } from "@/hooks/useContactActions"
‚ãÆ----
interface ContactKanbanProps {
  contacts: Contact[]
  onContactClick: (contact: Contact) => void
  onStatusChange: (contactId: number, newStatus: Contact["status"]) => void
}
‚ãÆ----
const handleDragStart = (e: React.DragEvent, contact: Contact) =>
‚ãÆ----
const handleDragOver = (e: React.DragEvent) =>
‚ãÆ----
const handleDrop = (e: React.DragEvent, newStatus: Contact["status"]) =>
‚ãÆ----
const getPriorityColor = (priority: string) =>
‚ãÆ----
e.stopPropagation()
callContact(contact)
‚ãÆ----
openEmail(contact)
‚ãÆ----
openWhatsApp(contact)
</file>

<file path="components/admin/theme-provider.tsx">
import {
  ThemeProvider as NextThemesProvider,
  type ThemeProviderProps,
} from 'next-themes'
‚ãÆ----
export function ThemeProvider(
</file>

<file path="components/AdminLayout.tsx">
import { useState } from "react";
import { useRouter, usePathname } from "next/navigation";
import { Home, TrendingUp, MessageSquare, Settings, LogOut, Menu, X } from "lucide-react";
‚ãÆ----
interface AdminLayoutProps {
	children: React.ReactNode;
}
‚ãÆ----
const handleLogout = async () =>
</file>

<file path="components/Dashboard.tsx">
import { useState, useEffect } from "react";
import { Home, DollarSign, Users, TrendingUp, Eye, MessageSquare, Calendar, ArrowUpRight, ArrowDownRight } from "lucide-react";
‚ãÆ----
interface StatCard {
	label: string;
	value: string;
	change: string;
	isPositive: boolean;
	icon: any;
	color: string;
}
‚ãÆ----
interface Property {
	id: number;
	title: string;
	address: string;
	neighborhood: string;
	price: number;
	currency: string;
	type: string;
	operation: string;
	status: string;
	views: number;
	leads: number;
	createdAt: string;
	featured: boolean;
}
‚ãÆ----
const formatCurrency = (amount: number, currency: string) =>
‚ãÆ----
const getStatusColor = (status: string) =>
‚ãÆ----
const getActivityIcon = (type: string) =>
‚ãÆ----
<div className="flex-shrink-0 mt-1">
</file>

<file path="components/PropertyForm.tsx">
import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import { Save, X, Upload, Camera, Trash2, ArrowLeft, MapPin, DollarSign, Home as HomeIcon, Info } from "lucide-react";
‚ãÆ----
interface PropertyFormData {
	title: string;
	description: string;
	type: string;
	operation: string;
	price: number | "";
	currency: string;
	bedrooms: number | "";
	bathrooms: number | "";
	area: number | "";
	address: string;
	neighborhood: string;
	features: string;
	featured: boolean;
	status: string;
	images: File[];
}
‚ãÆ----
interface PropertyFormProps {
	property?: any; // Para modo edici√≥n
	mode: "create" | "edit";
}
‚ãÆ----
property?: any; // Para modo edici√≥n
‚ãÆ----
const validateForm = () =>
‚ãÆ----
const handleInputChange = (field: keyof PropertyFormData, value: any) =>
‚ãÆ----
const handleImageUpload = async (files: FileList) =>
‚ãÆ----
// Simular upload a Cloudinary
‚ãÆ----
// Aqu√≠ ir√≠a la l√≥gica real de upload a Cloudinary
// const response = await uploadToCloudinary(file)
// return response.secure_url
‚ãÆ----
// Por ahora, simulamos con URL local
‚ãÆ----
const removeImage = (index: number) =>
‚ãÆ----
const handleSubmit = async (e: React.FormEvent) =>
‚ãÆ----
// Preparar datos para env√≠o
‚ãÆ----
// Aqu√≠ ir√≠a la llamada a la API
‚ãÆ----
onChange=
‚ãÆ----
{/* Detalles */}
‚ãÆ----
{/* Ubicaci√≥n */}
‚ãÆ----
{/* Sidebar */}
‚ãÆ----
{/* Estado y Configuraci√≥n */}
‚ãÆ----
{/* Upload de Im√°genes */}
‚ãÆ----
{/* Drag & Drop Area */}
‚ãÆ----
accept="image/*"
									onChange={e => e.target.files && handleImageUpload(e.target.files)}
									className="hidden"
									id="image-upload"
								/>
								<label
									htmlFor="image-upload"
									className="inline-flex items-center px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 cursor-pointer transition-colors">
									<Upload className="w-4 h-4 mr-2" />
									{imageUploading ? "Subiendo..." : "Seleccionar Im√°genes"}
								</label>
							</div>

							{/* Image Preview */}
</file>

<file path="components/theme-provider.tsx">
import {
  ThemeProvider as NextThemesProvider,
  type ThemeProviderProps,
} from 'next-themes'
‚ãÆ----
export function ThemeProvider(
</file>

<file path="components/ui/badge.tsx">
import { cva, type VariantProps } from "class-variance-authority"
‚ãÆ----
import { cn } from "@/lib/utils"
‚ãÆ----
export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}
‚ãÆ----
<div className=
</file>

<file path="components/ui/button.tsx">
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
‚ãÆ----
import { cn } from "@/lib/utils"
‚ãÆ----
export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}
</file>

<file path="components/ui/card.tsx">
import { cn } from "@/lib/utils"
‚ãÆ----
className=
‚ãÆ----
<div ref=
</file>

<file path="components/ui/checkbox.tsx">
import { Check } from "lucide-react"
‚ãÆ----
import { cn } from "@/lib/utils"
‚ãÆ----
className=
</file>

<file path="components/ui/dialog.tsx">
import { X } from "lucide-react"
‚ãÆ----
import { cn } from "@/lib/utils"
‚ãÆ----
className=
</file>

<file path="components/ui/dropdown-menu.tsx">
import { Check, ChevronRight, Circle } from "lucide-react"
‚ãÆ----
import { cn } from "@/lib/utils"
‚ãÆ----
className=
</file>

<file path="components/ui/input.tsx">
import { cn } from "@/lib/utils"
‚ãÆ----
className=
</file>

<file path="components/ui/label.tsx">
import { cva, type VariantProps } from "class-variance-authority"
‚ãÆ----
import { cn } from "@/lib/utils"
</file>

<file path="components/ui/select.tsx">
import { Check, ChevronDown, ChevronUp } from "lucide-react"
‚ãÆ----
import { cn } from "@/lib/utils"
‚ãÆ----
className=
</file>

<file path="components/ui/sheet.tsx">
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"
‚ãÆ----
import { cn } from "@/lib/utils"
‚ãÆ----
interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}
‚ãÆ----
className=
</file>

<file path="components/ui/textarea.tsx">
import { cn } from "@/lib/utils"
‚ãÆ----
className=
</file>

<file path="components/ui/toast.tsx">
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"
‚ãÆ----
import { cn } from "@/lib/utils"
‚ãÆ----
type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>
‚ãÆ----
type ToastActionElement = React.ReactElement<typeof ToastAction>
</file>

<file path="components/ui/toaster.tsx">
import { Toast, ToastClose, ToastDescription, ToastProvider, ToastTitle, ToastViewport } from "@/components/ui/toast"
import { useToast } from "@/hooks/use-toast"
‚ãÆ----
export function Toaster()
</file>

<file path="hooks/use-is-client.tsx">
import { useState, useEffect } from 'react'
‚ãÆ----
export function useIsClient()
</file>

<file path="hooks/use-toast.ts">
import type { ToastActionElement, ToastProps } from "@/components/ui/toast"
‚ãÆ----
type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}
‚ãÆ----
function genId()
‚ãÆ----
type ActionType = typeof actionTypes
‚ãÆ----
type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }
‚ãÆ----
interface State {
  toasts: ToasterToast[]
}
‚ãÆ----
const addToRemoveQueue = (toastId: string) =>
‚ãÆ----
export const reducer = (state: State, action: Action): State =>
‚ãÆ----
function dispatch(action: Action)
‚ãÆ----
type Toast = Omit<ToasterToast, "id">
‚ãÆ----
function toast(props: Toast)
‚ãÆ----
const update = (props: ToasterToast)
const dismiss = () => dispatch(
‚ãÆ----
function useToast()
</file>

<file path="hooks/useContactActions.ts">
import type { Contact } from "./useContacts"
‚ãÆ----
export function useContactActions()
‚ãÆ----
const generateWhatsAppLink = (contact: Contact) =>
‚ãÆ----
const generateEmailLink = (contact: Contact) =>
‚ãÆ----
const generatePhoneLink = (contact: Contact) =>
‚ãÆ----
const copyToClipboard = async (text: string) =>
‚ãÆ----
const markAsContacted = async (
    contactId: number,
    updateContact: (id: number, updates: Partial<Contact>) => Promise<any>,
) =>
</file>

<file path="hooks/useContactFilters.ts">
import { useState, useMemo } from "react"
import type { Contact } from "./useContacts"
‚ãÆ----
export interface ContactFilters {
  search: string
  status: string
  source: string
  priority: string
  dateFrom: string
  dateTo: string
}
‚ãÆ----
export function useContactFilters(contacts: Contact[])
‚ãÆ----
const updateFilter = (key: keyof ContactFilters, value: string) =>
‚ãÆ----
const clearFilters = () =>
‚ãÆ----
const updateSort = (field: keyof Contact) =>
</file>

<file path="hooks/useContactMetrics.ts">
import { useMemo } from "react"
import type { Contact } from "./useContacts"
‚ãÆ----
export function useContactMetrics(contacts: Contact[])
</file>

<file path="hooks/useContacts.ts">
import { useState, useEffect } from "react"
‚ãÆ----
export interface Contact {
  id: number
  name: string
  email: string
  phone: string
  message: string
  property: string
  status: "new" | "contacted" | "qualified" | "converted"
  source: string
  createdAt: string
  notes?: string
  lastContact?: string
  nextAction?: string
  nextActionDate?: string
  priority: "low" | "medium" | "high"
  score: number
}
‚ãÆ----
export function useContacts()
‚ãÆ----
const fetchContacts = async () =>
‚ãÆ----
const updateContact = async (id: number, updates: Partial<Contact>) =>
‚ãÆ----
const deleteContact = async (id: number) =>
</file>

<file path="lib/cloudinary-server.ts">
import { v2 as cloudinary } from "cloudinary"
‚ãÆ----
export const uploadToCloudinary = async (
  file: string | Buffer,
  options: {
    folder?: string
    transformation?: any[]
    public_id?: string
  } = {},
) =>
‚ãÆ----
export const deleteFromCloudinary = async (publicId: string) =>
</file>

<file path="lib/cloudinary.ts">
export interface CloudinaryOptions {
  width?: number
  height?: number
  crop?: string
  quality?: string
  format?: string
  gravity?: string
  fetch_format?: string
}
‚ãÆ----
export function getOptimizedImageUrl(publicId: string, options: CloudinaryOptions =
‚ãÆ----
export function getVideoUrl(publicId: string, options: CloudinaryOptions =
</file>

<file path="lib/utils.ts">
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"
‚ãÆ----
export function cn(...inputs: ClassValue[])
</file>

<file path="middleware.ts">
import { NextResponse } from "next/server"
import type { NextRequest } from "next/server"
‚ãÆ----
export function middleware(request: NextRequest)
</file>

<file path="next.config.mjs">
/** @type {import('next').NextConfig} */
</file>

<file path="postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
</file>

<file path="services/leads.ts">
import { Lead, LeadInsert } from "@/lib/supabase";
‚ãÆ----
export class LeadsService
‚ãÆ----
static async createLead(data: Omit<LeadInsert, "id">): Promise<Lead>
‚ãÆ----
static async updateLead(id: number, data:
</file>

<file path="services/properties.ts">
import { supabase, type Property, type PropertyInsert, type PropertyUpdate, STATUS_MAP } from "@/lib/supabase"
‚ãÆ----
export interface PropertyFilters {
  property_type?: string
  operation_type?: string
  min_price?: number
  max_price?: number
  bedrooms?: number
  bathrooms?: number
  neighborhood?: string
  featured?: boolean
  status?: string
}
‚ãÆ----
export interface PropertySearchParams extends PropertyFilters {
  page?: number
  limit?: number
  search?: string
  sort_by?: "price" | "created_at" | "views"
  sort_order?: "asc" | "desc"
}
‚ãÆ----
export class PropertyService
‚ãÆ----
static async getProperties(params: PropertySearchParams =
‚ãÆ----
static async getPropertyById(id: number): Promise<Property | null>
‚ãÆ----
static async createProperty(property: PropertyInsert): Promise<Property>
‚ãÆ----
static async updateProperty(id: number, updates: PropertyUpdate): Promise<Property>
‚ãÆ----
static async deleteProperty(id: number): Promise<void>
‚ãÆ----
static async incrementViews(id: number): Promise<void>
‚ãÆ----
static async getFeaturedProperties(limit = 6): Promise<Property[]>
‚ãÆ----
static async getNeighborhoods(): Promise<string[]>
‚ãÆ----
static async getPropertyStats()
‚ãÆ----
export function getStatusDisplay(status: string): string
</file>

<file path="styles/globals.css">
@tailwind base;
@tailwind components;
@tailwind utilities;
‚ãÆ----
body {
‚ãÆ----
@layer utilities {
‚ãÆ----
.text-balance {
‚ãÆ----
@layer base {
‚ãÆ----
:root {
.dark {
‚ãÆ----
* {
‚ãÆ----
@apply border-border;
</file>

<file path="styles/premium-theme.css">
:root {
‚ãÆ----
* {
‚ãÆ----
html {
‚ãÆ----
body {
‚ãÆ----
.heading-display {
‚ãÆ----
.heading-hero {
‚ãÆ----
.heading-section {
‚ãÆ----
.heading-subsection {
‚ãÆ----
.text-lead {
‚ãÆ----
.text-body {
‚ãÆ----
.text-small {
‚ãÆ----
.text-caption {
‚ãÆ----
.btn-premium {
‚ãÆ----
.btn-premium-primary {
‚ãÆ----
.btn-premium-primary:hover {
‚ãÆ----
.btn-premium-outline {
‚ãÆ----
.btn-premium-outline:hover {
‚ãÆ----
.btn-premium-ghost {
‚ãÆ----
.btn-premium-ghost:hover {
‚ãÆ----
.card-premium {
‚ãÆ----
.card-premium:hover {
‚ãÆ----
.card-premium-image {
‚ãÆ----
.card-premium-image img {
‚ãÆ----
.card-premium:hover .card-premium-image img {
‚ãÆ----
.card-premium-content {
‚ãÆ----
.nav-premium {
‚ãÆ----
.nav-premium.scrolled {
‚ãÆ----
.nav-link {
‚ãÆ----
.nav-link::after {
‚ãÆ----
.nav-link:hover {
‚ãÆ----
.nav-link:hover::after {
‚ãÆ----
.container-premium {
‚ãÆ----
.section-premium {
‚ãÆ----
.grid-premium {
‚ãÆ----
.grid-premium-2 {
‚ãÆ----
.grid-premium-3 {
‚ãÆ----
.grid-premium-4 {
‚ãÆ----
.animate-fadeInUp {
‚ãÆ----
.animate-fadeIn {
‚ãÆ----
.overlay-gradient {
‚ãÆ----
.overlay-dark {
‚ãÆ----
.overlay-light {
‚ãÆ----
.hover-lift {
‚ãÆ----
.hover-lift:hover {
‚ãÆ----
.hover-scale {
‚ãÆ----
.hover-scale:hover {
‚ãÆ----
.text-elegant {
‚ãÆ----
.divider-premium {
‚ãÆ----
.mobile-hidden {
‚ãÆ----
.mobile-only {
‚ãÆ----
.tablet-up-only {
‚ãÆ----
.desktop-only {
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "target": "ES6",
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

<file path="app/admin/analytics/customers/page.tsx">
import CustomerInsights from '@/components/admin/CustomerInsights'
‚ãÆ----
export default function CustomerInsightsPage()
</file>

<file path="app/admin/analytics/layout.tsx">
import type React from "react"
import AnalyticsLayoutWrapper from "@/components/navigation/analytics-layout-wrapper"
‚ãÆ----
export default function AnalyticsLayout({
  children,
}: {
  children: React.ReactNode
})
</file>

<file path="app/admin/analytics/marketing/page.tsx">
import MarketingAnalytics from "@/components/admin/MarketingAnalytics"
‚ãÆ----
export default function AdminMarketingAnalyticsPage()
</file>

<file path="app/admin/analytics/properties/page.tsx">
import PropertyAnalytics from '@/components/admin/PropertyAnalytics'
‚ãÆ----
export default function PropertyAnalyticsPage()
</file>

<file path="app/admin/analytics/sales/page.tsx">
import SalesPerformance from "@/components/admin/SalesPerformance"
‚ãÆ----
export default function AdminSalesAnalyticsPage()
</file>

<file path="app/api/admin/readme/route.ts">
import { NextResponse } from 'next/server'
import { promises as fs } from 'fs'
import path from 'path'
‚ãÆ----
interface Section {
  title: string
  id: string
  icon: string
  level: number
}
‚ãÆ----
interface ApiEndpoint {
  method: string
  path: string
  description: string
}
‚ãÆ----
export async function GET()
‚ãÆ----
function parseMarkdownSections(content: string): Section[]
‚ãÆ----
// Assign appropriate icons based on section content
‚ãÆ----
function extractApiEndpoints(content: string): ApiEndpoint[]
‚ãÆ----
// Clean up description
‚ãÆ----
// Try to get description from context
</file>

<file path="app/api/analytics/gdpr/opt-out/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { AnalyticsService } from "@/services/analytics"
import { AnalyticsPrivacyError } from "@/types/analytics"
‚ãÆ----
export async function POST(request: NextRequest)
‚ãÆ----
export async function GET(request: NextRequest)
</file>

<file path="app/api/analytics/interaction/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { AnalyticsService } from "@/services/analytics"
import { type CreateUserInteractionEventInput } from "@/types/analytics"
‚ãÆ----
export async function POST(request: NextRequest)
‚ãÆ----
export async function PUT(request: NextRequest)
</file>

<file path="app/api/analytics/lead-generation/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { AnalyticsService } from "@/services/analytics"
import { type CreateLeadGenerationEventInput, type LeadSourceCode } from "@/types/analytics"
import { AnalyticsValidationError } from "@/types/analytics"
‚ãÆ----
export async function POST(request: NextRequest)
‚ãÆ----
export async function PUT(request: NextRequest)
</file>

<file path="app/api/analytics/property-view/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { AnalyticsService } from "@/services/analytics"
import { type CreatePropertyViewInput } from "@/types/analytics"
import { AnalyticsValidationError } from "@/types/analytics"
‚ãÆ----
export async function POST(request: NextRequest)
‚ãÆ----
export async function PUT(request: NextRequest)
</file>

<file path="app/api/analytics/session/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { AnalyticsService } from "@/services/analytics"
import { type CreateAnalyticsSessionInput } from "@/types/analytics"
‚ãÆ----
export async function POST(request: NextRequest)
‚ãÆ----
export async function PUT(request: NextRequest)
</file>

<file path="app/api/auth/create-user/route.ts">
import { NextRequest, NextResponse } from 'next/server'
import { supabaseAdmin } from '@/lib/supabase'
‚ãÆ----
export async function POST(request: NextRequest)
</file>

<file path="app/api/geocode/route.ts">
import { NextRequest, NextResponse } from 'next/server'
‚ãÆ----
export async function GET(request: NextRequest)
</file>

<file path="app/api/leads/[id]/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { supabase } from "@/lib/supabase"
‚ãÆ----
export async function GET(request: NextRequest,
‚ãÆ----
export async function PATCH(request: NextRequest,
‚ãÆ----
export async function DELETE(request: NextRequest,
</file>

<file path="app/api/reverse-geocode/route.ts">
import { NextRequest, NextResponse } from 'next/server'
‚ãÆ----
export async function GET(request: NextRequest)
</file>

<file path="app/api/settings/route.ts">
import { NextRequest, NextResponse } from 'next/server'
import { SettingsService } from '@/services/settings'
import { SiteSettingsInput } from '@/types/settings'
‚ãÆ----
export async function GET()
‚ãÆ----
export async function PATCH(request: NextRequest)
</file>

<file path="app/api/settings/upload/route.ts">
import { NextRequest, NextResponse } from 'next/server'
import { uploadToCloudinary } from '@/lib/cloudinary-server'
import { SettingsService } from '@/services/settings'
‚ãÆ----
export async function POST(request: NextRequest)
</file>

<file path="apply-analytics-fix.js">
console.log('‚ùå Error: Variables de entorno de Supabase no encontradas')
console.log('   Verifica que NEXT_PUBLIC_SUPABASE_URL y SUPABASE_SERVICE_ROLE_KEY est√©n configuradas')
process.exit(1)
‚ãÆ----
const supabase = createClient(supabaseUrl, supabaseServiceKey, {
‚ãÆ----
async function applyAnalyticsFix() {
console.log('üîß APLICANDO FIX DE FOREIGN KEYS DE ANALYTICS')
console.log('=============================================\n')
‚ãÆ----
console.log('üìã Paso 1: Verificando estado actual de constraints...')
‚ãÆ----
.from('information_schema.table_constraints')
.select('*')
.eq('constraint_type', 'FOREIGN KEY')
.like('table_name', 'analytics_%')
‚ãÆ----
console.log('‚ö†Ô∏è No se pudieron verificar constraints existentes:', constraintsError.message)
‚ãÆ----
console.log(`‚úÖ Encontrados ${constraints?.length || 0} foreign key constraints en tablas analytics`)
‚ãÆ----
console.log('\nüî® Paso 2: Ejecutando script de correcci√≥n...')
‚ãÆ----
const command = sqlCommands[i].trim()
‚ãÆ----
console.log(`   Ejecutando comando ${i + 1}/${sqlCommands.length}...`)
‚ãÆ----
const { error } = await supabase.rpc('exec_sql', { sql: command })
‚ãÆ----
console.log(`   ‚ö†Ô∏è Error en comando ${i + 1}: ${error.message}`)
‚ãÆ----
if (error.message.includes('does not exist') || error.message.includes('already exists')) {
console.log('     (Error ignorado - estado ya corregido)')
‚ãÆ----
console.log(`   ‚ùå Fallo cr√≠tico en comando ${i + 1}:`, cmdError.message)
‚ãÆ----
await new Promise(resolve => setTimeout(resolve, 100))
‚ãÆ----
console.log(`\nüìä Resumen: ${successCount} comandos exitosos, ${errorCount} errores`)
‚ãÆ----
console.log('\nüîÑ Paso 3: Actualizando funciones PostgreSQL...')
‚ãÆ----
const { error } = await supabase.rpc('exec_sql', { sql: func.sql })
‚ãÆ----
console.log(`   ‚ùå Error actualizando funci√≥n ${func.name}: ${error.message}`)
‚ãÆ----
console.log(`   ‚úÖ Funci√≥n ${func.name} actualizada`)
‚ãÆ----
console.log(`   ‚ùå Fallo cr√≠tico actualizando ${func.name}:`, funcError.message)
‚ãÆ----
console.log('\nüéâ FIX DE ANALYTICS COMPLETADO')
console.log('==============================')
console.log('‚úÖ Foreign key constraints corregidos')
console.log('‚úÖ Tipos de columna actualizados')
console.log('‚úÖ Funciones PostgreSQL actualizadas')
console.log('\nüß™ Ahora puedes ejecutar el test de analytics nuevamente')
‚ãÆ----
console.log('\nüí• ERROR DURANTE LA APLICACI√ìN DEL FIX')
console.log('===================================')
console.log('‚ùå Error:', error.message)
console.log('‚ùå Stack:', error.stack)
‚ãÆ----
async function applyAnalyticsFixDirect() {
console.log('üîß APLICANDO FIX DE FOREIGN KEYS DE ANALYTICS (M√âTODO DIRECTO)')
console.log('=============================================================\n')
‚ãÆ----
console.log('üìã Verificando tablas existentes...')
‚ãÆ----
.from('information_schema.tables')
.select('table_name')
.eq('table_schema', 'public')
‚ãÆ----
throw new Error(`Error verificando tablas: ${tablesError.message}`)
‚ãÆ----
const analyticsTablesFound = tables?.map(t => t.table_name) || []
console.log(`‚úÖ Encontradas ${analyticsTablesFound.length} tablas de analytics:`, analyticsTablesFound.join(', '))
‚ãÆ----
throw new Error('No se encontraron tablas de analytics. Verifica que el esquema est√© instalado.')
‚ãÆ----
console.log('\nüéØ El fix ser√° aplicado manualmente a trav√©s de la interfaz de Supabase')
console.log('üìã Para aplicar el fix:')
console.log('1. Ve a https://uutffduomvmyuqmeqjbw.supabase.co/project/uutffduomvmyuqmeqjbw/sql')
console.log('2. Ejecuta el contenido del archivo fix-analytics-foreign-keys.sql')
console.log('3. O usa supabase CLI: supabase db push --db-url "postgresql://..."')
‚ãÆ----
console.log('\nüí• ERROR DURANTE LA VERIFICACI√ìN')
console.log('===============================')
‚ãÆ----
if (process.argv.includes('--direct')) {
applyAnalyticsFixDirect().catch(console.error)
‚ãÆ----
applyAnalyticsFix().catch(console.error)
</file>

<file path="apply-rls-fix.js">
require('dotenv').config()
‚ãÆ----
console.log('‚ùå Error: Variables de entorno de Supabase no encontradas')
console.log('   Aseg√∫rate de que NEXT_PUBLIC_SUPABASE_URL y SUPABASE_SERVICE_ROLE_KEY est√©n en .env')
process.exit(1)
‚ãÆ----
const supabase = createClient(supabaseUrl, supabaseServiceKey, {
‚ãÆ----
async function applyRLSFix() {
console.log('üîß APLICANDO FIX DE ROW LEVEL SECURITY')
console.log('===================================\n')
‚ãÆ----
console.log('üìã Paso 1: Verificando estado actual de RLS...')
‚ãÆ----
console.log(`üéØ Tablas a modificar: ${analyticsTables.join(', ')}`)
‚ãÆ----
console.log('\nüî® Paso 2: Desactivando RLS en tablas de analytics...')
‚ãÆ----
console.log(`   Desactivando RLS en ${table}...`)
‚ãÆ----
.from('pg_class')
.select('*')
.limit(1)
‚ãÆ----
console.log(`   ‚ö†Ô∏è No se puede acceder directamente. Intentando m√©todo alternativo...`)
‚ãÆ----
console.log(`   ‚úÖ RLS procesado para ${table}`)
‚ãÆ----
console.log(`   ‚ùå Error en tabla ${table}:`, tableError.message)
‚ãÆ----
console.log('\nüß™ Paso 3: Testeando inserci√≥n directa...')
‚ãÆ----
session_id: crypto.randomUUID(),
ip_hash: 'test_hash_' + Math.random().toString(36).substring(2, 15),
‚ãÆ----
console.log(`   Intentando insertar sesi√≥n de prueba: ${testSessionData.session_id}`)
‚ãÆ----
.from('analytics_sessions')
.insert([testSessionData])
.select()
‚ãÆ----
console.log('   ‚ùå Inserci√≥n directa fall√≥:', insertError.message)
‚ãÆ----
if (insertError.message.includes('row-level security policy')) {
console.log('\nüéØ PROBLEMA CONFIRMADO: RLS est√° bloqueando inserciones')
console.log('üìã SOLUCIONES DISPONIBLES:')
console.log('1. Desactivar RLS temporalmente (para testing)')
console.log('2. Configurar pol√≠ticas RLS apropiadas (para producci√≥n)')
console.log('3. Usar service role key con bypass RLS')
‚ãÆ----
console.log('\nüîß APLICANDO SOLUCI√ìN TEMPORAL...')
‚ãÆ----
console.log('   üìù Creando pol√≠ticas RLS permisivas temporales...')
console.log('   ‚ö†Ô∏è NOTA: Estas pol√≠ticas son SOLO para testing')
‚ãÆ----
console.log('\nüìã PROCEDIMIENTO MANUAL REQUERIDO:')
console.log('1. Ve a tu dashboard de Supabase: https://uutffduomvmyuqmeqjbw.supabase.co')
console.log('2. Navega a SQL Editor')
console.log('3. Ejecuta este SQL:')
console.log(policySQL)
console.log('\n4. O alternativamente, desactiva RLS completamente para testing:')
console.log('   ALTER TABLE analytics_sessions DISABLE ROW LEVEL SECURITY;')
console.log('   ALTER TABLE analytics_user_interactions DISABLE ROW LEVEL SECURITY;')
console.log('   ALTER TABLE analytics_property_views DISABLE ROW LEVEL SECURITY;')
console.log('   ALTER TABLE analytics_lead_generation DISABLE ROW LEVEL SECURITY;')
‚ãÆ----
console.log('   ‚ùå Error diferente:', insertError)
‚ãÆ----
console.log('   ‚úÖ Inserci√≥n exitosa! RLS no est√° bloqueando')
console.log(`   üìä Datos insertados:`, insertResult)
‚ãÆ----
.delete()
.eq('session_id', testSessionData.session_id)
‚ãÆ----
console.log('   üßπ Datos de prueba limpiados')
‚ãÆ----
console.log('\nüéâ DIAGN√ìSTICO DE RLS COMPLETADO')
console.log('===============================')
‚ãÆ----
console.log('\nüí• ERROR DURANTE EL FIX DE RLS')
console.log('=============================')
console.log('‚ùå Error:', error.message)
console.log('‚ùå Stack:', error.stack)
‚ãÆ----
async function testAnalyticsWithCurrentRLS() {
console.log('üîç TESTING ANALYTICS CON RLS ACTUAL')
console.log('==================================\n')
‚ãÆ----
console.log('üìä Probando inserci√≥n con service role...')
‚ãÆ----
ip_hash: 'bypass_test_' + Date.now(),
‚ãÆ----
.insert([testData])
‚ãÆ----
console.log('‚ùå Service role tambi√©n est√° bloqueado:', error.message)
‚ãÆ----
console.log('‚úÖ Service role funciona correctamente')
console.log(`   Session insertada: ${data[0]?.session_id}`)
‚ãÆ----
.eq('session_id', testData.session_id)
‚ãÆ----
console.log('‚ùå Error en test:', error.message)
‚ãÆ----
console.log('üöÄ Iniciando fix de RLS para analytics...\n')
‚ãÆ----
if (process.argv.includes('--test-only')) {
testAnalyticsWithCurrentRLS().then(success => {
‚ãÆ----
console.log('\n‚úÖ El sistema deber√≠a funcionar correctamente')
‚ãÆ----
console.log('\n‚ùå Se requiere aplicar el fix de RLS')
‚ãÆ----
}).catch(console.error)
‚ãÆ----
applyRLSFix().catch(console.error)
</file>

<file path="claude_desktop_config_example.json">
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-filesystem",
        "C:\\Proyectos\\marconi\\landpage-marconi"
      ],
      "env": {
        "NODE_ENV": "production"
      }
    },
    "brave-search": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-brave-search"],
      "env": {
        "BRAVE_API_KEY": "YOUR_BRAVE_API_KEY_HERE"
      }
    },
    "postgres": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-postgres"],
      "env": {
        "POSTGRES_CONNECTION_STRING": "postgresql://user:password@localhost:5432/database"
      }
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "your_github_token_here"
      }
    },
    "puppeteer": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-puppeteer"]
    },
    "sqlite": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-sqlite",
        "--db-path",
        "C:\\path\\to\\your\\database.db"
      ]
    },
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    }
  },
  "globalShortcut": "CommandOrControl+Shift+Space"
}
</file>

<file path="components/admin/CustomerInsights.tsx">
import React, { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { KPICard } from '@/components/ui/kpi-card'
import { Badge } from '@/components/ui/badge'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import {
  AnalyticsDashboardLayout,
  WidgetGrid,
  buildAnalyticsBreadcrumbs
} from '@/components/layouts'
import {
  TrendingUp,
  TrendingDown,
  Users,
  UserCheck,
  Heart,
  DollarSign,
  Clock,
  RefreshCw,
  BarChart3,
  PieChart,
  Target,
  Star,
  Crown,
  User,
  UserPlus,
  Repeat,
  ArrowRight,
  Phone,
  Mail,
  MessageCircle,
  Calendar,
  Activity,
  Award
} from 'lucide-react'
import { useAnalyticsDashboard } from '@/hooks/useAnalyticsDashboard'
import { useRealTimeUpdates } from '@/hooks/useRealTimeUpdates'
‚ãÆ----
interface CustomerKPIs {
  totalCustomers: {
    value: number
    newThisMonth: number
    returningCustomers: number
    churnRate: number
  }
  avgLifetimeValue: {
    value: number
    change: number
    highValueCustomers: number
  }
  customerSatisfaction: {
    value: number
    change: number
    npsScore: number
  }
  retentionRate: {
    value: number
    change: number
    benchmark: number
  }
}
‚ãÆ----
interface CustomerSegment {
  id: string
  name: string
  description: string
  customerCount: number
  percentage: number
  avgValue: number
  avgTransactions: number
  retentionRate: number
  growthRate: number
  color: string
  priority: 'high' | 'medium' | 'low'
  characteristics: string[]
}
‚ãÆ----
interface CustomerJourney {
  stage: string
  customers: number
  conversionRate: number
  avgTimeInStage: number
  dropOffRate: number
  topActions: string[]
  nextStageConversion: number
}
‚ãÆ----
interface CustomerSegmentationProps {
  period: string
  loading: boolean
}
‚ãÆ----
const getPriorityBadge = (priority: string) =>
</file>

<file path="components/admin/LeafletMapComponent.tsx">
import React, { useEffect, useState } from 'react'
import { MapContainer, TileLayer, Marker, useMapEvents } from 'react-leaflet'
import { createPropertyMarkerIcon, ARGENTINA_BOUNDS } from '@/lib/map-config'
import { toast } from '@/hooks/use-toast'
‚ãÆ----
interface LeafletMapComponentProps {
  center: [number, number]
  coordinates: [number, number] | null
  onLocationChange: (lat: number, lng: number) => void
  className?: string
}
‚ãÆ----
function LocationSelector({ onLocationChange }: {
  onLocationChange: (lat: number, lng: number) => void
})
‚ãÆ----
click(e)
</file>

<file path="components/admin/PropertiesPage.backup.tsx">

</file>

<file path="components/admin/ReadmeDocumentation.tsx">
import { useState, useEffect } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Badge } from "@/components/ui/badge"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import {
  BookOpen,
  Search,
  FileText,
  Hash,
  Settings,
  Database,
  Shield,
  BarChart3,
  Code,
  Terminal,
  ArrowRight,
  ChevronRight,
  Home
} from "lucide-react"
import Link from "next/link"
‚ãÆ----
interface Section {
  title: string
  id: string
  icon: JSX.Element
  level: number
}
‚ãÆ----
interface ApiEndpoint {
  method: string
  path: string
  description: string
}
‚ãÆ----
const loadReadmeContent = async () =>
‚ãÆ----
// Fallback: load content directly from the file
‚ãÆ----
const loadFallbackContent = () =>
‚ãÆ----
// Simulate loading the README content for demo purposes
‚ãÆ----
const getMethodColor = (method: string) =>
</file>

<file path="components/admin/SalesPerformance.tsx">
import React, { useState, useEffect } from 'react'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { KPICard } from '@/components/ui/kpi-card'
import { Badge } from '@/components/ui/badge'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import {
  AnalyticsDashboardLayout,
  WidgetGrid,
  buildAnalyticsBreadcrumbs
} from '@/components/layouts'
import {
  TrendingUp,
  Users,
  Building,
  Target,
  DollarSign,
  Clock,
  RefreshCw,
  ChevronRight,
  BarChart3,
  Layers,
  ArrowUpRight,
  ArrowDownRight
} from 'lucide-react'
import { useAnalyticsDashboard } from '@/hooks/useAnalyticsDashboard'
import { useRealTimeUpdates } from '@/hooks/useRealTimeUpdates'
‚ãÆ----
interface SalesKPIs {
  totalRevenue: {
    value: number
    change: number
    target: number
  }
  leadsConverted: {
    value: number
    change: number
    target: number
  }
  avgSaleValue: {
    value: number
    change: number
    benchmark: number
  }
  salesCycleTime: {
    value: number
    change: number
    target: number
  }
}
‚ãÆ----
interface PipelineStage {
  id: string
  name: string
  count: number
  value: number
  conversionRate: number
  color: string
}
‚ãÆ----
interface AgentPerformance {
  id: string
  name: string
  avatar: string
  salesCount: number
  revenue: number
  conversionRate: number
  avgSaleValue: number
  rank: number
  change: number
}
‚ãÆ----
interface PropertyRanking {
  id: string
  title: string
  image: string
  leads: number
  sales: number
  conversionRate: number
  revenue: number
  trend: number
}
‚ãÆ----
interface SalesPipelineProps {
  data: PipelineStage[]
  loading: boolean
}
‚ãÆ----
<span className="font-semibold text-bone-white">
‚ãÆ----
</div>
</file>

<file path="components/AnalyticsInitializer.tsx">
import { useEffect } from 'react'
import { getAnalyticsClient } from '@/lib/analytics-client'
‚ãÆ----
export default function AnalyticsInitializer()
</file>

<file path="components/Footer.tsx">
import React from 'react'
import Image from 'next/image'
import Link from 'next/link'
‚ãÆ----
export default function Footer()
</file>

<file path="components/layouts/examples/analytics-dashboard-demo.tsx">
import React from 'react'
import {
  AnalyticsDashboardLayout,
  ModuleContainer,
  WidgetGrid,
  SidebarNavigation,
  FilterBar,
  ResponsiveWrapper,
  buildAnalyticsBreadcrumbs,
  useAnalyticsLayout
} from '@/components/layouts'
‚ãÆ----
import { KPICard } from '@/components/ui/kpi-card'
import { ChartContainer } from '@/components/ui/chart-container'
import { DataTable } from '@/components/ui/data-table'
import { TrendIndicator } from '@/components/ui/trend-indicator'
import { MetricsBadge } from '@/components/ui/metrics-badge'
import { LoadingSkeleton } from '@/components/ui/loading-skeleton'
‚ãÆ----
import {
  BarChart3,
  TrendingUp,
  Users,
  Building,
  Target,
  Plus,
  Download,
  Filter,
  Calendar
} from 'lucide-react'
import { Button } from '@/components/ui/button'
‚ãÆ----
desktop=
mobile=
</file>

<file path="components/layouts/examples/index.tsx">

</file>

<file path="components/layouts/examples/marketing-module-demo.tsx">
import React from 'react'
import {
  AnalyticsDashboardLayout,
  ModuleContainer,
  WidgetGrid,
  ContentGrid,
  buildAnalyticsBreadcrumbs,
  useAnalyticsLayout,
  LAYOUT_PRESETS
} from '@/components/layouts'
‚ãÆ----
import { KPICard } from '@/components/ui/kpi-card'
import { ChartContainer } from '@/components/ui/chart-container'
import { DataTable } from '@/components/ui/data-table'
import { TrendIndicator } from '@/components/ui/trend-indicator'
import { MetricsBadge } from '@/components/ui/metrics-badge'
‚ãÆ----
import { Target, Users, Mail, Globe, TrendingUp, Eye, MousePointer } from 'lucide-react'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
</file>

<file path="components/layouts/examples/sales-module-demo.tsx">
import React from 'react'
import {
  AnalyticsDashboardLayout,
  ModuleContainer,
  WidgetGrid,
  ChartGrid,
  buildAnalyticsBreadcrumbs,
  useAnalyticsLayout,
  LAYOUT_PRESETS
} from '@/components/layouts'
‚ãÆ----
import { KPICard } from '@/components/ui/kpi-card'
import { ChartContainer } from '@/components/ui/chart-container'
import { DataTable } from '@/components/ui/data-table'
import { TrendIndicator } from '@/components/ui/trend-indicator'
import { MetricsBadge } from '@/components/ui/metrics-badge'
‚ãÆ----
import { TrendingUp, Target, Users, DollarSign, Calendar, Filter } from 'lucide-react'
import { Button } from '@/components/ui/button'
</file>

<file path="components/layouts/filter-bar.tsx">
import React, { useState } from 'react'
import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import {
  Calendar,
  Filter,
  RefreshCw,
  X,
  ChevronDown,
  CalendarDays
} from 'lucide-react'
‚ãÆ----
export interface DateRange {
  from: Date | undefined
  to: Date | undefined
}
‚ãÆ----
export interface QuickFilter {
  id: string
  label: string
  value: string | number
  active?: boolean
  count?: number
}
‚ãÆ----
export interface FilterOption {
  id: string
  label: string
  type: 'select' | 'input' | 'date' | 'multiselect'
  options?: Array<{ value: string; label: string }>
  value?: any
  placeholder?: string
}
‚ãÆ----
interface FilterBarProps {
  dateRange?: DateRange
  onDateRangeChange?: (range: DateRange) => void
  quickFilters?: QuickFilter[]
  onQuickFilterToggle?: (filterId: string) => void
  customFilters?: FilterOption[]
  onCustomFilterChange?: (filterId: string, value: any) => void
  onReset?: () => void
  className?: string
  compact?: boolean
  hideQuickFilters?: boolean
  hideDateRange?: boolean
}
‚ãÆ----
const handleDateRangeSelect = (days: number) =>
‚ãÆ----
{/* Main Filter Row */}
‚ãÆ----
{/* Date Range Picker */}
‚ãÆ----
{/* Aqu√≠ ir√≠a un date picker real como react-day-picker */}
‚ãÆ----
{/* Advanced Filters Toggle */}
‚ãÆ----
{/* Actions */}
‚ãÆ----
{/* Quick Filters */}
‚ãÆ----
{/* Advanced Filters */}
‚ãÆ----
onChange=
‚ãÆ----
// Preset filters para diferentes m√≥dulos
</file>

<file path="components/layouts/module-container.tsx">
import React from 'react'
import { cn } from '@/lib/utils'
import { LucideIcon } from 'lucide-react'
import { Card, CardContent, CardHeader } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
‚ãÆ----
type ModuleType = 'overview' | 'sales' | 'marketing' | 'properties' | 'customers'
‚ãÆ----
interface ModuleContainerProps {
  module: ModuleType
  title: string
  subtitle?: string
  icon?: LucideIcon
  children: React.ReactNode
  headerActions?: React.ReactNode
  footerActions?: React.ReactNode
  badge?: string | number
  variant?: 'default' | 'bordered' | 'elevated'
  className?: string
}
‚ãÆ----
<div className=
</file>

<file path="components/layouts/responsive-wrapper.tsx">
import React from 'react'
import { cn } from '@/lib/utils'
import { useResponsive, type Breakpoint } from '@/hooks/useResponsive'
‚ãÆ----
export type ResponsiveBreakpoint = 'mobile' | 'tablet' | 'desktop' | 'wide'
‚ãÆ----
interface ResponsiveWrapperProps {
  children: React.ReactNode
  mobile?: React.ReactNode
  tablet?: React.ReactNode
  desktop: React.ReactNode
  wide?: React.ReactNode
  className?: string
  fallbackToChildren?: boolean
}
‚ãÆ----
interface ResponsiveContainerProps {
  children: React.ReactNode
  breakpoint: ResponsiveBreakpoint
  className?: string
}
‚ãÆ----
interface ResponsiveShowProps {
  children: React.ReactNode
  on: ResponsiveBreakpoint | ResponsiveBreakpoint[]
  className?: string
}
‚ãÆ----
interface ResponsiveHideProps {
  children: React.ReactNode
  on: ResponsiveBreakpoint | ResponsiveBreakpoint[]
  className?: string
}
‚ãÆ----
export function useBreakpoint(): ResponsiveBreakpoint
‚ãÆ----
export function useIsMobile(): boolean
‚ãÆ----
export function useIsTabletOrMobile(): boolean
‚ãÆ----
export function useIsDesktopOrWide(): boolean
‚ãÆ----
export function ResponsiveWrapper({
  children,
  mobile,
  tablet,
  desktop,
  wide,
  className,
  fallbackToChildren = true
}: ResponsiveWrapperProps)
‚ãÆ----
const renderContent = () =>
‚ãÆ----
<div className=
‚ãÆ----
export function ResponsiveContainer({
  children,
  breakpoint,
  className
}: ResponsiveContainerProps)
‚ãÆ----
export function ResponsiveShow({
  children,
  on,
  className
}: ResponsiveShowProps)
‚ãÆ----
export function ResponsiveHide({
  children,
  on,
  className
}: ResponsiveHideProps)
‚ãÆ----
export function MobileOnly({
  children,
  className
}: {
  children: React.ReactNode
  className?: string
})
‚ãÆ----
export function TabletOnly({
  children,
  className
}: {
  children: React.ReactNode
  className?: string
})
‚ãÆ----
export function DesktopOnly({
  children,
  className
}: {
  children: React.ReactNode
  className?: string
})
‚ãÆ----
export function WideOnly({
  children,
  className
}: {
  children: React.ReactNode
  className?: string
})
‚ãÆ----
export function HideOnMobile({
  children,
  className
}: {
  children: React.ReactNode
  className?: string
})
‚ãÆ----
export function HideOnDesktop({
  children,
  className
}: {
  children: React.ReactNode
  className?: string
})
‚ãÆ----
export function AdaptiveLayout({
  sidebar,
  children,
  className,
  sidebarPosition = 'left',
  mobileLayout = 'stack'
}: {
  sidebar: React.ReactNode
  children: React.ReactNode
  className?: string
  sidebarPosition?: 'left' | 'right'
  mobileLayout?: 'stack' | 'tabs' | 'drawer'
})
‚ãÆ----
export function AnalyticsGrid({
  children,
  className,
  variant = 'balanced'
}: {
  children: React.ReactNode
  className?: string
  variant?: 'compact' | 'balanced' | 'spacious'
})
‚ãÆ----
export function ResponsiveKPIGrid({
  children,
  className
}: {
  children: React.ReactNode
  className?: string
})
‚ãÆ----
export function ResponsiveChartGrid({
  children,
  layout = 'balanced',
  className
}: {
  children: React.ReactNode
  layout?: 'single' | 'split' | 'balanced' | 'focus'
  className?: string
})
‚ãÆ----
const getLayoutClasses = () =>
</file>

<file path="components/layouts/sidebar-navigation.tsx">
import React, { useState } from 'react'
import { cn } from '@/lib/utils'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { ScrollArea } from '@/components/ui/scroll-area'
import { Separator } from '@/components/ui/separator'
import {
  ChevronLeft,
  ChevronRight,
  BarChart3,
  TrendingUp,
  Users,
  Building,
  Target,
  Menu,
  X
} from 'lucide-react'
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet'
‚ãÆ----
interface NavigationItem {
  id: string
  label: string
  icon: React.ComponentType<{ className?: string }>
  href: string
  badge?: number
  active?: boolean
  children?: NavigationItem[]
}
‚ãÆ----
interface SidebarNavigationProps {
  items: NavigationItem[]
  collapsed?: boolean
  onToggle?: () => void
  defaultCollapsed?: boolean
  className?: string
}
‚ãÆ----
const handleToggle = () =>
‚ãÆ----
const toggleExpanded = (itemId: string) =>
‚ãÆ----
onToggleExpanded=
‚ãÆ----
<ChevronRight className=
</file>

<file path="components/layouts/widget-grid.tsx">
import React from 'react'
import { cn } from '@/lib/utils'
‚ãÆ----
interface WidgetGridProps {
  children: React.ReactNode
  columns?: 'auto' | 1 | 2 | 3 | 4 | 6
  gap?: 'sm' | 'md' | 'lg'
  responsive?: boolean
  className?: string
  density?: 'compact' | 'comfortable' | 'spacious'
}
‚ãÆ----
export function WidgetGrid({
  children,
  columns = 'auto',
  gap = 'md',
  responsive = true,
  className,
  density = 'comfortable'
}: WidgetGridProps)
‚ãÆ----
className=
‚ãÆ----
export function KPIGrid({
  children,
  className
}: {
  children: React.ReactNode
  className?: string
})
‚ãÆ----
export function ChartGrid({
  children,
  layout = 'balanced',
  className
}: {
  children: React.ReactNode
  layout?: 'single' | 'split' | 'balanced' | 'focus'
  className?: string
})
‚ãÆ----
<div className=
‚ãÆ----
export function ContentGrid({
  children,
  sidebar,
  sidebarPosition = 'right',
  sidebarSize = '1/3',
  className
}: {
  children: React.ReactNode
  sidebar?: React.ReactNode
  sidebarPosition?: 'left' | 'right'
  sidebarSize?: '1/4' | '1/3' | '2/5'
  className?: string
})
</file>

<file path="components/LeadSourceSelector.tsx">
import { useState, useEffect } from "react"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Phone, MessageCircle, Mail, Globe, Users, Building2, Star, Zap } from "lucide-react"
import { type LeadSourceCode } from "@/types/analytics"
‚ãÆ----
interface LeadSource {
  id: number
  name: LeadSourceCode
  display_name: string
  description: string | null
  icon_name: string | null
  is_active: boolean
  created_at: string
}
‚ãÆ----
interface LeadSourceSelectorProps {
  value?: LeadSourceCode
  onChange: (sourceCode: LeadSourceCode) => void
  showDescription?: boolean
  variant?: 'select' | 'cards' | 'badges'
  disabled?: boolean
  className?: string
}
‚ãÆ----
const getSourceIcon = (iconName: string | null) =>
‚ãÆ----
const getSourceColor = (sourceCode: LeadSourceCode) =>
‚ãÆ----
// Fetch lead sources from API if available
‚ãÆ----
const fetchLeadSources = async () =>
‚ãÆ----
// This would normally fetch from /api/analytics/lead-sources
// For now, we use the default sources
‚ãÆ----
const handleSourceChange = (sourceCode: LeadSourceCode) =>
‚ãÆ----
const reset = () =>
‚ãÆ----
const fetchStats = async () =>
‚ãÆ----
// This would fetch from /api/analytics/lead-sources/stats
// For now, we'll use mock data
‚ãÆ----
</file>

<file path="components/navigation/analytics-layout-wrapper.tsx">
import React, { useState } from 'react'
import { usePathname } from 'next/navigation'
import { cn } from '@/lib/utils'
import { SidebarNavigation } from '@/components/layouts/sidebar-navigation'
import MobileBottomNav from './mobile-bottom-nav'
import CommandPalette from './command-palette'
import {
  BarChart3,
  TrendingUp,
  Target,
  Building,
  Users
} from 'lucide-react'
‚ãÆ----
interface NavigationItem {
  id: string
  label: string
  icon: React.ComponentType<{ className?: string }>
  href: string
  badge?: number
  active?: boolean
  children?: NavigationItem[]
}
‚ãÆ----
interface AnalyticsLayoutWrapperProps {
  children: React.ReactNode
}
</file>

<file path="components/navigation/command-palette.tsx">
import React, { useEffect, useCallback } from 'react'
import { useRouter } from 'next/navigation'
import { CommandDialog, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList, CommandSeparator } from '@/components/ui/command'
import { useCommandPalette, useRecentSearches } from '@/stores/navigation-store'
import { toast } from 'sonner'
import {
  BarChart3,
  TrendingUp,
  Target,
  Building,
  Users,
  RefreshCw,
  Download,
  FileText,
  Clock,
  HelpCircle,
  Sparkles
} from 'lucide-react'
‚ãÆ----
interface CommandItem {
  id: string
  label: string
  description?: string
  icon: React.ComponentType<{ className?: string }>
  keywords?: string[]
  onSelect: () => void
  shortcut?: string
}
‚ãÆ----
const handleKeyDown = (e: KeyboardEvent) =>
</file>

<file path="components/navigation/index.ts">

</file>

<file path="components/navigation/mobile-bottom-nav.tsx">
import React from 'react'
import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { cn } from '@/lib/utils'
import { Badge } from '@/components/ui/badge'
import {
  BarChart3,
  TrendingUp,
  Target,
  Building,
  Users
} from 'lucide-react'
‚ãÆ----
interface MobileNavItem {
  id: string
  label: string
  shortLabel: string
  href: string
  icon: React.ComponentType<{ className?: string }>
  badge?: number
}
‚ãÆ----
const getActiveItem = (): string =>
‚ãÆ----
className=
</file>

<file path="components/navigation/module-tabs.tsx">
import React from 'react'
import { usePathname, useRouter } from 'next/navigation'
import { cn } from '@/lib/utils'
import { Badge } from '@/components/ui/badge'
import {
  BarChart3,
  TrendingUp,
  Target,
  Building,
  Users
} from 'lucide-react'
‚ãÆ----
interface ModuleTab {
  id: string
  label: string
  href: string
  icon: React.ComponentType<{ className?: string }>
  badge?: number
}
‚ãÆ----
interface ModuleTabsProps {
  className?: string
}
‚ãÆ----
const getActiveTab = (): string =>
‚ãÆ----
const handleTabClick = (href: string) =>
‚ãÆ----
className=
</file>

<file path="components/PropertyDetailMap.tsx">
import React, { useEffect, useState } from 'react'
import dynamic from 'next/dynamic'
import { Property } from '@/lib/supabase'
import { geocodeAddress, formatAddress, createPropertyMarkerIcon, RECONQUISTA_CENTER } from '@/lib/map-config'
import { Button } from '@/components/ui/button'
import { ExternalLink } from 'lucide-react'
‚ãÆ----
interface PropertyDetailMapProps {
  property: Property
  className?: string
}
‚ãÆ----
const getCoordinates = async () =>
‚ãÆ----
const handleOpenInGoogleMaps = () =>
</file>

<file path="components/PropertyMiniMap.tsx">
import React, { useEffect, useState } from 'react'
import dynamic from 'next/dynamic'
import { Property } from '@/lib/supabase'
import { geocodeAddress, formatAddress, RECONQUISTA_CENTER } from '@/lib/map-config'
‚ãÆ----
interface PropertyMiniMapProps {
  property: Pick<Property, 'address' | 'neighborhood' | 'city' | 'title'>
  className?: string
}
‚ãÆ----
const getCoordinates = async () =>
</file>

<file path="components/PropertyViewTracker.tsx">
import { useEffect, useRef } from "react"
import { usePropertyAnalytics } from "@/hooks/useAnalytics"
‚ãÆ----
interface PropertyViewTrackerProps {
  propertyId: number
  title?: string
  enableScrollTracking?: boolean
  enableTimeTracking?: boolean
  onViewTracked?: (eventId: string | null) => void
  children?: React.ReactNode
}
‚ãÆ----
export function PropertyViewTracker({
  propertyId,
  title,
  enableScrollTracking = true,
  enableTimeTracking = true,
  onViewTracked,
  children
}: PropertyViewTrackerProps)
‚ãÆ----
interface ContactTrackerProps {
  propertyId: number
  type: 'whatsapp' | 'phone' | 'email' | 'form'
  children: React.ReactElement
  metadata?: Record<string, any>
}
‚ãÆ----
export function ContactTracker({
  propertyId,
  type,
  children,
  metadata
}: ContactTrackerProps)
‚ãÆ----
const handleClick = () =>
‚ãÆ----
interface ImageGalleryTrackerProps {
  propertyId: number
  totalImages: number
  children: React.ReactNode
}
‚ãÆ----
export function ImageGalleryTracker({
  propertyId,
  totalImages,
  children
}: ImageGalleryTrackerProps)
‚ãÆ----
const trackImageView = (imageIndex: number) =>
‚ãÆ----
import React from 'react'
‚ãÆ----
interface ImageGalleryContextValue {
  trackImageView: (imageIndex: number) => void
}
‚ãÆ----
export function useImageGalleryTracker()
‚ãÆ----
interface ScrollMilestoneTrackerProps {
  propertyId: number
  milestones?: number[]
}
‚ãÆ----
export function ScrollMilestoneTracker({
  propertyId,
  milestones = [25, 50, 75, 100]
}: ScrollMilestoneTrackerProps)
‚ãÆ----
const handleScroll = () =>
‚ãÆ----
interface TimeMilestoneTrackerProps {
  propertyId: number
  milestones?: number[]
}
‚ãÆ----
export function TimeMilestoneTracker({
  propertyId,
  milestones = [30, 60, 120, 300]
}: TimeMilestoneTrackerProps)
‚ãÆ----
interface ComprehensivePropertyTrackerProps {
  propertyId: number
  title?: string
  totalImages?: number
  enableScrollMilestones?: boolean
  enableTimeMilestones?: boolean
  scrollMilestones?: number[]
  timeMilestones?: number[]
  onViewTracked?: (eventId: string | null) => void
  children?: React.ReactNode
}
‚ãÆ----
export function ComprehensivePropertyTracker({
  propertyId,
  title,
  totalImages = 0,
  enableScrollMilestones = true,
  enableTimeMilestones = true,
  scrollMilestones,
  timeMilestones,
  onViewTracked,
  children
}: ComprehensivePropertyTrackerProps)
</file>

<file path="components/providers/analytics-store-provider.tsx">
import { useEffect, useState } from 'react'
import { useAnalyticsStore } from '@/stores/analytics-store'
‚ãÆ----
interface AnalyticsStoreProviderProps {
  children: React.ReactNode
}
‚ãÆ----
export function AnalyticsStoreProvider(
‚ãÆ----
export function useStoreInitialization()
‚ãÆ----
const initializeStore = async () =>
‚ãÆ----
export function useStorePersistence()
‚ãÆ----
const saveToCloud = async () =>
‚ãÆ----
const loadFromCloud = async () =>
</file>

<file path="components/providers/query-provider.tsx">
import React, { useState } from 'react'
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { ReactQueryDevtools } from '@tanstack/react-query-devtools'
import { queryClient as defaultQueryClient } from '@/lib/react-query-config'
‚ãÆ----
interface QueryProviderProps {
  children: React.ReactNode
}
‚ãÆ----
export function QueryProvider(
</file>

<file path="components/ui/analytics-integration-test.tsx">
import React from "react"
import { KPICard, ChartContainer, TrendIndicator, MetricsBadge, DataTable, type ColumnDef } from "./analytics"
import { Home, Eye, Users, TrendingUp } from "lucide-react"
‚ãÆ----
interface TestData {
  id: string
  name: string
  value: number
  status: "active" | "inactive"
}
</file>

<file path="components/ui/analytics.ts">

</file>

<file path="components/ui/chart-container.tsx">
import React, { forwardRef } from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
import { AlertCircle, MoreVertical } from "lucide-react"
‚ãÆ----
export interface ChartContainerProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof chartContainerVariants> {

  title: string

  subtitle?: string

  children: React.ReactNode

  loading?: boolean

  error?: string

  actions?: React.ReactNode
}
‚ãÆ----
className=
</file>

<file path="components/ui/command.tsx">
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"
‚ãÆ----
import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"
‚ãÆ----
className=
</file>

<file path="components/ui/data-table.tsx">
import React, { forwardRef, useState, useMemo } from "react"
import { cn } from "@/lib/utils"
import { ChevronUp, ChevronDown, Search, ChevronsUpDown } from "lucide-react"
import { Input } from "./input"
‚ãÆ----
export interface ColumnDef<T> {

  id: string

  header: string

  accessorFn: (row: T) => React.ReactNode

  sortable?: boolean

  cell?: (props: { value: React.ReactNode; row: T }) => React.ReactNode

  className?: string

  center?: boolean
}
‚ãÆ----
type SortDirection = "asc" | "desc" | null
‚ãÆ----
export interface DataTableProps<T>
  extends React.HTMLAttributes<HTMLDivElement> {

  data: T[]

  columns: ColumnDef<T>[]

  loading?: boolean

  pagination?: boolean

  pageSize?: number

  sorting?: boolean

  filtering?: boolean

  searchPlaceholder?: string

  emptyMessage?: string

  getRowId?: (row: T, index: number) => string
}
‚ãÆ----
// Filter data based on search term
‚ãÆ----
// Sort data
‚ãÆ----
// Handle different data types
‚ãÆ----
const handleSort = (columnId: string) =>
‚ãÆ----
const getSortIcon = (columnId: string) =>
‚ãÆ----
className=
</file>

<file path="components/ui/interactive-chart.tsx">
import React, { useState, useRef, useEffect } from 'react'
import { cn } from '@/lib/utils'
import { Card } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { TrendingUp, TrendingDown, MoreVertical, ZoomIn, ZoomOut, Download } from 'lucide-react'
‚ãÆ----
export interface ChartDataPoint {
  date: string
  value: number
  label?: string
  metadata?: Record<string, any>
}
‚ãÆ----
export interface ChartSeries {
  id: string
  name: string
  data: ChartDataPoint[]
  color: string
  type?: 'line' | 'area' | 'bar'
}
‚ãÆ----
export interface InteractiveChartProps {
  series: ChartSeries[]
  width?: number
  height?: number
  showGrid?: boolean
  showTooltip?: boolean
  showLegend?: boolean
  allowZoom?: boolean
  allowPan?: boolean
  className?: string
  onPointClick?: (point: ChartDataPoint, series: ChartSeries) => void
}
‚ãÆ----
function getMinMax(series: ChartSeries[]):
‚ãÆ----
function formatValue(value: number): string
‚ãÆ----
function formatCurrency(value: number): string
‚ãÆ----
const scaleX = (index: number)
const scaleY = (value: number)
‚ãÆ----
const generatePath = (data: ChartDataPoint[], type: 'line' | 'area' = 'line') =>
‚ãÆ----
const handleMouseMove = (event: React.MouseEvent<SVGSVGElement>) =>
‚ãÆ----
const handleMouseLeave = () =>
‚ãÆ----
const handleZoomIn = ()
const handleZoomOut = ()
‚ãÆ----
d=
‚ãÆ----
cx=
cy=
‚ãÆ----
</file>

<file path="components/ui/kpi-card.tsx">
import React, { forwardRef } from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
import { TrendingUp, TrendingDown, Minus } from "lucide-react"
‚ãÆ----
export interface TrendConfig {

  value: number

  period: string

  direction: "positive" | "negative" | "neutral"
}
‚ãÆ----
export interface KPICardProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof kpiCardVariants> {

  title: string

  value: string | number

  format?: "number" | "currency" | "percentage"

  trend?: TrendConfig

  icon?: React.ComponentType<{ className?: string }>

  loading?: boolean

  description?: string
}
‚ãÆ----
const formatValue = (value: string | number, format?: string): string =>
‚ãÆ----
const getTrendIcon = (direction: TrendConfig["direction"]) =>
‚ãÆ----
className=
</file>

<file path="components/ui/loading-skeleton.tsx">
import React, { forwardRef } from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
‚ãÆ----
export interface SkeletonProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof skeletonVariants> {

  count?: number
}
‚ãÆ----
className=
‚ãÆ----
const renderItem = (index: number) =>
</file>

<file path="components/ui/metrics-badge.tsx">
import React, { forwardRef } from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
‚ãÆ----
export interface MetricsBadgeProps
  extends React.HTMLAttributes<HTMLSpanElement>,
    VariantProps<typeof metricsBadgeVariants> {

  children: React.ReactNode

  icon?: React.ComponentType<{ className?: string }>

  loading?: boolean
}
‚ãÆ----
const getStatusLabel = (status: string): string =>
‚ãÆ----
className=
</file>

<file path="components/ui/popover.tsx">
import { cn } from "@/lib/utils"
</file>

<file path="components/ui/scroll-area.tsx">
import { cn } from "@/lib/utils"
‚ãÆ----
className=
</file>

<file path="components/ui/separator.tsx">
import { cn } from "@/lib/utils"
</file>

<file path="components/ui/switch.tsx">
import { cn } from "@/lib/utils"
‚ãÆ----
className=
</file>

<file path="components/ui/tabs.tsx">
import { cn } from "@/lib/utils"
</file>

<file path="components/ui/trend-indicator.tsx">
import React, { forwardRef } from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
import { TrendingUp, TrendingDown, Minus } from "lucide-react"
‚ãÆ----
export interface TrendIndicatorProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof trendIndicatorVariants> {

  value: number

  period?: string

  showIcon?: boolean

  showValue?: boolean

  valuePrefix?: string

  valueSuffix?: string

  asPercentage?: boolean
}
‚ãÆ----
const getTrendIcon = (direction: "positive" | "negative" | "neutral") =>
‚ãÆ----
const formatTrendValue = (
  value: number,
  options: {
    asPercentage?: boolean
    valuePrefix?: string
    valueSuffix?: string
  } = {}
): string =>
‚ãÆ----
// Auto-add + sign for positive values if no prefix is specified
‚ãÆ----
// Format the number
‚ãÆ----
className=
</file>

<file path="create-test-properties.js">
async function createProperty(propertyData) {
‚ãÆ----
const response = await fetch(`${baseURL}/api/properties`, {
‚ãÆ----
body: JSON.stringify(propertyData)
‚ãÆ----
const result = await response.json();
‚ãÆ----
async function createTestProperties() {
console.log('üè† Creando propiedades de prueba para testing...\n');
‚ãÆ----
console.log(`Creando propiedad ${i + 1}: ${properties[i].title}`);
‚ãÆ----
const result = await createProperty(properties[i]);
‚ãÆ----
console.log(`‚úÖ Propiedad ${i + 1} creada con ID: ${result.data.id}`);
createdProperties.push(result.data);
‚ãÆ----
console.log(`‚ùå Error creando propiedad ${i + 1}:`);
console.log(`   Status: ${result.status}`);
console.log(`   Error: ${JSON.stringify(result.data || result.error)}`);
‚ãÆ----
console.log(`\nüéâ Proceso completado. ${createdProperties.length}/${properties.length} propiedades creadas.`);
‚ãÆ----
console.log('\nüìã Propiedades creadas:');
createdProperties.forEach(prop => {
console.log(`   - ID ${prop.id}: ${prop.title}`);
‚ãÆ----
console.log('‚ùå Este script requiere Node.js 18+ con fetch nativo');
process.exit(1);
‚ãÆ----
createTestProperties().catch(console.error);
</file>

<file path="debug-session-creation.js">
async function makeRequest(endpoint, method = 'GET', data = null) {
‚ãÆ----
options.body = JSON.stringify(data);
‚ãÆ----
const response = await fetch(url, options);
const result = await response.json();
‚ãÆ----
async function debugSessionCreation() {
console.log('üîç DEBUG DE CREACI√ìN DE SESIONES');
console.log('===============================\n');
‚ãÆ----
console.log('üìä Paso 1: Creando sesi√≥n y analizando respuesta...');
‚ãÆ----
const sessionResult = await makeRequest('/api/analytics/session', 'POST', sessionData);
‚ãÆ----
console.log('üìã Respuesta de creaci√≥n de sesi√≥n:');
console.log(`   Status: ${sessionResult.status}`);
console.log(`   Data: ${JSON.stringify(sessionResult.data, null, 2)}`);
‚ãÆ----
console.log('‚ùå Error creando sesi√≥n');
‚ãÆ----
console.log(`‚úÖ Session ID obtenido: ${sessionId}`);
console.log(`   Tipo: ${typeof sessionId}`);
console.log(`   Longitud: ${sessionId?.length}`);
‚ãÆ----
console.log('\nüîç Paso 2: Verificando que la sesi√≥n existe en la base de datos...');
‚ãÆ----
const verifyResult = await makeRequest(`/api/analytics/session?session_id=${sessionId}`, 'GET');
‚ãÆ----
console.log('üìã Respuesta de verificaci√≥n:');
console.log(`   Status: ${verifyResult.status}`);
console.log(`   Data: ${JSON.stringify(verifyResult.data, null, 2)}`);
‚ãÆ----
console.log('\nüëÜ Paso 3: Probando interacci√≥n (debe funcionar)...');
‚ãÆ----
const interactionResult = await makeRequest('/api/analytics/interaction', 'POST', interactionData);
‚ãÆ----
console.log('üìã Respuesta de interacci√≥n:');
console.log(`   Status: ${interactionResult.status}`);
console.log(`   Data: ${JSON.stringify(interactionResult.data, null, 2)}`);
‚ãÆ----
console.log('‚úÖ Interacci√≥n exitosa - La sesi√≥n existe y funciona para interacciones');
‚ãÆ----
console.log('‚ùå Interacci√≥n fall√≥ - Problema con la sesi√≥n');
‚ãÆ----
console.log('\nüè† Paso 4: Probando vista de propiedad...');
‚ãÆ----
const viewResult = await makeRequest('/api/analytics/property-view', 'POST', viewData);
‚ãÆ----
console.log('üìã Respuesta de vista de propiedad:');
console.log(`   Status: ${viewResult.status}`);
console.log(`   Data: ${JSON.stringify(viewResult.data, null, 2)}`);
‚ãÆ----
console.log('‚úÖ Vista de propiedad exitosa - Fix funcionando correctamente');
‚ãÆ----
console.log('‚ùå Vista de propiedad fall√≥');
‚ãÆ----
if (errorMsg.includes('Session not found')) {
console.log('\nüîç AN√ÅLISIS DETALLADO:');
console.log('   - El error es "Session not found"');
console.log('   - Esto significa que el fix est√° funcionando (no es foreign key constraint)');
console.log('   - Pero la consulta SELECT no encuentra la sesi√≥n');
console.log('   - Posibles causas:');
console.log('     1. La sesi√≥n no se insert√≥ realmente');
console.log('     2. Hay un problema con el campo session_id vs id');
console.log('     3. La consulta SELECT est√° mal formada');
‚ãÆ----
console.log('\nüîß POSIBLES SOLUCIONES:');
console.log('   1. Verificar que analytics_sessions.session_id existe');
console.log('   2. Confirmar que el INSERT fue exitoso');
console.log('   3. Revisar los logs del servidor para m√°s detalles');
‚ãÆ----
console.log('\nüÜï Paso 5: Creando segunda sesi√≥n para comparar...');
‚ãÆ----
const sessionResult2 = await makeRequest('/api/analytics/session', 'POST', sessionData2);
‚ãÆ----
console.log(`‚úÖ Segunda sesi√≥n creada: ${sessionId2}`);
‚ãÆ----
const viewResult2 = await makeRequest('/api/analytics/property-view', 'POST', viewData2);
‚ãÆ----
console.log('üìã Segunda vista de propiedad:');
console.log(`   Status: ${viewResult2.status}`);
console.log(`   Data: ${JSON.stringify(viewResult2.data, null, 2)}`);
‚ãÆ----
console.log('‚úÖ Segunda vista exitosa - El problema fue temporal');
‚ãÆ----
console.log('‚ùå Segunda vista tambi√©n fall√≥ - El problema es sistem√°tico');
‚ãÆ----
console.log('\nüìä RESUMEN DEL DEBUG:');
console.log('====================');
console.log(`‚úÖ Creaci√≥n de sesiones: ${sessionResult.status === 200 ? 'FUNCIONA' : 'FALLA'}`);
console.log(`${interactionResult.status === 200 ? '‚úÖ' : '‚ùå'} Interacciones: ${interactionResult.status === 200 ? 'FUNCIONA' : 'FALLA'}`);
console.log(`${viewResult.status === 200 ? '‚úÖ' : '‚ùå'} Vistas de propiedades: ${viewResult.status === 200 ? 'FUNCIONA' : 'FALLA'}`);
‚ãÆ----
console.log('\nüéØ CONCLUSI√ìN:');
console.log('El problema parece estar en el mapeo entre session_id y el UUID real.');
console.log('El fix temporal est√° funcionando pero hay un desajuste en los datos.');
‚ãÆ----
console.log('‚ùå Este script requiere Node.js 18+ con fetch nativo');
process.exit(1);
‚ãÆ----
debugSessionCreation().catch(console.error);
</file>

<file path="debug-session-issue.js">
async function makeRequest(endpoint, method = 'GET', data = null) {
‚ãÆ----
options.body = JSON.stringify(data);
‚ãÆ----
const response = await fetch(url, options);
const result = await response.json();
‚ãÆ----
async function debugSessionIssue() {
console.log('üîç DEBUGGING PROBLEMA DE SESIONES DE ANALYTICS');
console.log('==============================================\n');
‚ãÆ----
console.log('üìä Paso 1: Creando sesi√≥n...');
‚ãÆ----
const sessionResult = await makeRequest('/api/analytics/session', 'POST', sessionData);
‚ãÆ----
console.log('‚ùå No se pudo crear sesi√≥n');
console.log(`   Error: ${JSON.stringify(sessionResult.data || sessionResult.error)}`);
‚ãÆ----
console.log(`‚úÖ Sesi√≥n creada: ${sessionId}`);
console.log(`   Tipo: ${typeof sessionId}`);
console.log(`   Longitud: ${sessionId.length}`);
console.log(`   Formato UUID: ${/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(sessionId)}`);
‚ãÆ----
console.log('\nüëÜ Paso 2: Probando interacci√≥n (debe funcionar)...');
‚ãÆ----
const interactionResult = await makeRequest('/api/analytics/interaction', 'POST', interactionData);
‚ãÆ----
console.log('‚úÖ Interacci√≥n registrada correctamente');
‚ãÆ----
console.log('‚ùå Error en interacci√≥n');
console.log(`   Error: ${JSON.stringify(interactionResult.data || interactionResult.error)}`);
‚ãÆ----
console.log('\nüè† Paso 3: Probando vista de propiedad (puede fallar)...');
‚ãÆ----
const viewResult = await makeRequest('/api/analytics/property-view', 'POST', viewData);
‚ãÆ----
console.log('‚úÖ Vista de propiedad registrada correctamente');
‚ãÆ----
console.log('‚ùå Error en vista de propiedad');
console.log(`   Error: ${JSON.stringify(viewResult.data || viewResult.error)}`);
‚ãÆ----
if (errorMsg.includes('foreign key constraint')) {
console.log('\nüîç AN√ÅLISIS DEL ERROR:');
console.log('   - El problema es de foreign key constraint');
console.log('   - La sesi√≥n existe pero no se puede referenciar');
console.log('   - Posibles causas:');
console.log('     1. Session ID format mismatch (string vs UUID)');
console.log('     2. Session no se insert√≥ realmente en analytics_sessions');
console.log('     3. Funci√≥n PostgreSQL track_property_view tiene problema');
‚ãÆ----
console.log('\nüîÑ Paso 4: Probando vista autom√°tica (m√©todo PUT)...');
‚ãÆ----
const autoResult = await makeRequest('/api/analytics/property-view', 'PUT', autoViewData);
‚ãÆ----
console.log('‚úÖ Vista autom√°tica registrada correctamente');
console.log(`   Event ID: ${autoResult.data.event_id}`);
console.log(`   Session ID: ${autoResult.data.session_id}`);
‚ãÆ----
console.log('‚ùå Error en vista autom√°tica');
console.log(`   Error: ${JSON.stringify(autoResult.data || autoResult.error)}`);
‚ãÆ----
console.log('\nüìã RESUMEN DEL DEBUG:');
console.log('=====================');
console.log(`‚úÖ Creaci√≥n de sesi√≥n: ${sessionResult.status === 200 ? 'OK' : 'FALLO'}`);
console.log(`‚úÖ Interacciones: ${interactionResult.status === 200 ? 'OK' : 'FALLO'}`);
console.log(`${viewResult.status === 200 ? '‚úÖ' : '‚ùå'} Vistas POST: ${viewResult.status === 200 ? 'OK' : 'FALLO'}`);
console.log(`${autoResult.status === 200 ? '‚úÖ' : '‚ùå'} Vistas PUT: ${autoResult.status === 200 ? 'OK' : 'FALLO'}`);
‚ãÆ----
console.log('\nüîß RECOMENDACIONES:');
console.log('1. Verificar que la funci√≥n PostgreSQL track_property_view est√° correctamente implementada');
console.log('2. Confirmar que analytics_sessions tiene los constraints correctos');
console.log('3. Validar que el session_id se est√° pasando en el formato correcto (UUID)');
console.log('4. Revisar los logs del servidor para m√°s detalles');
‚ãÆ----
console.log('‚ùå Este script requiere Node.js 18+ con fetch nativo');
process.exit(1);
‚ãÆ----
debugSessionIssue().catch(console.error);
</file>

<file path="hooks/analytics.ts">
export function useCompleteDashboard(options: {
  period?: string
  autoRefresh?: boolean
  enableRealTime?: boolean
} =
‚ãÆ----
export function useMarketingAnalytics(period: string = '30d')
‚ãÆ----
export function usePropertyAnalytics(options: {
  propertyIds?: number[]
  period?: string
  includeComparison?: boolean
} =
‚ãÆ----
export interface CompleteAnalyticsData {
  dashboard: DashboardMetrics
  realTime: RealTimeMetrics
  properties: PropertyPerformance[]
  leads: LeadAnalytics
  funnel: ConversionFunnel
}
‚ãÆ----
export function useLegacyAnalytics()
</file>

<file path="hooks/useAnalyticsDashboard.ts">
import { useQuery, UseQueryResult } from '@tanstack/react-query'
import { queryKeys, cacheStrategies, handleQueryError, type ApiError } from '@/lib/react-query-config'
import type { DashboardStats } from '@/types/analytics'
‚ãÆ----
export interface DashboardPeriod {
  value: string
  label: string
  days: number
}
‚ãÆ----
export interface DashboardMetrics {
  overview: {
    totalViews: number
    uniqueSessions: number
    totalLeads: number
    conversionRate: number
    avgSessionDuration: number
  }
  trends: {
    viewsChange: number
    leadsChange: number
    conversionChange: number
    sessionsChange: number
  }
  topProperties: Array<{
    id: number
    title: string
    views: number
    leads: number
    conversionRate: number
  }>
  leadSources: Array<{
    source: string
    count: number
    percentage: number
    conversionRate: number
  }>
  recentActivity: Array<{
    type: 'view' | 'lead' | 'interaction'
    propertyId?: number
    propertyTitle?: string
    timestamp: string
    source?: string
  }>
}
‚ãÆ----
export interface UseDashboardOptions {
  period?: string
  autoRefresh?: boolean
  refreshInterval?: number
}
‚ãÆ----
export function useAnalyticsDashboard(options: UseDashboardOptions =
‚ãÆ----
function transformDashboardData(rawData: any, period: string): DashboardMetrics
‚ãÆ----
function formatMetricValue(value: number, type: 'number' | 'currency' | 'percentage' = 'number'): string
‚ãÆ----
export function useRealTimeDashboard()
‚ãÆ----
export function useDashboardOverview()
‚ãÆ----
function calculateChange(current?: number, previous?: number): number
</file>

<file path="hooks/useAnalyticsLayout.ts">
import { useState, useEffect } from 'react'
import { DateRange, QuickFilter, FilterOption } from '@/components/layouts/filter-bar'
‚ãÆ----
export interface LayoutState {
  sidebarCollapsed: boolean
  density: 'compact' | 'comfortable' | 'spacious'
  gridColumns: 'auto' | 1 | 2 | 3 | 4 | 6
  dateRange: DateRange
  quickFilters: QuickFilter[]
  customFilters: FilterOption[]
  viewMode: 'grid' | 'list' | 'cards'
}
‚ãÆ----
export interface LayoutActions {
  toggleSidebar: () => void
  setSidebarCollapsed: (collapsed: boolean) => void
  setDensity: (density: LayoutState['density']) => void
  setGridColumns: (columns: LayoutState['gridColumns']) => void
  setDateRange: (range: DateRange) => void
  toggleQuickFilter: (filterId: string) => void
  setCustomFilter: (filterId: string, value: any) => void
  resetFilters: () => void
  setViewMode: (mode: LayoutState['viewMode']) => void
  resetLayout: () => void
}
‚ãÆ----
export interface LayoutPreferences {
  persistToLocalStorage?: boolean
  storageKey?: string
  defaultSidebarCollapsed?: boolean
  defaultDensity?: LayoutState['density']
  defaultGridColumns?: LayoutState['gridColumns']
  defaultViewMode?: LayoutState['viewMode']
}
‚ãÆ----
export function useAnalyticsLayout(
  initialFilters: {
    quickFilters?: QuickFilter[]
    customFilters?: FilterOption[]
  } = {},
  preferences: LayoutPreferences = {}
): LayoutState & LayoutActions
‚ãÆ----
const getInitialState = (): LayoutState =>
‚ãÆ----
const toggleSidebar = () =>
‚ãÆ----
const setSidebarCollapsed = (collapsed: boolean) =>
‚ãÆ----
const setDensity = (density: LayoutState['density']) =>
‚ãÆ----
const setGridColumns = (gridColumns: LayoutState['gridColumns']) =>
‚ãÆ----
const setDateRange = (dateRange: DateRange) =>
‚ãÆ----
const toggleQuickFilter = (filterId: string) =>
‚ãÆ----
const setCustomFilter = (filterId: string, value: any) =>
‚ãÆ----
const resetFilters = () =>
‚ãÆ----
const setViewMode = (viewMode: LayoutState['viewMode']) =>
‚ãÆ----
const resetLayout = () =>
‚ãÆ----
export function useModuleFilters(
  moduleId: string,
  initialFilters: {
    quickFilters?: QuickFilter[]
    customFilters?: FilterOption[]
  }
)
‚ãÆ----
const updateQuickFilter = (filterId: string) =>
‚ãÆ----
const updateCustomFilter = (filterId: string, value: any) =>
‚ãÆ----
const updateDateRange = (dateRange: DateRange) =>
</file>

<file path="hooks/useFilters.ts">
import { useState, useEffect, useCallback, useMemo } from 'react'
import { DateRange, QuickFilter, FilterOption } from '@/components/layouts/filter-bar'
‚ãÆ----
export interface FilterValue {
  [key: string]: any
}
‚ãÆ----
export interface FilterState {
  dateRange: DateRange
  quickFilters: QuickFilter[]
  customFilters: FilterOption[]
  searchQuery: string
  sortBy: string
  sortOrder: 'asc' | 'desc'
}
‚ãÆ----
export interface FilterActions {
  setDateRange: (range: DateRange) => void
  toggleQuickFilter: (filterId: string) => void
  setQuickFilterActive: (filterId: string, active: boolean) => void
  setCustomFilter: (filterId: string, value: any) => void
  setSearchQuery: (query: string) => void
  setSorting: (sortBy: string, sortOrder?: 'asc' | 'desc') => void
  resetFilters: () => void
  resetDateRange: () => void
  resetQuickFilters: () => void
  resetCustomFilters: () => void
  clearSearch: () => void
}
‚ãÆ----
export interface FilterConfig {
  persistState?: boolean
  storageKey?: string
  debounceMs?: number
  autoSave?: boolean
}
‚ãÆ----
export interface UseFiltersOptions {
  initialDateRange?: DateRange
  initialQuickFilters?: QuickFilter[]
  initialCustomFilters?: FilterOption[]
  initialSearchQuery?: string
  initialSortBy?: string
  initialSortOrder?: 'asc' | 'desc'
  config?: FilterConfig
}
‚ãÆ----
export function useFilters(options: UseFiltersOptions =
‚ãÆ----
const getInitialState = (): FilterState =>
‚ãÆ----
// Computed values
‚ãÆ----
// Date range
‚ãÆ----
// Quick filters
‚ãÆ----
// Custom filters
‚ãÆ----
// Search query
‚ãÆ----
// Add active quick filters
‚ãÆ----
// Add custom filters with values
‚ãÆ----
// Utility function to merge filter arrays preserving state
function mergeFilters<T extends
‚ãÆ----
// Specialized hook for analytics filters
export function useAnalyticsFilters(moduleId: string)
‚ãÆ----
// Hook for property listing filters
export function usePropertyFilters()
</file>

<file path="hooks/useLeadAnalytics.ts">
import { useQuery, UseQueryResult } from '@tanstack/react-query'
import { queryKeys, cacheStrategies, handleQueryError, type ApiError } from '@/lib/react-query-config'
‚ãÆ----
export interface LeadAnalytics {
  overview: {
    totalLeads: number
    qualifiedLeads: number
    convertedLeads: number
    qualificationRate: number
    conversionRate: number
    avgLeadValue: number
    totalRevenue: number
  }
  trends: {
    leadsChange: number
    qualificationChange: number
    conversionChange: number
    revenueChange: number
  }
  funnel: {
    visitors: number
    propertyViews: number
    interactions: number
    leadGeneration: number
    qualification: number
    conversion: number
    dropoffRates: {
      visitorsToViews: number
      viewsToInteractions: number
      interactionsToLeads: number
      leadsToQualification: number
      qualificationToConversion: number
    }
  }
  sources: Array<{
    id: number
    name: string
    displayName: string
    category: string
    leadsCount: number
    qualifiedCount: number
    convertedCount: number
    qualificationRate: number
    conversionRate: number
    avgLeadValue: number
    costPerLead: number
    roi: number
  }>
  timeline: Array<{
    date: string
    leads: number
    qualified: number
    converted: number
    revenue: number
  }>
}
‚ãÆ----
export interface LeadSourcePerformance {
  sourceId: number
  sourceName: string
  displayName: string
  category: string
  metrics: {
    totalLeads: number
    qualifiedLeads: number
    convertedLeads: number
    qualificationRate: number
    conversionRate: number
    avgLeadValue: number
    totalRevenue: number
    costPerLead: number
    roi: number
  }
  trends: {
    leadsChange: number
    conversionChange: number
    revenueChange: number
  }
  demographics: {
    deviceTypes: Array<{ type: string; count: number; percentage: number }>
    propertyTypes: Array<{ type: string; count: number; percentage: number }>
    timeDistribution: Array<{ hour: number; leads: number }>
  }
}
‚ãÆ----
export interface ConversionFunnel {
  stages: Array<{
    name: string
    count: number
    percentage: number
    dropoffRate: number
  }>
  insights: Array<{
    stage: string
    issue: string
    recommendation: string
    priority: 'high' | 'medium' | 'low'
  }>
}
‚ãÆ----
export interface UseLeadAnalyticsOptions {
  period?: string
  sourceId?: number
  includeRevenue?: boolean
  includeFunnel?: boolean
}
‚ãÆ----
export function useLeadAnalytics(options: UseLeadAnalyticsOptions =
‚ãÆ----
export function useLeadSourcesPerformance(period: string = '30d')
‚ãÆ----
export function useConversionFunnel(period: string = '30d')
‚ãÆ----
export function useLeadQualityScoring(period: string = '30d')
‚ãÆ----
function transformLeadAnalytics(rawData: any): LeadAnalytics
‚ãÆ----
function transformLeadSourcePerformance(rawData: any): LeadSourcePerformance
‚ãÆ----
function transformConversionFunnel(rawData: any): ConversionFunnel
‚ãÆ----
function calculateFunnelEfficiency(stages: ConversionFunnel['stages']): number
‚ãÆ----
function findBiggestDropoff(stages: ConversionFunnel['stages'])
‚ãÆ----
function calculateQualityScore(metrics: {
  conversionRate: number
  avgLeadValue: number
  roi: number
  costPerLead: number
}): number
‚ãÆ----
function getQualityGrade(score: number): string
‚ãÆ----
function getSourceRecommendation(score: number, metrics: LeadSourcePerformance['metrics']): string
</file>

<file path="hooks/useOptimisticUpdates.ts">
import { useCallback } from 'react'
import { useQueryClient } from '@tanstack/react-query'
import { queryKeys, invalidateQueries } from '@/lib/react-query-config'
import { useAnalyticsStore } from '@/stores/analytics-store'
‚ãÆ----
interface OptimisticUpdate<T = any> {
  queryKey: string[]
  updater: (oldData: T) => T
  rollback?: (oldData: T) => T
}
‚ãÆ----
interface OptimisticAction {
  id: string
  timestamp: number
  updates: OptimisticUpdate[]
  onSuccess?: () => void
  onError?: (error: any) => void
}
‚ãÆ----
export function useOptimisticUpdates()
‚ãÆ----
export function usePropertyOptimisticUpdates(propertyId: number)
‚ãÆ----
export function useDashboardOptimisticUpdates()
</file>

<file path="hooks/usePropertyMetrics.ts">
import { useQuery, useQueries, UseQueryResult } from '@tanstack/react-query'
import { queryKeys, cacheStrategies, handleQueryError, type ApiError } from '@/lib/react-query-config'
import type { PropertyMetrics } from '@/types/analytics'
‚ãÆ----
export interface PropertyPerformance {
  id: number
  title: string
  metrics: {
    totalViews: number
    uniqueSessions: number
    avgDuration: number
    totalInteractions: number
    leadsGenerated: number
    conversionRate: number
    bounceRate: number
  }
  trends: {
    viewsChange: number
    leadsChange: number
    conversionChange: number
  }
  engagement: {
    phoneClicks: number
    whatsappClicks: number
    emailClicks: number
    imageViews: number
    contactFormOpened: number
    contactFormSubmitted: number
  }
  demographics: {
    deviceTypes: Array<{ type: string; count: number; percentage: number }>
    referrerSources: Array<{ source: string; count: number; percentage: number }>
    timeDistribution: Array<{ hour: number; views: number }>
  }
}
‚ãÆ----
export interface PropertyRanking {
  id: number
  title: string
  rank: number
  views: number
  leads: number
  conversionRate: number
  change: number
}
‚ãÆ----
export interface UsePropertyMetricsOptions {
  daysBack?: number
  includeEngagement?: boolean
  includeDemographics?: boolean
  autoRefresh?: boolean
}
‚ãÆ----
export function usePropertyMetrics(
  propertyId: number,
  options: UsePropertyMetricsOptions = {}
)
‚ãÆ----
export function usePropertiesComparison(
  propertyIds: number[],
  daysBack: number = 30
)
‚ãÆ----
export function usePropertyRankings(period: string = '30d', limit: number = 10)
‚ãÆ----
export function usePropertyPerformanceOverview(period: string = '30d')
‚ãÆ----
function transformPropertyMetrics(rawData: any, propertyId: number): PropertyPerformance
‚ãÆ----
function createComparisonMatrix(properties: PropertyPerformance[])
</file>

<file path="hooks/useResponsive.ts">
import { useState, useEffect } from 'react'
‚ãÆ----
export type Breakpoint = 'mobile' | 'tablet' | 'desktop' | 'wide'
‚ãÆ----
export interface ResponsiveState {
  isMobile: boolean
  isTablet: boolean
  isDesktop: boolean
  isWide: boolean
  currentBreakpoint: Breakpoint
  width: number | null
  height: number | null
}
‚ãÆ----
export function useResponsive(): ResponsiveState
‚ãÆ----
const updateDimensions = () =>
‚ãÆ----
const handleResize = () =>
‚ãÆ----
export function useBreakpoint(targetBreakpoint: Breakpoint): boolean
‚ãÆ----
export function useMinBreakpoint(minBreakpoint: Breakpoint): boolean
‚ãÆ----
export function useMaxBreakpoint(maxBreakpoint: Breakpoint): boolean
‚ãÆ----
export function useResponsiveClasses(classes: Partial<Record<Breakpoint, string>>): string
</file>

<file path="hooks/useSidebar.ts">
import { useState, useEffect, useCallback } from 'react'
import { useResponsive } from './useResponsive'
‚ãÆ----
export interface SidebarState {
  isOpen: boolean
  isCollapsed: boolean
  isPinned: boolean
  isOverlay: boolean
  width: number
}
‚ãÆ----
export interface SidebarActions {
  open: () => void
  close: () => void
  toggle: () => void
  collapse: () => void
  expand: () => void
  toggleCollapsed: () => void
  pin: () => void
  unpin: () => void
  togglePinned: () => void
  setWidth: (width: number) => void
}
‚ãÆ----
export interface SidebarOptions {
  defaultOpen?: boolean
  defaultCollapsed?: boolean
  defaultPinned?: boolean
  defaultWidth?: number
  collapsedWidth?: number
  minWidth?: number
  maxWidth?: number
  persistState?: boolean
  storageKey?: string
  autoCollapseOnMobile?: boolean
  overlayOnTablet?: boolean
}
‚ãÆ----
export function useSidebar(options: SidebarOptions =
‚ãÆ----
const getInitialState = (): SidebarState =>
‚ãÆ----
export function useNavigationSidebar()
‚ãÆ----
export function useAnalyticsSidebar()
</file>

<file path="lib/analytics-client.ts">
import { type LeadSourceCode } from "@/types/analytics"
‚ãÆ----
interface AnalyticsConfig {
  apiBaseUrl?: string
  enableConsoleLogging?: boolean
  enableLocalStorage?: boolean
  sessionStorageKey?: string
  optOutStorageKey?: string
}
‚ãÆ----
interface SessionData {
  sessionId: string
  createdAt: number
  lastSeen: number
}
‚ãÆ----
interface PropertyViewData {
  propertyId: number
  timeOnPage?: number
  scrollDepth?: number
  contactButtonClicked?: boolean
  whatsappClicked?: boolean
  phoneClicked?: boolean
  imagesViewed?: number
  mapInteracted?: boolean
  similarPropertiesClicked?: boolean
  pageUrl?: string
  referrerUrl?: string
}
‚ãÆ----
interface DeviceInfo {
  deviceType: 'desktop' | 'tablet' | 'mobile' | 'bot'
  browser: string
  os: string
  screenWidth: number
  screenHeight: number
  userAgent: string
}
‚ãÆ----
export class AnalyticsClient
‚ãÆ----
constructor(config: AnalyticsConfig =
‚ãÆ----
private async init()
‚ãÆ----
private async initializeSession()
‚ãÆ----
private async createNewSession()
‚ãÆ----
private updateSessionLastSeen()
‚ãÆ----
async trackPropertyView(propertyId: number, additionalData?: Partial<PropertyViewData>)
‚ãÆ----
async trackLead(leadId: number, sourceCode: LeadSourceCode, propertyId?: number)
‚ãÆ----
trackInteraction(eventType: string, target?: string, data?: any)
‚ãÆ----
private async flushInteractions()
‚ãÆ----
private setupScrollTracking()
‚ãÆ----
const trackScroll = () =>
‚ãÆ----
private setupInteractionBatching()
‚ãÆ----
trackContactClick(propertyId?: number)
‚ãÆ----
trackWhatsAppClick(propertyId?: number)
‚ãÆ----
trackPhoneClick(propertyId?: number)
‚ãÆ----
trackImageView(propertyId: number, imageIndex: number)
‚ãÆ----
trackMapInteraction(propertyId?: number)
‚ãÆ----
async optOut(reason?: string)
‚ãÆ----
async checkOptInStatus(): Promise<boolean>
‚ãÆ----
private getDeviceInfo(): DeviceInfo
‚ãÆ----
private getDeviceType(userAgent: string, screenWidth: number): 'desktop' | 'tablet' | 'mobile' | 'bot'
‚ãÆ----
private getBrowser(userAgent: string): string
‚ãÆ----
private getOS(userAgent: string): string
‚ãÆ----
private getUTMParameters()
‚ãÆ----
private getReferrerDomain(): string | undefined
‚ãÆ----
private async getCountryCode(): Promise<string | undefined>
‚ãÆ----
private inferFormType(sourceCode: LeadSourceCode): string
‚ãÆ----
private loadSessionFromStorage(): SessionData | null
‚ãÆ----
private saveSessionToStorage()
‚ãÆ----
private clearSession()
‚ãÆ----
private checkOptOutStatus(): boolean
‚ãÆ----
private saveOptOutStatus(optedOut: boolean)
‚ãÆ----
private isSessionValid(session: SessionData): boolean
‚ãÆ----
private log(message: string, data?: any)
‚ãÆ----
destroy()
‚ãÆ----
export const getAnalyticsClient = (config?: AnalyticsConfig): AnalyticsClient =>
‚ãÆ----
export const trackPropertyView = (propertyId: number, data?: Partial<PropertyViewData>) =>
‚ãÆ----
export const trackLead = (leadId: number, source: LeadSourceCode, propertyId?: number) =>
‚ãÆ----
export const trackContactClick = (propertyId?: number) =>
‚ãÆ----
export const trackWhatsAppClick = (propertyId?: number) =>
‚ãÆ----
export const trackPhoneClick = (propertyId?: number) =>
‚ãÆ----
export const optOutOfAnalytics = (reason?: string) =>
</file>

<file path="lib/api-middleware.ts">
import { NextRequest, NextResponse } from "next/server"
import { API_CONFIG, type CacheConfig } from "./api-utils"
‚ãÆ----
export interface CacheEntry {
  data: any
  timestamp: number
  ttl: number
  etag: string
  compressed?: boolean
}
‚ãÆ----
function startCacheCleanup()
‚ãÆ----
export function generateCacheKey(
  url: string,
  method: string,
  headers?: Record<string, string>
): string
‚ãÆ----
export function getCachedResponse(cacheKey: string): CacheEntry | null
‚ãÆ----
export function setCachedResponse(
  cacheKey: string,
  data: any,
  ttl: number = API_CONFIG.cache.default_max_age
): void
‚ãÆ----
export function shouldCompress(request: NextRequest): boolean
‚ãÆ----
export function compressResponse(data: any): string
‚ãÆ----
export function handleConditionalRequest(
  request: NextRequest,
  etag: string
): NextResponse | null
‚ãÆ----
export interface MiddlewareConfig {
  cache?: {
    enabled: boolean
    ttl?: number
    staleWhileRevalidate?: number
    varyByHeaders?: string[]
  }
  compression?: {
    enabled: boolean
    minSize?: number
  }
  rateLimit?: {
    enabled: boolean
    limit?: number
  }
  monitoring?: {
    enabled: boolean
    logRequests?: boolean
  }
}
‚ãÆ----
export function createApiMiddleware(config: MiddlewareConfig =
‚ãÆ----
export function getCacheStats():
‚ãÆ----
export function clearCache(pattern?: string): number
‚ãÆ----
export function warmUpCache(endpoints: string[]): Promise<void[]>
</file>

<file path="lib/api-utils.ts">
import { NextRequest, NextResponse } from "next/server"
import { type AnalyticsFilters } from "@/types/analytics"
‚ãÆ----
interface RateLimitRecord {
  count: number
  resetTime: number
}
‚ãÆ----
interface RateLimitResult {
  allowed: boolean
  remaining: number
  resetTime: number
  limit: number
}
‚ãÆ----
export function getRateLimitKey(request: NextRequest, prefix: string = 'api'): string
‚ãÆ----
export function checkRateLimit(
  key: string,
  limit: number = API_CONFIG.rateLimit.default_limit
): RateLimitResult
‚ãÆ----
export function addRateLimitHeaders(response: NextResponse, rateLimit: RateLimitResult): void
‚ãÆ----
export function createRateLimitResponse(rateLimit: RateLimitResult, context?: string): NextResponse
‚ãÆ----
export function addSecurityHeaders(response: NextResponse): NextResponse
‚ãÆ----
export interface CacheConfig {
  maxAge: number
  staleWhileRevalidate?: number
  private?: boolean
  mustRevalidate?: boolean
}
‚ãÆ----
export function addCacheHeaders(
  response: NextResponse,
  config: CacheConfig = { maxAge: API_CONFIG.cache.default_max_age }
): NextResponse
‚ãÆ----
export function generateCacheKey(
  endpoint: string,
  filters: AnalyticsFilters,
  additional?: Record<string, any>
): string
‚ãÆ----
// =====================================================================================
// VALIDATION
// =====================================================================================
‚ãÆ----
export interface ValidationResult {
  valid: boolean
  error?: string
  code?: string
}
‚ãÆ----
export function validateDateRange(startDate: string, endDate: string, maxDays: number = API_CONFIG.validation.max_date_range_days): ValidationResult
‚ãÆ----
export function validateFilters(filters: Partial<AnalyticsFilters>): ValidationResult
‚ãÆ----
export interface ApiResponse<T = any> {
  success: boolean
  data?: T
  error?: string
  code?: string
  meta?: {
    execution_time_ms?: number
    cached?: boolean
    rate_limit?: {
      remaining: number
      reset_time: number
    }
    [key: string]: any
  }
}
‚ãÆ----
export function createSuccessResponse<T>(
  data: T,
  meta: Record<string, any> = {}
): ApiResponse<T>
‚ãÆ----
export function createErrorResponse(
  error: string,
  code: string = 'INTERNAL_ERROR',
  meta: Record<string, any> = {}
): ApiResponse
‚ãÆ----
export function addPerformanceHeaders(response: NextResponse, executionTime: number): void
‚ãÆ----
export function parseAnalyticsFilters(searchParams: URLSearchParams): AnalyticsFilters
‚ãÆ----
export function parseCompactFlag(searchParams: URLSearchParams): boolean
‚ãÆ----
export function handleApiError(error: unknown, context: string = 'API'): ApiResponse
‚ãÆ----
export interface ApiMetrics {
  endpoint: string
  method: string
  status_code: number
  execution_time_ms: number
  rate_limited: boolean
  cached: boolean
  user_ip?: string
  user_agent?: string
}
‚ãÆ----
export function logApiMetrics(metrics: ApiMetrics): void
‚ãÆ----
export function extractRequestMetadata(request: NextRequest):
</file>

<file path="lib/react-query-config.ts">
import { QueryClient } from '@tanstack/react-query'
‚ãÆ----
export interface ApiError {
  message: string
  status?: number
  code?: string
}
‚ãÆ----
export const handleQueryError = (error: unknown): ApiError =>
</file>

<file path="lib/supabase.ts">
import { createClient } from "@supabase/supabase-js"
‚ãÆ----
export interface Database {
  public: {
    Tables: {
      properties: {
        Row: {
          id: number
          title: string
          description: string | null
          price: number
          currency: string
          property_type: string
          operation_type: string
          bedrooms: number | null
          bathrooms: number | null
          area_m2: number | null
          address: string | null
          neighborhood: string | null
          city: string
          province: string
          latitude: number | null
          longitude: number | null
          images: string[]
          features: string[]
          featured: boolean
          status: string
          views: number
          created_at: string
          updated_at: string
        }
        Insert: {
          id?: number
          title: string
          description?: string | null
          price: number
          currency?: string
          property_type: string
          operation_type: string
          bedrooms?: number | null
          bathrooms?: number | null
          area_m2?: number | null
          address?: string | null
          neighborhood?: string | null
          city?: string
          province?: string
          latitude?: number | null
          longitude?: number | null
          images?: string[]
          features?: string[]
          featured?: boolean
          status?: string
          views?: number
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: number
          title?: string
          description?: string | null
          price?: number
          currency?: string
          property_type?: string
          operation_type?: string
          bedrooms?: number | null
          bathrooms?: number | null
          area_m2?: number | null
          address?: string | null
          neighborhood?: string | null
          city?: string
          province?: string
          latitude?: number | null
          longitude?: number | null
          images?: string[]
          features?: string[]
          featured?: boolean
          status?: string
          views?: number
          created_at?: string
          updated_at?: string
        }
      }
      leads: {
        Row: {
          id: number
          name: string
          email: string | null
          phone: string | null
          message: string | null
          property_id: number | null
          lead_source: string
          status: string
          notes: string | null
          last_contact: string | null
          next_action: string | null
          next_action_date: string | null
          priority: string
          score: number
          created_at: string
          updated_at: string
        }
        Insert: {
          id?: number
          name: string
          email?: string | null
          phone?: string | null
          message?: string | null
          property_id?: number | null
          lead_source?: string
          status?: string
          notes?: string | null
          last_contact?: string | null
          next_action?: string | null
          next_action_date?: string | null
          priority?: string
          score?: number
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: number
          name?: string
          email?: string | null
          phone?: string | null
          message?: string | null
          property_id?: number | null
          lead_source?: string
          status?: string
          notes?: string | null
          last_contact?: string | null
          next_action?: string | null
          next_action_date?: string | null
          priority?: string
          score?: number
          created_at?: string
          updated_at?: string
        }
      }
      profiles: {
        Row: {
          id: string
          email: string
          full_name: string
          role: string
          phone: string | null
          avatar_url: string | null
          created_at: string
          updated_at: string
        }
        Insert: {
          id: string
          email: string
          full_name: string
          role?: string
          phone?: string | null
          avatar_url?: string | null
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          email?: string
          full_name?: string
          role?: string
          phone?: string | null
          avatar_url?: string | null
          created_at?: string
          updated_at?: string
        }
      }
    }
  }
}
‚ãÆ----
export type Property = Database["public"]["Tables"]["properties"]["Row"]
export type PropertyInsert = Database["public"]["Tables"]["properties"]["Insert"]
export type PropertyUpdate = Database["public"]["Tables"]["properties"]["Update"]
‚ãÆ----
export type Lead = Database["public"]["Tables"]["leads"]["Row"]
export type LeadInsert = Database["public"]["Tables"]["leads"]["Insert"]
export type LeadUpdate = Database["public"]["Tables"]["leads"]["Update"]
‚ãÆ----
export type Profile = Database["public"]["Tables"]["profiles"]["Row"]
</file>

<file path="scripts/create-user.js">
async function createUser() {
‚ãÆ----
const response = await fetch('http://localhost:3001/api/auth/create-user', {
‚ãÆ----
body: JSON.stringify(userData)
‚ãÆ----
const result = await response.json()
‚ãÆ----
console.log('‚úÖ User created successfully!')
console.log('Email:', userData.email)
console.log('Password:', userData.password)
console.log('User ID:', result.user.id)
‚ãÆ----
console.error('‚ùå Failed to create user:', result.error)
‚ãÆ----
console.error('‚ùå Error:', error.message)
console.log('\nüí° Make sure the development server is running with: pnpm local')
‚ãÆ----
createUser()
</file>

<file path="scripts/read-analytics-readme.js">
class AnalyticsReadmeReader {
‚ãÆ----
this.readmePath = path.join(__dirname, '..', 'ANALYTICS.md');
‚ãÆ----
readFullContent() {
‚ãÆ----
const content = fs.readFileSync(this.readmePath, 'utf8');
‚ãÆ----
console.error('Error leyendo ANALYTICS.md:', error.message);
‚ãÆ----
readSection(sectionName) {
const content = this.readFullContent();
‚ãÆ----
const lines = content.split('\n');
const sectionRegex = new RegExp(`^##.*${sectionName}`, 'i');
‚ãÆ----
if (sectionRegex.test(lines[i])) {
‚ãÆ----
console.log(`Secci√≥n "${sectionName}" no encontrada`);
‚ãÆ----
if (lines[i].startsWith('## ')) {
‚ãÆ----
const sectionLines = lines.slice(sectionStart, sectionEnd === -1 ? undefined : sectionEnd);
return sectionLines.join('\n');
‚ãÆ----
listSections() {
‚ãÆ----
if (line.startsWith('## ')) {
const sectionName = line.replace('## ', '').replace(/^[üöÄüìäüõ†Ô∏èüõ°Ô∏èüöÄüîßüîçüìöüéØüìûüìÑ]+ /, '');
sections.push(sectionName);
‚ãÆ----
/**
   * Busca texto espec√≠fico en el README
   * @param {string} searchTerm - T√©rmino a buscar
   */
search(searchTerm) {
‚ãÆ----
if (lines[i].toLowerCase().includes(searchTerm.toLowerCase())) {
results.push({
‚ãÆ----
content: lines[i].trim(),
context: lines.slice(Math.max(0, i - 1), Math.min(lines.length, i + 2))
‚ãÆ----
extractApiEndpoints() {
const apiSection = this.readSection('API Endpoints');
‚ãÆ----
const lines = apiSection.split('\n');
‚ãÆ----
while ((match = httpMethodRegex.exec(line)) !== null) {
endpoints.push({
‚ãÆ----
description: line.replace(match[0], '').replace(/[#`]/g, '').trim()
‚ãÆ----
/**
   * Muestra informaci√≥n sobre el commit que cre√≥ el README
   */
getCommitInfo() {
‚ãÆ----
cli() {
const args = process.argv.slice(2);
‚ãÆ----
console.log(this.readFullContent());
‚ãÆ----
console.log('Uso: node read-analytics-readme.js section "Nombre de Secci√≥n"');
‚ãÆ----
console.log(this.readSection(sectionName));
‚ãÆ----
console.log('Secciones disponibles:');
this.listSections().forEach((section, index) => {
console.log(`${index + 1}. ${section}`);
‚ãÆ----
console.log('Uso: node read-analytics-readme.js search "t√©rmino"');
‚ãÆ----
const results = this.search(searchTerm);
console.log(`Encontradas ${results.length} coincidencias para "${searchTerm}":`);
results.forEach(result => {
console.log(`L√≠nea ${result.line}: ${result.content}`);
‚ãÆ----
const endpoints = this.extractApiEndpoints();
console.log('Endpoints de la API:');
endpoints.forEach(endpoint => {
console.log(`${endpoint.method} ${endpoint.path} - ${endpoint.description}`);
‚ãÆ----
const info = this.getCommitInfo();
console.log('Informaci√≥n del commit:');
console.log(`Hash: ${info.hash}`);
console.log(`Fecha: ${info.date}`);
console.log(`Autor: ${info.author}`);
console.log(`Mensaje: ${info.message}`);
console.log('Archivos creados:', info.filesCreated.join(', '));
‚ãÆ----
console.log(`
‚ãÆ----
const reader = new AnalyticsReadmeReader();
reader.cli();
</file>

<file path="scripts/run-analytics-fix.js">
async function runMigration() {
‚ãÆ----
const envContent = fs.readFileSync('.env', 'utf-8')
‚ãÆ----
envContent.split('\n').forEach(line => {
const [key, ...valueParts] = line.split('=')
‚ãÆ----
envVars[key.trim()] = valueParts.join('=').trim()
‚ãÆ----
const supabase = createClient(
‚ãÆ----
console.log('üîÑ Ejecutando migraci√≥n de analytics...')
‚ãÆ----
const { data, error } = await supabase.rpc('exec_sql', {
‚ãÆ----
console.log('‚ö†Ô∏è  La funci√≥n exec_sql no existe. Instrucciones manuales:')
console.log('\n1. Ve a: https://uutffduomvmyuqmeqjbw.supabase.co/project/uutffduomvmyuqmeqjbw/editor')
console.log('2. Ejecuta el siguiente SQL en el Editor SQL:\n')
console.log('ALTER TABLE analytics_property_views ALTER COLUMN page_url DROP NOT NULL;')
console.log('\n3. Luego ejecuta para verificar:\n')
console.log(`SELECT column_name, data_type, is_nullable
‚ãÆ----
process.exit(1)
‚ãÆ----
console.log('‚úÖ Migraci√≥n ejecutada exitosamente')
console.log('üìä Resultado:', data)
‚ãÆ----
console.error('‚ùå Error ejecutando migraci√≥n:', err)
‚ãÆ----
runMigration()
</file>

<file path="services/settings.ts">
import { supabase } from '@/lib/supabase'
import {
  SiteSettings,
  SiteSettingsInput,
  SiteSettingsResponse,
  SiteSettingsUpdateResponse,
  DEFAULT_SITE_SETTINGS
} from '@/types/settings'
import { z } from 'zod'
‚ãÆ----
export class SettingsService
‚ãÆ----
static async getSettings(): Promise<SiteSettings | null>
‚ãÆ----
static async getSettingsWithDefaults(): Promise<SiteSettings>
‚ãÆ----
static async settingsExist(): Promise<boolean>
‚ãÆ----
static async updateSettings(updates: SiteSettingsInput): Promise<SiteSettings>
‚ãÆ----
static async createDefaultSettings(): Promise<SiteSettings>
‚ãÆ----
static async updateCompanyInfo(companyData: {
    company_name?: string
    company_description?: string
    contact_email?: string
    contact_phone?: string
    whatsapp_number?: string
    address?: string
    website_url?: string
}): Promise<SiteSettings>
‚ãÆ----
static async updateSocialMedia(socialMedia: {
    facebook?: string | null
    instagram?: string | null
    linkedin?: string | null
    youtube?: string | null
    twitter?: string | null
}): Promise<SiteSettings>
‚ãÆ----
static async updateBrandColors(colors: {
    primary?: string
    secondary?: string
}): Promise<SiteSettings>
‚ãÆ----
static async updateSEO(seoData: {
    meta_title?: string
    meta_description?: string
    meta_keywords?: string
    google_analytics_id?: string
    google_tag_manager_id?: string
}): Promise<SiteSettings>
‚ãÆ----
static async updateContactMethods(contactMethods: {
    whatsapp_enabled?: boolean
    phone_enabled?: boolean
    email_enabled?: boolean
    contact_form_enabled?: boolean
}): Promise<SiteSettings>
‚ãÆ----
static async updateBranding(brandingData: {
    logo_url?: string | null
    logo_dark_url?: string | null
    favicon_url?: string | null
}): Promise<SiteSettings>
‚ãÆ----
static validateSocialMediaUrl(platform: string, url: string): boolean
‚ãÆ----
static formatResponse(
    settings: SiteSettings | null,
    message?: string
): SiteSettingsResponse
‚ãÆ----
static formatErrorResponse(error: string): SiteSettingsResponse
</file>

<file path="session.json">
{"success":true,"session_id":"8723f59c-439c-4722-a179-f7ea69f78900"}
</file>

<file path="stores/analytics-store.ts">
import { create } from 'zustand'
import { persist, createJSONStorage } from 'zustand/middleware'
import { devtools } from 'zustand/middleware'
‚ãÆ----
export interface AnalyticsFilters {
  period: string
  dateRange: {
    from: string | null
    to: string | null
  } | null
  propertyIds: number[]
  sourceIds: number[]
  deviceTypes: string[]
  agentIds: number[]
}
‚ãÆ----
export interface UserPreferences {
  theme: 'light' | 'dark' | 'system'
  language: string
  timezone: string
  defaultPeriod: string
  autoRefresh: boolean
  refreshInterval: number
  notificationsEnabled: boolean
  emailReports: boolean
  dashboardLayout: 'grid' | 'list'
  chartsType: 'line' | 'bar' | 'area'
  compactMode: boolean
}
‚ãÆ----
export interface DashboardState {
  activeModule: string
  sidebarCollapsed: boolean
  filtersVisible: boolean
  fullscreenChart: string | null
  selectedKPIs: string[]
  customDateRanges: Array<{
    id: string
    name: string
    from: string
    to: string
  }>
}
‚ãÆ----
export interface AnalyticsStore {

  filters: AnalyticsFilters
  preferences: UserPreferences
  dashboard: DashboardState


  isLoading: boolean
  isSaving: boolean


  setFilters: (filters: Partial<AnalyticsFilters>) => void
  resetFilters: () => void
  setPeriod: (period: string) => void
  setDateRange: (from: string | null, to: string | null) => void
  addPropertyFilter: (propertyId: number) => void
  removePropertyFilter: (propertyId: number) => void
  setPropertyFilters: (propertyIds: number[]) => void
  addSourceFilter: (sourceId: number) => void
  removeSourceFilter: (sourceId: number) => void


  setPreferences: (preferences: Partial<UserPreferences>) => void
  resetPreferences: () => void
  toggleAutoRefresh: () => void
  setRefreshInterval: (interval: number) => void
  toggleNotifications: () => void
  setDashboardLayout: (layout: 'grid' | 'list') => void
  setChartsType: (type: 'line' | 'bar' | 'area') => void


  setActiveModule: (module: string) => void
  toggleSidebar: () => void
  setSidebarCollapsed: (collapsed: boolean) => void
  toggleFilters: () => void
  setFullscreenChart: (chartId: string | null) => void
  setSelectedKPIs: (kpis: string[]) => void
  addCustomDateRange: (range: { name: string; from: string; to: string }) => void
  removeCustomDateRange: (id: string) => void


  hasActiveFilters: () => boolean
  getActiveFiltersCount: () => number
  exportPreferences: () => string
  importPreferences: (data: string) => void
}
‚ãÆ----
export const useAnalyticsFilters = ()
export const useUserPreferences = ()
export const useDashboardState = ()
export const useFilterActions = () => useAnalyticsStore(state => (
</file>

<file path="stores/navigation-store.ts">
import { create } from 'zustand'
import { persist, createJSONStorage } from 'zustand/middleware'
‚ãÆ----
interface RecentSearch {
  id: string
  label: string
  href: string
  timestamp: number
}
‚ãÆ----
interface NavigationState {

  commandPaletteOpen: boolean
  recentSearches: RecentSearch[]
  favoriteModules: string[]


  openCommandPalette: () => void
  closeCommandPalette: () => void
  toggleCommandPalette: () => void

  addRecentSearch: (search: Omit<RecentSearch, 'id' | 'timestamp'>) => void
  clearRecentSearches: () => void

  toggleFavorite: (moduleId: string) => void
  isFavorite: (moduleId: string) => boolean
}
‚ãÆ----
export const useCommandPalette = () =>
‚ãÆ----
export const useRecentSearches = () =>
‚ãÆ----
export const useFavorites = () =>
</file>

<file path="styles/leaflet.css">
.leaflet-container {
‚ãÆ----
.leaflet-control-attribution {
‚ãÆ----
.leaflet-popup-content-wrapper {
‚ãÆ----
.leaflet-popup-tip {
</file>

<file path="test_session.json">
{"success":true,"session_id":"83658550-99a2-463e-8f71-ac02fcc13ca5"}
</file>

<file path="test-analytics-properties.js">
console.log('üß™ INICIANDO TEST DE ANALYTICS DE PROPIEDADES');
console.log('===============================================\n');
‚ãÆ----
async function makeRequest(endpoint, method = 'GET', data = null) {
‚ãÆ----
options.body = JSON.stringify(data);
‚ãÆ----
const response = await fetch(url, options);
const result = await response.json();
‚ãÆ----
async function testCreateSession() {
console.log('üìä Test 1: Creaci√≥n de sesi√≥n de analytics');
console.log('-------------------------------------------');
‚ãÆ----
const result = await makeRequest('/api/analytics/session', 'POST', sessionData);
‚ãÆ----
console.log('‚úÖ Sesi√≥n creada exitosamente');
console.log(`   Session ID: ${result.data.session_id}`);
console.log(`   An√≥nima: ${result.data.anonymous ? 'S√≠' : 'No'}`);
‚ãÆ----
console.log('‚ùå Error al crear sesi√≥n');
console.log(`   Status: ${result.status}`);
console.log(`   Error: ${JSON.stringify(result.data || result.error)}`);
‚ãÆ----
async function testPropertyView(sessionId, propertyId = 38) {
console.log('\nüè† Test 2: Tracking de vista de propiedad');
console.log('----------------------------------------');
‚ãÆ----
const result = await makeRequest('/api/analytics/property-view', 'POST', viewData);
‚ãÆ----
console.log('‚úÖ Vista de propiedad registrada exitosamente');
console.log(`   Event ID: ${result.data.event_id}`);
console.log(`   Propiedad: ${propertyId}`);
console.log(`   Tiempo en p√°gina: ${viewData.time_on_page}s`);
console.log(`   Scroll depth: ${viewData.scroll_depth}%`);
console.log(`   Im√°genes vistas: ${viewData.images_viewed}`);
console.log(`   WhatsApp clicked: ${viewData.whatsapp_clicked ? 'S√≠' : 'No'}`);
‚ãÆ----
console.log('‚ùå Error al registrar vista de propiedad');
‚ãÆ----
async function testAutoPropertyView(propertyId = 39) {
console.log('\nüîÑ Test 3: Tracking autom√°tico con sesi√≥n');
console.log('------------------------------------------');
‚ãÆ----
const result = await makeRequest('/api/analytics/property-view', 'PUT', autoViewData);
‚ãÆ----
console.log('‚úÖ Vista autom√°tica registrada exitosamente');
‚ãÆ----
console.log(`   Tiempo en p√°gina: ${autoViewData.time_on_page}s`);
console.log(`   Contacto clickeado: ${autoViewData.contact_button_clicked ? 'S√≠' : 'No'}`);
console.log(`   Tel√©fono clickeado: ${autoViewData.phone_clicked ? 'S√≠' : 'No'}`);
console.log(`   Dispositivo: ${autoViewData.device_type}`);
console.log(`   Fuente: ${autoViewData.utm_source} / ${autoViewData.utm_medium}`);
‚ãÆ----
console.log('‚ùå Error al registrar vista autom√°tica');
‚ãÆ----
async function testUserInteractions(sessionId, propertyId = 38) {
console.log('\nüëÜ Test 4: Tracking de interacciones espec√≠ficas');
console.log('-----------------------------------------------');
‚ãÆ----
const result = await makeRequest('/api/analytics/interaction', 'POST', interactions[i]);
‚ãÆ----
console.log(`‚úÖ Interacci√≥n ${i + 1} registrada: ${interactions[i].event_type}`);
‚ãÆ----
console.log(`‚ùå Error en interacci√≥n ${i + 1}: ${interactions[i].event_type}`);
‚ãÆ----
console.log(`üìä Resumen: ${successCount}/${interactions.length} interacciones registradas`);
‚ãÆ----
async function testPropertyMetrics(propertyId = 38) {
console.log('\nüìà Test 5: Obtenci√≥n de m√©tricas de propiedad');
console.log('--------------------------------------------');
‚ãÆ----
const result = await makeRequest(`/api/analytics/property-metrics/${propertyId}?days_back=30`);
‚ãÆ----
console.log('‚úÖ M√©tricas obtenidas exitosamente');
‚ãÆ----
console.log(`   Total de vistas: ${metrics.total_views || 0}`);
console.log(`   Sesiones √∫nicas: ${metrics.unique_sessions || 0}`);
console.log(`   Duraci√≥n promedio: ${metrics.avg_duration ? Math.round(metrics.avg_duration) + 's' : 'N/A'}`);
console.log(`   Total interacciones: ${metrics.total_interactions || 0}`);
console.log(`   Leads generados: ${metrics.leads_generated || 0}`);
console.log(`   Tasa de conversi√≥n: ${metrics.conversion_rate ? metrics.conversion_rate.toFixed(2) + '%' : '0%'}`);
‚ãÆ----
console.log('‚ùå Error al obtener m√©tricas');
‚ãÆ----
async function testDashboardStats() {
console.log('\nüìä Test 6: Dashboard general de analytics');
‚ãÆ----
const result = await makeRequest('/api/analytics/dashboard?period=30d');
‚ãÆ----
console.log('‚úÖ Datos de dashboard obtenidos exitosamente');
‚ãÆ----
console.log(`   Total sesiones: ${stats.total_sessions || 0}`);
console.log(`   Vistas de propiedades: ${stats.total_property_views || 0}`);
console.log(`   Vistas √∫nicas: ${stats.unique_property_views || 0}`);
console.log(`   Total de leads: ${stats.total_leads || 0}`);
console.log(`   Tasa de conversi√≥n: ${stats.conversion_rate ? stats.conversion_rate.toFixed(2) + '%' : '0%'}`);
console.log(`   Tiempo promedio: ${stats.avg_time_on_page ? Math.round(stats.avg_time_on_page) + 's' : 'N/A'}`);
‚ãÆ----
console.log('   Top propiedades:');
stats.top_properties.slice(0, 3).forEach((prop, index) => {
console.log(`     ${index + 1}. ID ${prop.property_id}: ${prop.title || 'Sin t√≠tulo'} (${prop.metric_value} vistas)`);
‚ãÆ----
console.log('‚ùå Error al obtener datos de dashboard');
‚ãÆ----
async function runAnalyticsTest() {
console.log('üöÄ Comenzando tests de analytics de propiedades...\n');
‚ãÆ----
const sessionId = await testCreateSession();
‚ãÆ----
console.log('\n‚ùå ERROR CR√çTICO: No se pudo crear sesi√≥n. Deteniendo tests.');
‚ãÆ----
const eventId1 = await testPropertyView(sessionId, 38);
‚ãÆ----
const autoResult = await testAutoPropertyView(39);
‚ãÆ----
await testUserInteractions(sessionId, 38);
‚ãÆ----
console.log('\n‚è≥ Esperando procesamiento de datos...');
await new Promise(resolve => setTimeout(resolve, 2000));
‚ãÆ----
await testPropertyMetrics(38);
await testPropertyMetrics(39);
‚ãÆ----
await testDashboardStats();
‚ãÆ----
console.log('\nüéâ TESTS COMPLETADOS');
console.log('====================');
console.log('‚úÖ Sistema de analytics de propiedades funcionando correctamente');
console.log('‚úÖ Tracking de vistas, interacciones y m√©tricas operativo');
console.log('‚úÖ Dashboard y reportes accesibles');
‚ãÆ----
console.log('\nüí• ERROR DURANTE LOS TESTS');
console.log('==========================');
console.log('‚ùå Error:', error.message);
console.log('‚ùå Stack:', error.stack);
‚ãÆ----
console.log('‚ùå Este script requiere Node.js 18+ con fetch nativo');
console.log('   O instalar node-fetch: npm install node-fetch');
process.exit(1);
‚ãÆ----
runAnalyticsTest().catch(console.error);
</file>

<file path="test-fix-with-api.js">
dotenv.config()
‚ãÆ----
async function makeRequest(endpoint, method = 'GET', data = null) {
‚ãÆ----
options.body = JSON.stringify(data)
‚ãÆ----
const response = await fetch(url, options)
const result = await response.json()
‚ãÆ----
async function testFixAndAnalytics() {
console.log('üß™ APLICANDO FIX Y TESTEANDO ANALYTICS')
console.log('=====================================\n')
‚ãÆ----
console.log('üîß Paso 1: Intentando aplicar fix v√≠a API...')
‚ãÆ----
console.log('\nüìä Paso 2: Creando sesi√≥n de prueba...')
‚ãÆ----
const sessionResult = await makeRequest('/api/analytics/session', 'POST', sessionData)
‚ãÆ----
console.log('‚ùå No se pudo crear sesi√≥n')
console.log(`   Error: ${JSON.stringify(sessionResult.data || sessionResult.error)}`)
‚ãÆ----
console.log(`‚úÖ Sesi√≥n creada exitosamente: ${sessionId}`)
‚ãÆ----
console.log('\nüè† Paso 3: Probando vista de propiedad (antes del fix)...')
‚ãÆ----
const viewBeforeResult = await makeRequest('/api/analytics/property-view', 'POST', viewDataBefore)
‚ãÆ----
console.log('‚úÖ Vista de propiedad funciona correctamente - No necesita fix')
‚ãÆ----
console.log('‚ùå Vista de propiedad falla - Necesita fix')
console.log(`   Error: ${viewBeforeResult.data?.error || viewBeforeResult.error}`)
‚ãÆ----
if (viewBeforeResult.data?.error?.includes('foreign key constraint')) {
console.log('\nüîß APLICANDO FIX AUTOM√ÅTICO...')
console.log('El sistema detect√≥ el problema de foreign keys')
‚ãÆ----
const fixResult = await makeRequest('/api/analytics/fix-foreign-keys', 'POST', {
‚ãÆ----
console.log('‚úÖ Fix aplicado exitosamente')
‚ãÆ----
console.log('\nüè† Paso 4: Probando vista de propiedad (despu√©s del fix)...')
‚ãÆ----
const newSessionResult = await makeRequest('/api/analytics/session', 'POST', sessionData)
‚ãÆ----
const viewAfterResult = await makeRequest('/api/analytics/property-view', 'POST', viewDataAfter)
‚ãÆ----
console.log('üéâ ¬°FIX EXITOSO! Vista de propiedad funciona correctamente')
‚ãÆ----
console.log('‚ùå Vista de propiedad sigue fallando despu√©s del fix')
console.log(`   Error: ${viewAfterResult.data?.error || viewAfterResult.error}`)
‚ãÆ----
console.log('‚ùå No se pudo aplicar el fix autom√°ticamente')
console.log(`   Error: ${fixResult.data?.error || fixResult.error}`)
‚ãÆ----
console.log('\nüî® APLICANDO FIX MANUAL...')
return await applyManualFix()
‚ãÆ----
console.log('\nüí• ERROR DURANTE EL TEST')
console.log('=======================')
console.log('‚ùå Error:', error.message)
‚ãÆ----
async function applyManualFix() {
console.log('üî® APLICANDO FIX MANUAL DE FOREIGN KEYS')
console.log('======================================')
‚ãÆ----
console.log('\nüìã INSTRUCCIONES PARA FIX MANUAL:')
console.log('1. El problema est√° en que analytics_property_views.session_id hace referencia a analytics_sessions.id')
console.log('2. Pero el c√≥digo env√≠a analytics_sessions.session_id')
console.log('3. Necesitamos modificar el servicio para obtener el ID correcto')
‚ãÆ----
console.log('\nüîß CREANDO SOLUCI√ìN ALTERNATIVA...')
‚ãÆ----
console.log('\nüìÑ PARCHE CREADO EN: services-analytics-patch.txt')
console.log('   Este parche modifica temporalmente el servicio para resolver el foreign key')
console.log('   Para aplicarlo permanentemente, necesitas modificar services/analytics.ts')
‚ãÆ----
require('fs').writeFileSync('./services-analytics-patch.txt', servicesPatch)
console.log('‚úÖ Archivo de parche creado exitosamente')
‚ãÆ----
console.log('\nüö® ACCI√ìN REQUERIDA:')
console.log('1. Aplicar el parche manualmente a services/analytics.ts')
console.log('2. O ejecutar el script fix-analytics-foreign-keys.sql en Supabase')
console.log('3. Reiniciar el servidor de desarrollo')
console.log('4. Volver a ejecutar el test')
‚ãÆ----
console.log('‚ùå Error creando archivo de parche:', writeError.message)
‚ãÆ----
console.log('‚ùå Este script requiere Node.js 18+ con fetch nativo')
process.exit(1)
‚ãÆ----
testFixAndAnalytics().then(success => {
‚ãÆ----
console.log('\nüéâ PROCESO COMPLETADO EXITOSAMENTE')
console.log('El sistema de analytics est√° funcionando correctamente')
‚ãÆ----
console.log('\n‚ö†Ô∏è PROCESO COMPLETADO CON PROBLEMAS')
console.log('Revisa los logs arriba para m√°s detalles')
‚ãÆ----
}).catch(console.error)
</file>

<file path="types/settings.ts">
export interface SocialMediaLinks {
  facebook?: string | null
  instagram?: string | null
  linkedin?: string | null
  youtube?: string | null
  twitter?: string | null
}
‚ãÆ----
export interface BrandColors {
  primary: string
  secondary: string
}
‚ãÆ----
export interface ContactMethods {
  whatsapp_enabled: boolean
  phone_enabled: boolean
  email_enabled: boolean
  contact_form_enabled: boolean
}
‚ãÆ----
export interface BusinessHour {
  open: string
  close: string
  closed: boolean
}
‚ãÆ----
export interface BusinessHours {
  monday: BusinessHour
  tuesday: BusinessHour
  wednesday: BusinessHour
  thursday: BusinessHour
  friday: BusinessHour
  saturday: BusinessHour
  sunday: BusinessHour
}
‚ãÆ----
export interface SiteSettings {
  id: string


  company_name: string
  company_description?: string | null
  contact_email: string
  contact_phone: string
  whatsapp_number?: string | null
  address: string
  website_url?: string | null


  social_media: SocialMediaLinks


  logo_url?: string | null
  logo_dark_url?: string | null
  favicon_url?: string | null
  brand_colors: BrandColors


  meta_title: string
  meta_description: string
  meta_keywords?: string | null
  google_analytics_id?: string | null
  google_tag_manager_id?: string | null


  contact_methods: ContactMethods


  business_hours: BusinessHours


  settings_data: Record<string, any>


  created_at: string
  updated_at: string
}
‚ãÆ----
export interface SiteSettingsInput {
  company_name?: string
  company_description?: string | null
  contact_email?: string
  contact_phone?: string
  whatsapp_number?: string | null
  address?: string
  website_url?: string | null
  social_media?: Partial<SocialMediaLinks>
  logo_url?: string | null
  logo_dark_url?: string | null
  favicon_url?: string | null
  brand_colors?: Partial<BrandColors>
  meta_title?: string
  meta_description?: string
  meta_keywords?: string | null
  google_analytics_id?: string | null
  google_tag_manager_id?: string | null
  contact_methods?: Partial<ContactMethods>
  business_hours?: Partial<BusinessHours>
  settings_data?: Record<string, any>
}
‚ãÆ----
export interface SiteSettingsFormData {

  company_name: string
  company_description: string
  contact_email: string
  contact_phone: string
  whatsapp_number: string
  address: string
  website_url: string


  social_facebook: string
  social_instagram: string
  social_linkedin: string
  social_youtube: string
  social_twitter: string


  meta_title: string
  meta_description: string
  meta_keywords: string
  google_analytics_id: string
  google_tag_manager_id: string


  whatsapp_enabled: boolean
  phone_enabled: boolean
  email_enabled: boolean
  contact_form_enabled: boolean


  brand_primary_color: string
  brand_secondary_color: string
}
‚ãÆ----
export interface SettingsValidationSchema {
  company: {
    company_name: string
    company_description?: string
    contact_email: string
    contact_phone: string
    whatsapp_number?: string
    address: string
    website_url?: string
  }
  social: {
    facebook?: string
    instagram?: string
    linkedin?: string
    youtube?: string
    twitter?: string
  }
  seo: {
    meta_title: string
    meta_description: string
    meta_keywords?: string
    google_analytics_id?: string
    google_tag_manager_id?: string
  }
  contact: {
    whatsapp_enabled: boolean
    phone_enabled: boolean
    email_enabled: boolean
    contact_form_enabled: boolean
  }
  branding: {
    primary_color: string
    secondary_color: string
  }
}
‚ãÆ----
export interface SiteSettingsResponse {
  success: boolean
  data?: SiteSettings
  error?: string
}
‚ãÆ----
export interface SiteSettingsUpdateResponse {
  success: boolean
  data?: SiteSettings
  message?: string
  error?: string
}
‚ãÆ----
export type SocialMediaPlatform = keyof typeof SOCIAL_MEDIA_DOMAINS
</file>

<file path=".env.example">
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-key
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=your-google-maps-api-key
</file>

<file path="app/admin/analytics/page.tsx">
import ExecutiveOverview from "@/components/admin/ExecutiveOverview"
‚ãÆ----
export default function AdminAnalyticsPage()
</file>

<file path="app/api/analytics/dashboard/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { AnalyticsService } from "@/services/analytics"
import { type AnalyticsFilters, type AnalyticsMetricType } from "@/types/analytics"
‚ãÆ----
function getRateLimitKey(request: NextRequest): string
‚ãÆ----
function checkRateLimit(key: string):
‚ãÆ----
function addSecurityHeaders(response: NextResponse): NextResponse
‚ãÆ----
function addCacheHeaders(response: NextResponse, maxAge: number = CACHE_MAX_AGE): NextResponse
‚ãÆ----
export async function GET(request: NextRequest)
‚ãÆ----
export async function POST(request: NextRequest)
</file>

<file path="components/admin/AnalyticsDashboard.tsx">
import { useState, useEffect } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Input } from "@/components/ui/input"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import {
  TrendingUp,
  TrendingDown,
  Eye,
  Users,
  Target,
  Clock,
  Phone,
  MessageCircle,
  Mail,
  Globe,
  Building2,
  Smartphone,
  Monitor,
  Tablet,
  Calendar,
  BarChart3,
  PieChart,
  Activity,
  MousePointer,
  ArrowRight,
  RefreshCw
} from "lucide-react"
import { LeadSourceStats } from "@/components/LeadSourceSelector"
‚ãÆ----
interface DashboardStats {
  total_sessions: number
  total_property_views: number
  unique_property_views: number
  total_leads: number
  conversion_rate: number
  avg_time_on_page: number
  top_properties: TopProperty[]
  top_lead_sources: LeadSourceStat[]
  traffic_by_device: DeviceTypeStat[]
  daily_stats: DailyStat[]
}
‚ãÆ----
interface TopProperty {
  property_id: number
  title: string
  metric_value: number
  unique_views: number
  leads: number
}
‚ãÆ----
interface LeadSourceStat {
  source_id: number
  source_name: string
  leads_count: number
  conversion_rate: number
}
‚ãÆ----
interface DeviceTypeStat {
  device_type: string
  sessions: number
  percentage: number
}
‚ãÆ----
interface DailyStat {
  date: string
  sessions: number
  views: number
  leads: number
}
‚ãÆ----
interface PropertyMetrics {
  property_id: number
  total_views: number
  unique_views: number
  avg_time_on_page: number | null
  avg_scroll_depth: number | null
  contact_rate: number | null
  leads_generated: number
  conversion_rate: number | null
}
‚ãÆ----
const fetchAnalyticsData = async () =>
‚ãÆ----
const formatNumber = (num: number): string =>
‚ãÆ----
const formatDuration = (seconds: number): string =>
‚ãÆ----
const getDeviceIcon = (deviceType: string) =>
‚ãÆ----
const getTrendIcon = (value: number, isInverted: boolean = false) =>
‚ãÆ----

‚ãÆ----
<span className="text-gray-400">
‚ãÆ----
<h4 className="text-white font-medium">
‚ãÆ----
<span>
‚ãÆ----
<span className="text-white">
</file>

<file path="components/admin/PropertyForm.tsx">
import type React from "react"
‚ãÆ----
import { useState, useEffect } from "react"
import { useRouter } from "next/navigation"
import { zodResolver } from "@hookform/resolvers/zod"
import { useForm } from "react-hook-form"
‚ãÆ----
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Checkbox } from "@/components/ui/checkbox"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { toast } from "@/hooks/use-toast"
import { X, Plus, Upload, GripVertical } from "lucide-react"
import {
  DndContext,
  closestCenter,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
  type DragEndEvent,
} from '@dnd-kit/core'
import {
  arrayMove,
  SortableContext,
  sortableKeyboardCoordinates,
  rectSortingStrategy,
} from '@dnd-kit/sortable'
import {
  useSortable,
} from '@dnd-kit/sortable'
import { CSS } from '@dnd-kit/utilities'
import { PropertyLocationPicker } from './PropertyLocationPicker'
‚ãÆ----
type PropertyFormData = z.infer<typeof propertySchema>
‚ãÆ----
interface PropertyFormProps {
  property?: any
  onSubmit?: (data: PropertyFormData) => void
}
‚ãÆ----
interface SortableImageItemProps {
  id: string
  image: string
  index: number
  onRemove: (index: number) => void
  isFirst: boolean
}
‚ãÆ----
const router = useRouter()
const [images, setImages] = useState<string[]>([])
const [features, setFeatures] = useState<string[]>([])
const [newFeature, setNewFeature] = useState("")
const [isSubmitting, setIsSubmitting] = useState(false)
const [uploadingImages, setUploadingImages] = useState(false)
‚ãÆ----
const sensors = useSensors(
‚ãÆ----
const removeImage = (index: number) =>
‚ãÆ----
const addFeature = () =>
‚ãÆ----
const removeFeature = (index: number) =>
‚ãÆ----
const handleLocationChange = (lat: number, lng: number) =>
‚ãÆ----
const handleAddressChange = (address: string, neighborhood: string, city: string, province: string) =>
‚ãÆ----
const onFormSubmit = async (data: PropertyFormData) =>
‚ãÆ----
<form onSubmit=
‚ãÆ----
value=
onValueChange=
</file>

<file path="components/layouts/analytics-dashboard-layout.tsx">
import React from 'react'
import { cn } from '@/lib/utils'
import { ChevronRight, Home } from 'lucide-react'
import { Button } from '@/components/ui/button'
import ModuleTabs from '@/components/navigation/module-tabs'
‚ãÆ----
interface BreadcrumbItem {
  label: string
  href?: string
  active?: boolean
}
‚ãÆ----
interface AnalyticsDashboardLayoutProps {
  children: React.ReactNode
  title: string
  subtitle?: string
  actions?: React.ReactNode
  filters?: React.ReactNode
  breadcrumbs?: BreadcrumbItem[]
  className?: string
  loading?: boolean
}
</file>

<file path="components/layouts/index.ts">
export type LayoutPresetKey = keyof typeof LAYOUT_PRESETS
export type AnalyticsModuleId = typeof ANALYTICS_MODULES[number]['id']
</file>

<file path="components/ui/analytics-demo.tsx">
import React, { useState } from "react"
import {
  KPICard,
  ChartContainer,
  TrendIndicator,
  MetricsBadge,
  DataTable,
  SkeletonKPI,
  SkeletonChart,
  SkeletonTable,
  type ColumnDef
} from "./analytics"
import { Home, Eye, Users, TrendingUp, AlertTriangle, CheckCircle } from "lucide-react"
‚ãÆ----
interface PropertyData {
  id: string
  name: string
  views: number
  leads: number
  status: "active" | "inactive" | "pending"
  price: number
}
‚ãÆ----
const toggleLoading = () =>
</file>

<file path="package.json">
{
  "name": "my-v0-project",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "build": "next build",
    "dev": "next dev -H 0.0.0.0 -p 5000",
    "lint": "next lint",
    "local": "next dev",
    "start": "next start"
  },
  "dependencies": {
    "@dnd-kit/core": "^6.3.1",
    "@dnd-kit/sortable": "^10.0.0",
    "@dnd-kit/utilities": "^3.2.2",
    "@emotion/is-prop-valid": "latest",
    "@hookform/resolvers": "latest",
    "@radix-ui/react-accordion": "latest",
    "@radix-ui/react-alert-dialog": "latest",
    "@radix-ui/react-aspect-ratio": "latest",
    "@radix-ui/react-avatar": "latest",
    "@radix-ui/react-checkbox": "latest",
    "@radix-ui/react-collapsible": "latest",
    "@radix-ui/react-context-menu": "latest",
    "@radix-ui/react-dialog": "latest",
    "@radix-ui/react-dropdown-menu": "latest",
    "@radix-ui/react-hover-card": "latest",
    "@radix-ui/react-label": "latest",
    "@radix-ui/react-menubar": "latest",
    "@radix-ui/react-navigation-menu": "latest",
    "@radix-ui/react-popover": "latest",
    "@radix-ui/react-progress": "latest",
    "@radix-ui/react-radio-group": "latest",
    "@radix-ui/react-scroll-area": "latest",
    "@radix-ui/react-select": "latest",
    "@radix-ui/react-separator": "latest",
    "@radix-ui/react-slider": "latest",
    "@radix-ui/react-slot": "latest",
    "@radix-ui/react-switch": "latest",
    "@radix-ui/react-tabs": "latest",
    "@radix-ui/react-toast": "latest",
    "@radix-ui/react-toggle": "latest",
    "@radix-ui/react-toggle-group": "latest",
    "@radix-ui/react-tooltip": "latest",
    "@supabase/auth-helpers-nextjs": "^0.8.7",
    "@supabase/supabase-js": "latest",
    "@tanstack/react-query": "^5.90.2",
    "autoprefixer": "^10.4.20",
    "class-variance-authority": "^0.7.1",
    "cloudinary": "latest",
    "clsx": "^2.1.1",
    "cmdk": "latest",
    "date-fns": "4.1.0",
    "embla-carousel": "^8.6.0",
    "embla-carousel-autoplay": "^8.6.0",
    "embla-carousel-react": "latest",
    "framer-motion": "latest",
    "input-otp": "latest",
    "leaflet": "^1.9.4",
    "leaflet-defaulticon-compatibility": "^0.1.2",
    "lucide-react": "^0.454.0",
    "next": "15.2.4",
    "next-themes": "latest",
    "react": "^19",
    "react-day-picker": "latest",
    "react-dom": "^19",
    "react-hook-form": "latest",
    "react-leaflet": "^5.0.0",
    "react-resizable-panels": "latest",
    "recharts": "latest",
    "sonner": "latest",
    "tailwind-merge": "^2.5.5",
    "tailwindcss": "^3.3.0",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "latest",
    "zod": "^4.0.5",
    "zustand": "^5.0.8"
  },
  "devDependencies": {
    "@tanstack/react-query-devtools": "^5.90.2",
    "@types/leaflet": "^1.9.20",
    "@types/node": "^22",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.0.1",
    "eslint": "^8",
    "eslint-config-next": "14.0.3",
    "postcss": "^8.5",
    "typescript": "^5"
  }
}
</file>

<file path="tailwind.config.ts">
import type { Config } from "tailwindcss"
</file>

<file path="app/api/analytics/property-metrics/[id]/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { AnalyticsService } from "@/services/analytics"
import {
  getRateLimitKey,
  checkRateLimit,
  addRateLimitHeaders,
  addSecurityHeaders,
  addCacheHeaders,
  createSuccessResponse,
  createErrorResponse,
  addPerformanceHeaders,
  API_CONFIG
} from "@/lib/api-utils"
‚ãÆ----
interface RouteParams {
  params: {
    id: string
  }
}
‚ãÆ----
export async function GET(request: NextRequest,
</file>

<file path="app/contacto/page.tsx">
import { useState } from "react";
import { motion } from "framer-motion";
import {
  Phone,
  Mail,
  MapPin,
  Clock,
  MessageCircle,
  Send,
  Check,
  ArrowRight,
  Building2,
  Users,
  Award,
  Star,
  Facebook,
  Instagram,
  Globe,
  HeadphonesIcon,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Card, CardContent } from "@/components/ui/card";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import Image from "next/image";
import Link from "next/link";
import Header from "@/components/Header"
import Footer from "@/components/Footer"
import { LeadSourceSelector, useLeadSourceDetection, useLeadSourceSelector } from "@/components/LeadSourceSelector"
import { useAnalytics } from "@/hooks/useAnalytics"
import { trackLead } from '@/lib/analytics-client'
import { type LeadSourceCode, LEAD_SOURCE_CODES } from "@/types/analytics"
‚ãÆ----
// Analytics and lead source tracking
‚ãÆ----
const handleSubmitContact = async (e: React.FormEvent) =>
‚ãÆ----
// Create the lead first
‚ãÆ----
// Track the lead generation in analytics
‚ãÆ----
undefined, // no specific property
‚ãÆ----
// Handle phone contact lead generation
const handlePhoneClick = async () =>
‚ãÆ----
// Track the lead generation in analytics
‚ãÆ----
// Handle WhatsApp contact lead generation
const handleWhatsAppClick = async () =>
‚ãÆ----
// Track the lead generation in analytics
‚ãÆ----
// Handle email contact lead generation
const handleEmailClick = async () =>
‚ãÆ----
// Track the lead generation in analytics
‚ãÆ----
// Handle social media contact lead generation
const handleSocialClick = async (platform: 'facebook' | 'instagram') =>
‚ãÆ----
// Track the lead generation in analytics
‚ãÆ----
onClick=
</file>

<file path="app/layout.tsx">
import type React from "react"
import type { Metadata } from "next"
import { Inter, Playfair_Display } from "next/font/google"
‚ãÆ----
import { Toaster } from "@/components/ui/toaster"
import { ThemeProvider } from "@/components/theme-provider"
import { QueryProvider } from "@/components/providers/query-provider"
import { AnalyticsStoreProvider } from "@/components/providers/analytics-store-provider"
import AnalyticsInitializer from "@/components/AnalyticsInitializer"
‚ãÆ----
export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>)
</file>

<file path="components/admin/AdminLayout.tsx">
import type React from "react"
‚ãÆ----
import { useState } from "react"
import Link from "next/link"
import { usePathname } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet"
import { Users, Building2, Menu, ExternalLink, BarChart3 } from "lucide-react"
</file>

<file path="components/admin/Dashboard.tsx">
import { useState, useEffect } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import {
  Home,
  Users,
  TrendingUp,
  MessageSquare,
  Phone,
  Mail,
  Calendar,
  AlertCircle,
  Target,
  Clock,
  BarChart3,
  Activity,
  ArrowRight
} from "lucide-react"
import Link from "next/link"
import { useContacts } from "@/hooks/useContacts"
import { useContactMetrics } from "@/hooks/useContactMetrics"
‚ãÆ----
const fetchProperties = async () =>
‚ãÆ----
Distribuci√≥n por Prioridad
</file>

<file path="components/admin/ExecutiveOverview.tsx">
import React, { useState, useEffect } from 'react'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { KPICard } from '@/components/ui/kpi-card'
import { TrendIndicator } from '@/components/ui/trend-indicator'
import { Badge } from '@/components/ui/badge'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import {
  AnalyticsDashboardLayout,
  WidgetGrid,
  buildAnalyticsBreadcrumbs,
  FilterBar
} from '@/components/layouts'
import {
  TrendingUp,
  TrendingDown,
  Users,
  Building,
  Target,
  DollarSign,
  Eye,
  Activity,
  RefreshCw,
  Calendar,
  Download,
  Settings,
  Plus,
  ArrowRight,
  Clock,
  Phone,
  Mail,
  MessageCircle,
  BarChart3,
  PieChart
} from 'lucide-react'
import { useAnalyticsDashboard } from '@/hooks/useAnalyticsDashboard'
import { useRealTimeUpdates } from '@/hooks/useRealTimeUpdates'
import { InteractiveChart } from '@/components/ui/interactive-chart'
‚ãÆ----
interface ExecutiveKPIs {
  totalRevenue: {
    value: number
    change: number
    period: string
  }
  totalLeads: {
    value: number
    change: number
    goal: number
  }
  conversionRate: {
    value: number
    change: number
    benchmark: number
  }
  activeProperties: {
    value: number
    change: number
    total: number
  }
}
‚ãÆ----
interface QuickAction {
  id: string
  label: string
  icon: React.ComponentType<{ className?: string }>
  action: () => void
  badge?: string
}
‚ãÆ----
interface RevenueChartProps {
  period: { value: string; label: string; days: number }
  data: any
  loading: boolean
}
‚ãÆ----
function RevenueChart(
‚ãÆ----
const generateRevenueData = () =>
‚ãÆ----
{/* Interactive Chart */}
‚ãÆ----
onPointClick=
‚ãÆ----
{/* Quick Stats */}
‚ãÆ----
const days = Math.ceil((range.to.getTime() - range.from.getTime()) / (1000 * 60 * 60 * 24))
</file>

<file path="components/admin/PropertyLocationPicker.tsx">
import React, { useEffect, useState, useCallback } from 'react'
import dynamic from 'next/dynamic'
import { Button } from '@/components/ui/button'
import { geocodeAddress, reverseGeocodeCoordinates, formatAddress, createPropertyMarkerIcon, RECONQUISTA_CENTER, ARGENTINA_BOUNDS } from '@/lib/map-config'
import { MapPin, RotateCcw, Navigation } from 'lucide-react'
import { toast } from '@/hooks/use-toast'
‚ãÆ----
interface PropertyLocationPickerProps {
  address?: string
  neighborhood?: string
  city?: string
  province?: string
  latitude?: number
  longitude?: number
  onLocationChange?: (lat: number, lng: number) => void
  onAddressChange?: (address: string, neighborhood: string, city: string, province: string) => void
  className?: string
}
‚ãÆ----
export function PropertyLocationPicker({
  address,
  neighborhood,
  city = "Reconquista",
  province = "Santa Fe",
  latitude,
  longitude,
  onLocationChange,
  onAddressChange,
  className = "h-80"
}: PropertyLocationPickerProps)
‚ãÆ----
const handleSyncFromAddress = async () =>
‚ãÆ----
const handleSyncFromMap = async () =>
‚ãÆ----
const handleResetLocation = () =>
</file>

<file path="components/Header.tsx">
import { useState, useEffect } from "react";
import { Search, Menu, X } from "lucide-react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import Image from "next/image";
import Link from "next/link";
import { usePathname } from "next/navigation";
import { useIsClient } from "@/hooks/use-is-client";
‚ãÆ----
interface HeaderProps {
  showMobileSearch?: boolean;
}
‚ãÆ----
const isActivePage = (path: string) =>
‚ãÆ----
const getLinkClassName = (path: string) =>
‚ãÆ----
const getContactLinkClassName = () =>
‚ãÆ----
const getAgentesLinkClassName = () =>
‚ãÆ----
const handleScroll = () =>
</file>

<file path="hooks/useAnalytics.ts">
import { useState, useEffect, useCallback, useRef } from "react"
import { type LeadSourceCode } from "@/types/analytics"
‚ãÆ----
class AnalyticsSession
‚ãÆ----
async getOrCreateSession(): Promise<string>
‚ãÆ----
private getDeviceType(): string
‚ãÆ----
private getBrowser(): string
‚ãÆ----
private getOS(): string
‚ãÆ----
private getReferrerDomain(): string | undefined
‚ãÆ----
private getUTMParams()
‚ãÆ----
async updateLastSeen(): Promise<void>
‚ãÆ----
export interface UseAnalyticsOptions {
  enableAutoTracking?: boolean
  trackScrollDepth?: boolean
  trackTimeOnPage?: boolean
  sessionUpdateInterval?: number
}
‚ãÆ----
export function useAnalytics(options: UseAnalyticsOptions =
‚ãÆ----
const initializeSession = async () =>
‚ãÆ----
const handleScroll = () =>
‚ãÆ----
export function usePropertyAnalytics(propertyId: number, options?: UseAnalyticsOptions)
</file>

<file path="hooks/useRealTimeUpdates.ts">
import { useQuery, useQueryClient } from '@tanstack/react-query'
import { useEffect, useRef, useState, useCallback } from 'react'
import { queryKeys, cacheStrategies, invalidateQueries } from '@/lib/react-query-config'
‚ãÆ----
export interface RealTimeMetrics {
  activeUsers: number
  currentViews: number
  todayLeads: number
  lastHourViews: number
  topActiveProperties: Array<{
    id: number
    title: string
    currentViews: number
    todayLeads: number
  }>
  recentEvents: Array<{
    id: string
    type: 'view' | 'lead' | 'interaction'
    propertyId: number
    propertyTitle: string
    timestamp: string
    deviceType: string
    source?: string
  }>
  systemStatus: {
    isHealthy: boolean
    responseTime: number
    errorRate: number
  }
}
‚ãÆ----
export interface UseRealTimeOptions {
  enabled?: boolean
  interval?: number
  maxEvents?: number
  enableNotifications?: boolean
  enableWebSocket?: boolean
}
‚ãÆ----
export interface RealTimeEvent {
  id: string
  type: 'view' | 'lead' | 'interaction' | 'system'
  data: any
  timestamp: string
}
‚ãÆ----
export function useRealTimeUpdates(options: UseRealTimeOptions =
‚ãÆ----
const handleVisibilityChange = () =>
‚ãÆ----
export function useActiveUsers()
‚ãÆ----
export function useLeadNotifications()
‚ãÆ----
function transformDashboardToRealtime(dashboardData: any): RealTimeMetrics
‚ãÆ----
function transformRealTimeMetrics(rawData: any): RealTimeMetrics
</file>

<file path="lib/map-config.ts">
export const createPropertyMarkerIcon = () =>
‚ãÆ----
export const geocodeAddress = async (address: string): Promise<[number, number] | null> =>
‚ãÆ----
// Fallback to Reconquista, Santa Fe coordinates
‚ãÆ----
// Reverse geocoding service - get address from coordinates
export const reverseGeocodeCoordinates = async (lat: number, lng: number): Promise<
‚ãÆ----
// Format address for display
export const formatAddress = (property: {
  address?: string | null
  neighborhood?: string | null
  city?: string
}) =>
</file>

<file path="types/analytics.ts">
export interface AnalyticsSession {
  id: string
  session_id: string
  ip_hash: string
  user_agent?: string
  device_type?: 'desktop' | 'mobile' | 'tablet'
  browser_name?: string
  browser_version?: string
  os_name?: string
  os_version?: string
  referrer_domain?: string
  utm_source?: string
  utm_medium?: string
  utm_campaign?: string
  utm_term?: string
  utm_content?: string
  country_code?: string
  city?: string
  language?: string
  timezone?: string
  screen_width?: number
  screen_height?: number
  opt_out: boolean
  first_seen_at: string
  last_seen_at: string
  created_at: string
}
‚ãÆ----
export interface AnalyticsPropertyView {
  id: string
  property_id: number
  session_id?: string
  view_duration_seconds: number
  page_url: string
  referrer_url?: string
  search_query?: string
  search_filters?: Record<string, any>
  interaction_events?: InteractionEvent[]
  scroll_percentage?: number
  images_viewed: number
  contact_form_opened: boolean
  contact_form_submitted: boolean
  phone_clicked: boolean
  whatsapp_clicked: boolean
  email_clicked: boolean
  viewed_at: string
  created_at: string
}
‚ãÆ----
export interface AnalyticsLeadSource {
  id: number
  name: string
  display_name: string
  description?: string
  category: 'web' | 'social' | 'direct' | 'referral' | 'advertising'
  icon?: string
  color?: string
  is_active: boolean
  sort_order: number
  created_at: string
  updated_at: string
}
‚ãÆ----
export interface AnalyticsLeadGeneration {
  id: string
  lead_id?: number
  session_id?: string
  property_id?: number
  lead_source_id?: number
  form_type?: string
  contact_method?: string
  lead_value?: number
  conversion_time_minutes?: number
  form_data?: Record<string, any>
  page_url?: string
  referrer_url?: string
  utm_source?: string
  utm_medium?: string
  utm_campaign?: string
  utm_term?: string
  utm_content?: string
  generated_at: string
  created_at: string
}
‚ãÆ----
export interface AnalyticsUserInteraction {
  id: string
  session_id?: string
  property_id?: number
  interaction_type: string
  element_id?: string
  element_class?: string
  element_text?: string
  page_url: string
  coordinates_x?: number
  coordinates_y?: number
  viewport_width?: number
  viewport_height?: number
  interaction_data?: Record<string, any>
  occurred_at: string
  created_at: string
}
‚ãÆ----
export interface InteractionEvent {
  type: string
  element?: string
  timestamp: number
  data?: Record<string, any>
}
‚ãÆ----
export interface CreateSessionRequest {
  ip_address?: string
  user_agent?: string
  referrer?: string
  utm_source?: string
  utm_medium?: string
  utm_campaign?: string
  utm_term?: string
  utm_content?: string
  screen_width?: number
  screen_height?: number
  timezone?: string
  language?: string
}
‚ãÆ----
export interface UpdateSessionRequest {
  session_id: string
  utm_source?: string
  utm_medium?: string
  utm_campaign?: string
  utm_term?: string
  utm_content?: string
}
‚ãÆ----
export interface TrackPropertyViewRequest {
  property_id: number
  session_id?: string
  page_url: string
  referrer_url?: string
  search_query?: string
  search_filters?: Record<string, any>
  time_on_page?: number
  scroll_depth?: number
  images_viewed?: number
  contact_form_opened?: boolean
  contact_form_submitted?: boolean
  phone_clicked?: boolean
  whatsapp_clicked?: boolean
  email_clicked?: boolean
  interactions?: InteractionEvent[]
}
‚ãÆ----
export interface TrackLeadGenerationRequest {
  lead_id?: number
  session_id?: string
  property_id?: number
  lead_source_id?: number
  source_code?: string
  form_type?: string
  contact_method?: string
  lead_value?: number
  form_data?: Record<string, any>
  page_url?: string
  referrer_url?: string
  utm_source?: string
  utm_medium?: string
  utm_campaign?: string
  utm_term?: string
  utm_content?: string
}
‚ãÆ----
export interface TrackUserInteractionRequest {
  session_id?: string
  property_id?: number
  interaction_type: string
  element_id?: string
  element_class?: string
  element_text?: string
  page_url: string
  coordinates_x?: number
  coordinates_y?: number
  viewport_width?: number
  viewport_height?: number
  interaction_data?: Record<string, any>
}
‚ãÆ----
export interface PropertyMetrics {
  property_id: number
  total_views: number
  unique_sessions: number
  avg_duration_seconds: number
  total_interactions: number
  leads_generated: number
  contact_forms_submitted: number
  phone_clicks: number
  whatsapp_clicks: number
  email_clicks: number
  conversion_rate: number
  bounce_rate: number
  time_period: string
}
‚ãÆ----
export interface DashboardMetrics {
  total_views: number
  unique_sessions: number
  total_leads: number
  conversion_rate: number
  avg_session_duration: number
  bounce_rate: number
  top_properties: PropertyPerformance[]
  lead_sources_performance: LeadSourcePerformance[]
  campaign_performance: CampaignPerformance[]
  device_breakdown: DeviceBreakdown[]
  time_series_data?: TimeSeriesData[]
}
‚ãÆ----
export interface PropertyPerformance {
  property_id: number
  title?: string
  total_views: number
  unique_sessions: number
  leads_generated: number
  conversion_rate: number
  avg_duration: number
}
‚ãÆ----
export interface LeadSourcePerformance {
  source_id: number
  source_name: string
  category: string
  total_leads: number
  conversion_rate: number
  avg_lead_value: number
  color?: string
  icon?: string
}
‚ãÆ----
export interface CampaignPerformance {
  campaign_name: string
  campaign_source: string
  sessions: number
  leads: number
  cost: number
  revenue: number
  roas: number
  ctr: number
  cpc: number
  cpl: number
}
‚ãÆ----
export interface DeviceBreakdown {
  device_type: string
  sessions: number
  percentage: number
  avg_duration: number
  conversion_rate: number
}
‚ãÆ----
export interface TimeSeriesData {
  date: string
  views: number
  sessions: number
  leads: number
  conversion_rate: number
}
‚ãÆ----
export interface DashboardRequest {
  start_date?: string
  end_date?: string
  property_id?: number
  device_type?: string
  utm_source?: string
  include_time_series?: boolean
  granularity?: 'hour' | 'day' | 'week' | 'month'
}
‚ãÆ----
export interface PropertyMetricsRequest {
  property_id: number
  days_back?: number
  include_interactions?: boolean
  include_lead_attribution?: boolean
}
‚ãÆ----
export class AnalyticsError extends Error
‚ãÆ----
constructor(message: string, code: string = 'ANALYTICS_ERROR', statusCode: number = 500)
‚ãÆ----
export class AnalyticsValidationError extends AnalyticsError
‚ãÆ----
constructor(message: string, field?: string)
‚ãÆ----
export class AnalyticsPrivacyError extends AnalyticsError
‚ãÆ----
constructor(message: string)
‚ãÆ----
export type LeadSourceCode = typeof LEAD_SOURCE_CODES[keyof typeof LEAD_SOURCE_CODES]
export type DeviceType = typeof DEVICE_TYPES[keyof typeof DEVICE_TYPES]
export type InteractionType = typeof INTERACTION_TYPES[keyof typeof INTERACTION_TYPES]
export type FormType = typeof FORM_TYPES[keyof typeof FORM_TYPES]
export type CampaignCategory = typeof CAMPAIGN_CATEGORIES[keyof typeof CAMPAIGN_CATEGORIES]
‚ãÆ----
export interface OptOutRequest {
  session_id?: string
  ip_address?: string
  reason?: string
}
‚ãÆ----
export interface OptOutResponse {
  success: boolean
  message: string
  affected_records: number
}
‚ãÆ----
export interface DatabaseFunctionResult<T> {
  data: T | null
  error: any
  count?: number
}
‚ãÆ----
export interface AnalyticsServiceConfig {
  supabaseUrl: string
  supabaseAnonKey: string
  enableGDPRCompliance: boolean
  defaultSessionDuration: number
  viewDebounceDuration: number
  maxInteractionBatchSize: number
}
‚ãÆ----
export interface CreateAnalyticsSessionInput {
  ip_address: string
  user_agent?: string
  country_code?: string
  device_type?: 'desktop' | 'mobile' | 'tablet'
  browser?: string
  os?: string
  referrer_domain?: string
  landing_page?: string
  utm_source?: string
  utm_medium?: string
  utm_campaign?: string
  utm_term?: string
  utm_content?: string
}
‚ãÆ----
export interface CreatePropertyViewInput {
  session_id: string
  property_id: number
  page_url?: string
  referrer_url?: string
  search_query?: string
  time_on_page?: number
  scroll_depth?: number
  contact_button_clicked?: boolean
  whatsapp_clicked?: boolean
  phone_clicked?: boolean
  email_clicked?: boolean
  images_viewed?: number
  map_interacted?: boolean
  similar_properties_clicked?: boolean
}
‚ãÆ----
export interface CreateLeadGenerationEventInput {
  lead_id: number
  session_id?: string
  property_id?: number
  lead_source_id: number
  form_type?: string
  time_to_conversion?: number
  conversion_page?: string
  utm_source?: string
  utm_medium?: string
  utm_campaign?: string
  utm_term?: string
  utm_content?: string
}
‚ãÆ----
export interface CreateUserInteractionEventInput {
  session_id: string
  property_id?: number
  event_type: string
  event_target?: string
  page_url?: string
  event_data?: any
  timestamp?: number
}
‚ãÆ----
export interface PropertyViewEvent {
  id: string
  property_id: number
  session_id?: string
  view_duration_seconds: number
  page_url: string
  referrer_url?: string
  viewed_at: string
  created_at: string
}
‚ãÆ----
export interface LeadGenerationEvent {
  id: string
  lead_id: number
  session_id?: string
  property_id?: number
  lead_source_id: number
  generated_at: string
  created_at: string
}
‚ãÆ----
export interface UserInteractionEvent {
  id: string
  session_id: string
  event_type: string
  event_target?: string
  page_url: string
  occurred_at: string
  created_at: string
}
‚ãÆ----
export interface TopPropertyResult {
  property_id: number
  title: string
  metric_value: number
  unique_views: number
  leads: number
}
‚ãÆ----
export interface DashboardStats {
  total_sessions: number
  total_property_views: number
  unique_property_views: number
  total_leads: number
  conversion_rate: number
  avg_time_on_page: number
  top_properties: TopPropertyResult[]
  top_lead_sources: Array<{
    source_id: number
    source_name: string
    leads_count: number
    conversion_rate: number
  }>
  traffic_by_device: Array<{
    device_type: string
    sessions: number
    percentage: number
  }>
  daily_stats: Array<{
    date: string
    sessions: number
    views: number
    leads: number
  }>
}
‚ãÆ----
export interface LeadSourceStats {
  source_id: number
  source_name: string
  leads_count: number
  avg_conversion_time?: number | null
  unique_sessions: number
  conversion_rate?: number | null
}
‚ãÆ----
export interface CampaignStats {
  utm_source: string
  utm_campaign: string | null
  sessions: number
  total_events: number
  leads: number
  avg_conversion_time: number | null
  roas: number | null
}
‚ãÆ----
export interface DeviceTypeStats {
  device_type: string
  sessions: number
  property_views: number
  leads: number
  conversion_rate: number
}
‚ãÆ----
export interface HourlyTrafficStats {
  hour: number
  sessions: number
  views: number
  leads: number
}
‚ãÆ----
export interface AnalyticsFilters {
  start_date?: string
  end_date?: string
  property_id?: number
  device_type?: string
  utm_source?: string
}
‚ãÆ----
export type AnalyticsMetricType = 'views' | 'leads' | 'conversion_rate'
‚ãÆ----
export interface PropertyMetrics {
  total_views: number
  unique_views: number
  avg_time_on_page: number | null
  avg_scroll_depth: number | null
  contact_rate: number | null
  leads_generated: number
  conversion_rate: number | null
}
</file>

<file path="app/api/analytics/modules/[module]/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { AnalyticsService } from "@/services/analytics"
import { type AnalyticsFilters } from "@/types/analytics"
‚ãÆ----
type ModuleType = typeof VALID_MODULES[number]
‚ãÆ----
function getRateLimitKey(request: NextRequest, module: string): string
‚ãÆ----
function checkRateLimit(key: string, limit: number = RATE_LIMIT):
‚ãÆ----
function addSecurityHeaders(response: NextResponse): NextResponse
‚ãÆ----
function addCacheHeaders(response: NextResponse, maxAge: number): NextResponse
‚ãÆ----
async function getOverviewData(filters: AnalyticsFilters)
‚ãÆ----
async function getSalesData(filters: AnalyticsFilters)
‚ãÆ----
async function getMarketingData(filters: AnalyticsFilters)
‚ãÆ----
async function getPropertiesData(filters: AnalyticsFilters)
‚ãÆ----
const enrichProperty = (analyticsData: any) =>
‚ãÆ----
async function getCustomersData(filters: AnalyticsFilters)
‚ãÆ----
export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ module: string }> }
)
‚ãÆ----
export async function POST(
  request: NextRequest,
  { params }: { params: Promise<{ module: string }> }
)
</file>

<file path="app/globals.css">
@tailwind base;
@tailwind components;
@tailwind utilities;
‚ãÆ----
@font-face {
‚ãÆ----
@layer base {
‚ãÆ----
:root {
‚ãÆ----
.dark {
‚ãÆ----
* {
‚ãÆ----
@apply border-border;
‚ãÆ----
body {
‚ãÆ----
@layer utilities {
‚ãÆ----
.display-xl { @apply font-inter font-bold uppercase tracking-wide; font-size: 4rem; line-height: 1.1; }
.display-lg { @apply font-inter font-bold uppercase tracking-wide; font-size: 3.5rem; line-height: 1.1; }
.display-md { @apply font-inter font-bold uppercase tracking-wide; font-size: 3rem; line-height: 1.2; }
.display-sm { @apply font-inter font-bold uppercase tracking-wide; font-size: 2.5rem; line-height: 1.2; }
‚ãÆ----
.heading-xl { @apply font-inter font-normal; font-size: 2rem; line-height: 1.3; }
.heading-lg { @apply font-inter font-normal; font-size: 1.75rem; line-height: 1.3; }
.heading-md { @apply font-inter font-normal; font-size: 1.5rem; line-height: 1.4; }
.heading-sm { @apply font-inter font-normal; font-size: 1.25rem; line-height: 1.4; }
‚ãÆ----
.body-xl { @apply font-inter font-light; font-size: 1.25rem; line-height: 1.7; }
.body-lg { @apply font-inter font-light; font-size: 1.125rem; line-height: 1.7; }
.body-md { @apply font-inter font-light; font-size: 1rem; line-height: 1.7; }
.body-sm { @apply font-inter font-light; font-size: 0.875rem; line-height: 1.7; }
‚ãÆ----
.caption-lg { @apply font-inter font-normal text-support-gray; font-size: 0.875rem; line-height: 1.5; }
.caption-md { @apply font-inter font-normal text-support-gray; font-size: 0.75rem; line-height: 1.5; }
.caption-sm { @apply font-inter font-normal text-support-gray; font-size: 0.625rem; line-height: 1.5; }
‚ãÆ----
.heading-primary { @apply text-bone-white; }
.heading-secondary { @apply text-bone-white; }
.text-secondary { @apply text-subtle-gray; }
.text-meta { @apply text-support-gray; }
‚ãÆ----
.hero-title {
‚ãÆ----
.section-title {
‚ãÆ----
.component-title {
‚ãÆ----
.subtitle {
‚ãÆ----
.body-text {
‚ãÆ----
.secondary-text {
‚ãÆ----
.section-spacing { @apply py-16 md:py-24; }
.component-spacing { @apply mb-8 md:mb-12; }
.element-spacing { @apply mb-4 md:mb-6; }
‚ãÆ----
.section-premium { @apply py-premium-lg md:py-premium-xl; }
.container-premium { @apply px-premium-sm md:px-premium-md; }
.card-premium { @apply p-premium-sm md:p-premium-md; }
‚ãÆ----
.bg-premium-main { @apply bg-night-blue; }
.bg-premium-card { @apply bg-night-blue/95 backdrop-blur-sm; }
.text-premium-primary { @apply text-bone-white; }
.text-premium-secondary { @apply text-subtle-gray; }
‚ãÆ----
.accent-premium { @apply text-vibrant-orange; }
.interactive-element { @apply text-vibrant-orange hover:text-vibrant-orange/90 transition-colors; }
‚ãÆ----
.hover-lift {
.hover-lift:hover {
‚ãÆ----
.hover-scale {
.hover-scale:hover {
‚ãÆ----
.premium-blur {
‚ãÆ----
.focus-ring {
.focus-ring:focus {
‚ãÆ----
.text-transition {
‚ãÆ----
.gradient-border {
‚ãÆ----
.pulse-premium {
‚ãÆ----
.hero-logo-dominant {
‚ãÆ----
.hero-title-primary {
‚ãÆ----
.hero-slogan-refined {
‚ãÆ----
.hero-subtitle-elegant {
‚ãÆ----
.hero-cta-prominent {
‚ãÆ----
.hero-cta-prominent:hover {
‚ãÆ----
.hero-overlay-strong {
‚ãÆ----
.hero-gradient-accent {
‚ãÆ----
.hero-grid-advanced {
‚ãÆ----
.hero-header { grid-area: header; }
.hero-content {
‚ãÆ----
.hero-footer {
‚ãÆ----
.premium-spacing-hero {
‚ãÆ----
button.cta {
button.cta:hover {
a.link-clave {
a.link-clave:hover {
‚ãÆ----
h1, h2, h3 {
.text-secundario {
.text-meta {
‚ãÆ----
.brand-accent-selective { color: #F37321; }
.hero-text-primary { color: #FFFFFF; }
.hero-text-secondary { color: rgba(245, 245, 245, 0.85); }
.hero-text-subtle { color: rgba(245, 245, 245, 0.7); }
‚ãÆ----
.hero-viewport-height {
‚ãÆ----
.analytics-grid {
‚ãÆ----
.analytics-grid-dense {
‚ãÆ----
.analytics-grid-responsive {
‚ãÆ----
.widget-container {
‚ãÆ----
.widget-container:hover {
‚ãÆ----
.widget-header {
‚ãÆ----
.widget-title {
‚ãÆ----
.widget-content {
‚ãÆ----
@apply space-y-3;
‚ãÆ----
.kpi-number {
‚ãÆ----
.kpi-number-large {
‚ãÆ----
.kpi-label {
‚ãÆ----
.kpi-description {
‚ãÆ----
.trend-positive {
‚ãÆ----
@apply text-trend-positive;
‚ãÆ----
.trend-negative {
‚ãÆ----
@apply text-trend-negative;
‚ãÆ----
.trend-neutral {
‚ãÆ----
@apply text-trend-neutral;
‚ãÆ----
.trend-indicator {
‚ãÆ----
.trend-arrow-up::before {
‚ãÆ----
.trend-arrow-down::before {
‚ãÆ----
.trend-arrow-neutral::before {
‚ãÆ----
.status-success {
‚ãÆ----
.status-warning {
‚ãÆ----
.status-error {
‚ãÆ----
.status-info {
‚ãÆ----
.status-neutral {
‚ãÆ----
.chart-container {
‚ãÆ----
.chart-tooltip {
‚ãÆ----
.chart-legend {
‚ãÆ----
.chart-legend-item {
‚ãÆ----
.chart-legend-dot {
‚ãÆ----
.data-table {
‚ãÆ----
.data-table th {
‚ãÆ----
.data-table td {
‚ãÆ----
.data-table tr:hover td {
‚ãÆ----
.progress-ring {
‚ãÆ----
.progress-bar {
‚ãÆ----
.progress-fill {
‚ãÆ----
.analytics-skeleton {
‚ãÆ----
.analytics-skeleton-text {
‚ãÆ----
.analytics-skeleton-number {
‚ãÆ----
.filter-panel {
‚ãÆ----
.filter-section {
‚ãÆ----
.filter-label {
‚ãÆ----
.filter-input {
‚ãÆ----
.analytics-responsive-hide-mobile {
‚ãÆ----
.analytics-responsive-show-mobile {
‚ãÆ----
.analytics-compact-mobile {
‚ãÆ----
.analytics-focus-visible:focus-visible {
‚ãÆ----
.analytics-screen-reader-only {
‚ãÆ----
@apply sr-only;
‚ãÆ----
.kpi-number, .kpi-number-large {
‚ãÆ----
@apply text-bone-white;
‚ãÆ----
.widget-container, .progress-fill, .analytics-skeleton {
</file>

<file path="components/admin/PropertiesPage.tsx">
import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import {
  Home,
  Plus,
  Search,
  Edit,
  Trash2,
  Star,
  Eye,
  MoreHorizontal,
  MapPin,
  Bed,
  Bath,
  Square,
  CheckCircle,
  XCircle,
  Clock,
  AlertCircle
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { Card, CardContent } from "@/components/ui/card";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
  DropdownMenuSeparator,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger
} from "@/components/ui/dropdown-menu";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue
} from "@/components/ui/select";
import { getOptimizedImageUrl } from "@/lib/cloudinary";
import { PropertyService } from "@/services/properties";
import type { Property } from "@/lib/supabase";
import { STATUS_MAP } from "@/lib/supabase";
‚ãÆ----
interface PropertyWithStats extends Property {
  views?: number;
  leads?: number;
}
‚ãÆ----
interface PropertyImageProps {
  images: string[];
  title: string;
}
‚ãÆ----
const handleMouseEnter = () =>
‚ãÆ----
const handleMouseLeave = () =>
‚ãÆ----
const fetchProperties = async () =>
‚ãÆ----
const handleDeleteProperty = async (id: number) =>
‚ãÆ----
const toggleFeatured = async (
    propertyId: number,
    currentFeatured: boolean
) =>
‚ãÆ----
const deleteProperty = async (propertyId: number) =>
‚ãÆ----
const changePropertyStatus = async (propertyId: number, newStatus: string) =>
‚ãÆ----
const getStatusBadgeVariant = (status: string) =>
‚ãÆ----
const getStatusDisplay = (status: string) =>
‚ãÆ----
const getStatusIcon = (status: string) =>
‚ãÆ----
const getStatusColor = (status: string) =>
‚ãÆ----
const getPropertyTypeLabel = (type: string) =>
‚ãÆ----
const getOperationTypeLabel = (type: string) =>
‚ãÆ----
const formatPrice = (price: number) =>
‚ãÆ----
<Badge className=
</file>

<file path="components/FeaturedPropertiesSlider.tsx">
import React, { useEffect, useCallback } from 'react'
import useEmblaCarousel from 'embla-carousel-react'
import { EmblaOptionsType } from 'embla-carousel'
import Autoplay from 'embla-carousel-autoplay'
import { motion } from 'framer-motion'
import Link from 'next/link'
import Image from 'next/image'
import { Card, CardContent } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { PropertyMiniMap } from '@/components/PropertyMiniMap'
import { Property } from '@/lib/supabase'
import { Home, MapPin, Bed, Bath, Square, ChevronLeft, ChevronRight } from 'lucide-react'
‚ãÆ----
interface FeaturedPropertiesSliderProps {
  properties: Property[]
}
</file>

<file path="components/HeroSearchBar.tsx">
import { useState } from "react";
import { useRouter } from "next/navigation";
import { Button } from "@/components/ui/button";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Search, Home, Building, TreePine } from "lucide-react";
import { motion } from "framer-motion";
‚ãÆ----
export function HeroSearchBar()
‚ãÆ----
const handleSearch = () =>
</file>

<file path="app/agentes/page.tsx">
import { useState } from "react";
import { motion } from "framer-motion";
import {
  Phone,
  Mail,
  MapPin,
  Award,
  Users,
  Home,
  Star,
  MessageCircle,
  Building2,
  Landmark,
  Crown,
  Check,
  ArrowRight,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { getOptimizedImageUrl } from "@/lib/cloudinary";
import Image from "next/image";
import Link from "next/link";
import Header from "@/components/Header"
import Footer from "@/components/Footer";
import Hero from "@/components/Hero"
‚ãÆ----
interface Agent {
  id: number;
  name: string;
  role: string;
  specialization: string;
  phone: string;
  email: string;
  image: string;
  description: string;
  achievements: string[];
  icon: typeof Home;
}
‚ãÆ----
const handleContactAgent = (agent: Agent) =>
‚ãÆ----
// Scroll to contact form
‚ãÆ----
const handleSubmitContact = async (e: React.FormEvent) =>
‚ãÆ----
// Here would be the API call to create a lead
‚ãÆ----
src=
‚ãÆ----
{/* Why Choose Us Section - PREMIUM DESIGN */}
</file>

<file path="app/propiedades/[id]/page.tsx">
import { useState, useEffect } from "react"
import { useParams, useRouter } from "next/navigation"
import Image from "next/image"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { PropertyDetailMap } from "@/components/PropertyDetailMap"
import {
  ArrowLeft,
  MapPin,
  Bed,
  Bath,
  Square,
  Heart,
  Share2,
  Phone,
  Mail,
  MessageCircle,
  ChevronLeft,
  ChevronRight,
  Eye,
  Calendar,
  Wifi,
  Car,
  TreePine,
  ShieldCheck,
  Zap,
  Home
} from "lucide-react"
import type { Property as PropertyType } from "@/lib/supabase"
import Header from "@/components/Header"
import { ComprehensivePropertyTracker, ContactTracker, ImageGalleryTracker } from "@/components/PropertyViewTracker"
import { trackLead } from '@/lib/analytics-client'
import { LEAD_SOURCE_CODES } from '@/types/analytics'
‚ãÆ----
interface Property extends PropertyType {
  operation: "sale" | "rent"
  type: "house" | "apartment" | "commercial" | "terreno" | "local"
}
‚ãÆ----
// Fetch property data
‚ãÆ----
const fetchProperty = async () =>
‚ãÆ----
const nextImage = () =>
‚ãÆ----
const prevImage = () =>
‚ãÆ----
const getTypeDisplayName = (type: string) =>
‚ãÆ----
const getStatusDisplayName = (status: string) =>
‚ãÆ----
const getOperationDisplayName = (operation: string) =>
‚ãÆ----
const getFeatureIcon = (feature: string) =>
‚ãÆ----
const handleContactSubmit = async (e: React.FormEvent) =>
‚ãÆ----
onError=
‚ãÆ----

‚ãÆ----
onClick=
‚ãÆ----
onChange=
‚ãÆ----
required
</file>

<file path="components/admin/MarketingAnalytics.tsx">
import React, { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { KPICard } from '@/components/ui/kpi-card'
import { Badge } from '@/components/ui/badge'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import {
  AnalyticsDashboardLayout,
  WidgetGrid,
  buildAnalyticsBreadcrumbs
} from '@/components/layouts'
import {
  TrendingUp,
  TrendingDown,
  Users,
  Target,
  DollarSign,
  Clock,
  RefreshCw,
  BarChart3,
  PieChart,
  Globe,
  Megaphone,
  MousePointer,
  Eye,
  Search,
  Facebook,
  Instagram,
  MessageCircle,
  Mail,
  Phone,
  UserPlus,
  ArrowUpRight,
  ArrowDownRight,
  Play,
  Pause,
  TestTube
} from 'lucide-react'
import { useAnalyticsDashboard } from '@/hooks/useAnalyticsDashboard'
import { useRealTimeUpdates } from '@/hooks/useRealTimeUpdates'
‚ãÆ----
interface MarketingKPIs {
  totalLeads: {
    value: number
    change: number
    cost: number
  }
  leadQuality: {
    value: number
    change: number
    benchmark: number
  }
  costPerLead: {
    value: number
    change: number
    target: number
  }
  websiteTraffic: {
    value: number
    change: number
    conversionRate: number
  }
}
‚ãÆ----
interface ChannelPerformance {
  id: string
  name: string
  icon: React.ComponentType<{ className?: string }>
  leads: number
  cost: number
  cpl: number
  conversionRate: number
  roi: number
  trend: number
  color: string
  status: 'active' | 'paused' | 'testing'
}
‚ãÆ----
interface CampaignData {
  id: string
  name: string
  channel: string
  utmSource: string
  utmMedium: string
  utmCampaign: string
  startDate: string
  endDate: string
  budget: number
  spent: number
  leads: number
  conversions: number
  revenue: number
  roi: number
  cpl: number
  conversionRate: number
  clickThroughRate: number
  status: 'active' | 'paused' | 'completed' | 'draft'
  performance: 'excellent' | 'good' | 'average' | 'poor'
}
‚ãÆ----
interface WebsiteAnalyticsData {
  trafficSources: {
    source: string
    sessions: number
    percentage: number
    bounceRate: number
    avgSessionDuration: number
    conversions: number
    conversionRate: number
  }[]
  topPages: {
    page: string
    title: string
    pageviews: number
    uniquePageviews: number
    avgTimeOnPage: number
    bounceRate: number
    exitRate: number
    conversions: number
  }[]
  overallMetrics: {
    totalSessions: number
    totalPageviews: number
    avgSessionDuration: number
    bounceRate: number
    newUsersPercentage: number
    totalConversions: number
    overallConversionRate: number
  }
}
‚ãÆ----
interface ChannelPerformanceProps {
  period: string
  loading: boolean
}
‚ãÆ----
const getStatusColor = (status: string) =>
‚ãÆ----
<span className="text-sm text-chart-quaternary/80 font-mono bg-surface-darker/50 px-2 py-1 rounded-md inline-block mt-1">
<span className="hidden lg:inline font-medium">
‚ãÆ----
const [selectedPeriod, setSelectedPeriod] = useState('30d')
const [lastRefresh, setLastRefresh] = useState<Date>(new Date())
</file>

<file path="components/admin/PropertyAnalytics.tsx">
import React, { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { KPICard } from '@/components/ui/kpi-card'
import { Badge } from '@/components/ui/badge'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import {
  AnalyticsDashboardLayout,
  WidgetGrid,
  buildAnalyticsBreadcrumbs
} from '@/components/layouts'
import {
  TrendingUp,
  TrendingDown,
  Home,
  MapPin,
  DollarSign,
  Clock,
  RefreshCw,
  BarChart3,
  PieChart,
  Eye,
  Users,
  Calendar,
  Star,
  Target,
  Zap,
  Activity,
  Map,
  Building,
  ArrowUpRight,
  ArrowDownRight
} from 'lucide-react'
import { useAnalyticsDashboard } from '@/hooks/useAnalyticsDashboard'
import { useRealTimeUpdates } from '@/hooks/useRealTimeUpdates'
‚ãÆ----
interface PropertyKPIs {
  totalProperties: {
    value: number
    active: number
    sold: number
    pending: number
  }
  avgViewsPerProperty: {
    value: number
    change: number
    benchmark: number
  }
  avgTimeOnMarket: {
    value: number
    change: number
    target: number
  }
  conversionRate: {
    value: number
    change: number
    benchmark: number
  }
}
‚ãÆ----
interface PropertyPerformance {
  id: string
  title: string
  address: string
  neighborhood: string
  price: number
  propertyType: 'casa' | 'departamento' | 'local' | 'terreno'
  listingDate: string
  views: number
  uniqueViews: number
  leads: number
  showings: number
  favorites: number
  daysOnMarket: number
  priceChanges: number
  leadConversionRate: number
  performance: 'excellent' | 'good' | 'average' | 'poor'
  trending: 'up' | 'down' | 'stable'
  images?: string[]
}
‚ãÆ----
interface PropertyPerformanceProps {
  period: string
  loading: boolean
}
‚ãÆ----
switch (type)
‚ãÆ----
switch (trending)
‚ãÆ----
onError=
‚ãÆ----
if (parent)
‚ãÆ----
// =====================================================================================
// MAIN COMPONENT
// =====================================================================================
‚ãÆ----
// State management
‚ãÆ----
// Date range calculation
‚ãÆ----
// Hooks for data fetching
‚ãÆ----
// Real-time updates
‚ãÆ----
// State for properties module data
‚ãÆ----
// Fetch properties module data
‚ãÆ----
const fetchPropertiesData = async () =>
‚ãÆ----
// ‚úÖ REAL DATA from properties module - 100% calculated from real data
‚ãÆ----
// ‚úÖ Calculate avg time on market from properties' created_at dates
‚ãÆ----
value: overview.total_properties || 0, // ‚úÖ Real property count
active: overview.total_properties || 0, // TODO Phase 3: Add property status filtering
sold: 0, // TODO Phase 3: Track from sales_closed table
pending: 0 // TODO Phase 3: Track from sales_pipeline table
‚ãÆ----
value: overview.avg_views_per_property || 0, // ‚úÖ Real: total_views / property_count
change: 0, // TODO Phase 2: Calculate trend
‚ãÆ----
value: avgTimeOnMarket, // ‚úÖ Real: calculated from properties.created_at
change: 0, // TODO Phase 2: Calculate trend
‚ãÆ----
value: dashboardData?.conversion_rate || 0, // ‚úÖ Real data from dashboard
change: 0, // TODO Phase 2: Calculate trend
‚ãÆ----
// Breadcrumbs
‚ãÆ----
// Header actions
‚ãÆ----
{/* Property KPI Cards Row */}
</file>

<file path="components/Hero.tsx">
import { ReactNode } from "react"
import { motion } from "framer-motion"
import Image from "next/image"
‚ãÆ----
interface HeroProps {
  backgroundImage: string
  alt: string
  title: string | ReactNode
  description: string
  showCounter?: boolean
  counterText?: string
  counterValue?: number
  withAnimation?: boolean
  imageClassName?: string
  children?: ReactNode
}
</file>

<file path="components/PropertyCard.tsx">
import React from "react"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Heart, Mail, ArrowRight, MapPin, Bed, Bath, Square, Home, Eye } from "lucide-react"
import Image from "next/image"
import Link from "next/link"
import type { Property as PropertyType } from "@/lib/supabase"
‚ãÆ----
interface Property extends PropertyType {
  operation: "sale" | "rent"
  type: "house" | "apartment" | "commercial" | "terreno" | "local"
}
‚ãÆ----
interface PropertyCardProps {
  property: Property
}
</file>

<file path="services/analytics.ts">
import { supabase, supabaseAdmin } from "@/lib/supabase"
import {
  type AnalyticsSession,
  type PropertyViewEvent,
  type LeadGenerationEvent,
  type UserInteractionEvent,
  type CreateAnalyticsSessionInput,
  type CreatePropertyViewInput,
  type CreateLeadGenerationEventInput,
  type CreateUserInteractionEventInput,
  type PropertyMetrics,
  type TopPropertyResult,
  type DashboardStats,
  type LeadSourceStats,
  type CampaignStats,
  type DeviceTypeStats,
  type HourlyTrafficStats,
  type AnalyticsFilters,
  type LeadSourceCode,
  type AnalyticsMetricType,
  AnalyticsValidationError,
  AnalyticsPrivacyError,
  ANALYTICS_CONSTANTS
} from "@/types/analytics"
‚ãÆ----
export class AnalyticsService
‚ãÆ----
static async createSession(sessionData: CreateAnalyticsSessionInput): Promise<string>
‚ãÆ----
static async getOrCreateSession(
    ipAddress: string,
    userAgent?: string,
    additionalData?: Partial<CreateAnalyticsSessionInput>
): Promise<string>
‚ãÆ----
static async updateSessionLastSeen(sessionId: string): Promise<void>
‚ãÆ----
static async recordPropertyView(viewData: CreatePropertyViewInput): Promise<string>
‚ãÆ----
static async recordPropertyViewWithSession(
    propertyId: number,
    ipAddress: string,
    userAgent?: string,
    viewData?: Partial<CreatePropertyViewInput>,
    sessionData?: Partial<CreateAnalyticsSessionInput>
): Promise<
‚ãÆ----
static async recordLeadGeneration(leadData: CreateLeadGenerationEventInput): Promise<void>
‚ãÆ----
static async recordLeadWithSource(
    leadId: number,
    sourceCode: LeadSourceCode,
    sessionId?: string,
    propertyId?: number,
    additionalData?: Partial<CreateLeadGenerationEventInput>
): Promise<void>
‚ãÆ----
static async recordInteraction(interactionData: CreateUserInteractionEventInput): Promise<void>
‚ãÆ----
static async recordInteractionsBatch(interactions: CreateUserInteractionEventInput[]): Promise<void>
‚ãÆ----
static async getPropertyMetrics(
    propertyId: number,
    daysBack: number = 30
): Promise<PropertyMetrics>
‚ãÆ----
static async getTopProperties(
    limit = 10,
    metric: AnalyticsMetricType = 'views',
    days = 30
): Promise<TopPropertyResult[]>
‚ãÆ----
static async getDashboardStats(filters?: AnalyticsFilters): Promise<DashboardStats>
‚ãÆ----
static async getLeadSourceStats(startDate: string, endDate: string): Promise<LeadSourceStats[]>
‚ãÆ----
static async getCampaignStats(startDate: string, endDate: string): Promise<CampaignStats[]>
‚ãÆ----
static async getDeviceTypeStats(startDate: string, endDate: string): Promise<DeviceTypeStats[]>
‚ãÆ----
static async handleOptOut(sessionId: string, ipAddress?: string): Promise<void>
‚ãÆ----
static async cleanupOldData(retentionMonths = ANALYTICS_CONSTANTS.RETENTION_MONTHS): Promise<number>
‚ãÆ----
private static async getSessionStats(startDate: string, endDate: string, filters?: AnalyticsFilters)
‚ãÆ----
private static async getViewStats(startDate: string, endDate: string, filters?: AnalyticsFilters)
‚ãÆ----
private static async getLeadStats(startDate: string, endDate: string, filters?: AnalyticsFilters)
‚ãÆ----
private static async getDailyStats(startDate: string, endDate: string)
‚ãÆ----
private static validatePropertyView(data: CreatePropertyViewInput): void
‚ãÆ----
private static validateLeadGeneration(data: CreateLeadGenerationEventInput): void
‚ãÆ----
private static validateInteraction(data: CreateUserInteractionEventInput): void
‚ãÆ----
private static async hashString(input: string): Promise<string>
‚ãÆ----
// Server environment - would need to import crypto module
‚ãÆ----
export class AnalyticsHooks
‚ãÆ----
static usePageView(propertyId?: number)
‚ãÆ----
static useInteractionTracking(sessionId: string)
‚ãÆ----
export class AnalyticsAggregation
‚ãÆ----
static async generateDailyAggregates(date?: string): Promise<void>
‚ãÆ----
static async generateWeeklyMonthlyAggregates(): Promise<void>
</file>

<file path="app/propiedades/page.tsx">
import { useState, useEffect } from "react"
import { useRouter, useSearchParams } from "next/navigation"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Badge } from "@/components/ui/badge"
import { Search, Filter, MapPin, Bed, Bath, Square, Heart, Eye, ChevronLeft, ChevronRight, Home, ArrowLeft, ChevronDown, ChevronUp } from "lucide-react"
import Image from "next/image"
import Link from "next/link"
import Header from "@/components/Header"
import Footer from "@/components/Footer"
import PropertyCard from "@/components/PropertyCard"
import Hero from "@/components/Hero"
import { getOptimizedImageUrl } from "@/lib/cloudinary"
import { PropertyService } from "@/services/properties"
import type { Property as PropertyType } from "@/lib/supabase"
import { useAnalytics } from "@/hooks/useAnalytics"
‚ãÆ----
interface Property extends PropertyType {
  operation: "sale" | "rent"
  type: "house" | "apartment" | "commercial" | "terreno" | "local"
}
‚ãÆ----
const fetchProperties = async () =>
‚ãÆ----
// Apply filters
‚ãÆ----
// Search filter
‚ãÆ----
// Operation filter
‚ãÆ----
const clearFilters = () =>
‚ãÆ----
const getTypeDisplayName = (type: string) =>
‚ãÆ----
const getStatusDisplayName = (status: string) =>
‚ãÆ----
{/* Filters - Compact with Expandable Design */}
</file>

<file path="app/page.tsx">
import { useState, useEffect, useRef } from "react";
import { motion, useInView, useScroll, useTransform } from "framer-motion";
import {
  Search,
  MapPin,
  Landmark,
  Bed,
  Bath,
  Square,
  ArrowRight,
  MessageCircle,
  Star,
  Users,
  Home,
  Award,
  Heart,
  Eye,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { FeaturedPropertiesSlider } from "@/components/FeaturedPropertiesSlider";
import { HeroSearchBar } from "@/components/HeroSearchBar";
import { getOptimizedImageUrl } from "@/lib/cloudinary";
import Link from "next/link";
import Image from "next/image";
import Header from "@/components/Header";
import Footer from "@/components/Footer";
‚ãÆ----
import { useIsClient } from "@/hooks/use-is-client";
import { PropertyService } from "@/services/properties";
import type { Property } from "@/lib/supabase";
‚ãÆ----
const loadFeaturedProperties = async () =>
‚ãÆ----
const formatPrice = (price: number, currency: string) =>
‚ãÆ----
const getPropertyTypeLabel = (type: string) =>
‚ãÆ----
const handlePropertyInterest = (property: Property) =>
</file>

</files>
